/*! For license information please see 901.77c78ce1.iframe.bundle.js.LICENSE.txt */
(self.webpackChunkthink_single_editor=self.webpackChunkthink_single_editor||[]).push([[901],{"./src/extensions/mind/menu/kityminder/kityminder.editor.js":()=>{!function(){var _p={r:function(index){if(_p[index].inited)return _p[index].value;if("function"!=typeof _p[index].value)return _p[index].inited=!0,_p[index].value;var module={exports:{}},returnValue=_p[index].value(null,module.exports,module);if(_p[index].inited=!0,_p[index].value=returnValue,void 0!==returnValue)return returnValue;for(var key in module.exports)if(module.exports.hasOwnProperty(key))return _p[index].inited=!0,_p[index].value=module.exports,module.exports}};_p[0]={value:function(require,exports,module){var runtimes=[];function assemble(runtime){runtimes.push(runtime)}function KMEditor(selector){this.selector=selector;for(var i=0;i<runtimes.length;i++)"function"==typeof runtimes[i]&&runtimes[i].call(this,this)}return KMEditor.assemble=assemble,assemble(_p.r(7)),assemble(_p.r(9)),assemble(_p.r(14)),assemble(_p.r(18)),assemble(_p.r(11)),assemble(_p.r(12)),assemble(_p.r(5)),assemble(_p.r(6)),assemble(_p.r(8)),assemble(_p.r(15)),assemble(_p.r(10)),assemble(_p.r(13)),assemble(_p.r(16)),assemble(_p.r(17)),module.exports=KMEditor}},_p[1]={value:function(require,exports,module){return module.exports=kityminder.Editor=_p.r(0)}},_p[2]={value:function(require,exports,module){return module.exports=window.HotBox}},_p[3]={value:function(require,exports,module){}},_p[4]={value:function(require,exports,module){return module.exports=window.kityminder.Minder}},_p[5]={value:function(require,exports,module){function MimeType(){var MIMETYPE={"application/km":"￿"},SIGN={"\ufeff":"SPLITOR","￿":"application/km"};function process(mimetype,text){if(!this.isPureText(text)){if(!this.whichMimeType(text))throw new Error("unknow mimetype!");text=this.getPureText(text)}return!1===mimetype?text:mimetype+"\ufeff"+text}this.registMimeTypeProtocol=function(type,sign){if(sign&&SIGN[sign])throw new Error("sing has registed!");if(type&&MIMETYPE[type])throw new Error("mimetype has registed!");SIGN[sign]=type,MIMETYPE[type]=sign},this.getMimeTypeProtocol=function(type,text){var mimetype=MIMETYPE[type]||!1;return void 0===text?process.bind(this,mimetype):process(mimetype,text)},this.getSpitor=function(){return"\ufeff"},this.getMimeType=function(sign){return void 0!==sign?SIGN[sign]||null:MIMETYPE}}return MimeType.prototype.isPureText=function(text){return!~text.indexOf(this.getSpitor())},MimeType.prototype.getPureText=function(text){return this.isPureText(text)?text:text.split(this.getSpitor())[1]},MimeType.prototype.whichMimeType=function(text){return this.isPureText(text)?null:this.getMimeType(text.split(this.getSpitor())[0])},module.exports=function MimeTypeRuntime(){this.minder.supportClipboardEvent&&!kity.Browser.gecko&&(this.MimeType=new MimeType)}}},_p[6]={value:function(require,exports,module){return module.exports=function ClipboardRuntime(){var minder=this.minder,Data=window.kityminder.data;if(minder.supportClipboardEvent&&!kity.Browser.gecko){var fsm=this.fsm,receiver=this.receiver,MimeType=this.MimeType,kmencode=MimeType.getMimeTypeProtocol("application/km"),decode=Data.getRegisterProtocol("json").decode,_selectedNodes=[];document.addEventListener("copy",(function(e){if(document.activeElement==receiver.element){var clipBoardEvent=e;switch(fsm.state()){case"input":break;case"normal":var nodes=[].concat(minder.getSelectedNodes());if(nodes.length){var targetLevel;if(nodes.length>1)if(nodes.sort((function(a,b){return a.getLevel()-b.getLevel()})),(targetLevel=nodes[0].getLevel())!==nodes[nodes.length-1].getLevel()){var pnode,idx=0,l=nodes.length,pidx=l-1;for(pnode=nodes[pidx];pnode.getLevel()!==targetLevel;){for(idx=0;idx<l&&nodes[idx].getLevel()===targetLevel;){if(nodes[idx].isAncestorOf(pnode)){nodes.splice(pidx,1);break}idx++}pnode=nodes[--pidx]}}var str=encode(nodes);clipBoardEvent.clipboardData.setData("text/plain",str)}e.preventDefault()}}})),document.addEventListener("cut",(function(e){if(document.activeElement==receiver.element){if("normal"!==minder.getStatus())return void e.preventDefault();var clipBoardEvent=e;switch(fsm.state()){case"input":break;case"normal":var nodes=minder.getSelectedNodes();nodes.length&&(clipBoardEvent.clipboardData.setData("text/plain",encode(nodes)),minder.execCommand("removenode")),e.preventDefault()}}})),document.addEventListener("paste",(function(e){if(document.activeElement==receiver.element){if("normal"!==minder.getStatus())return void e.preventDefault();var clipBoardEvent=e,state=fsm.state(),textData=clipBoardEvent.clipboardData.getData("text/plain");switch(state){case"input":if(!MimeType.isPureText(textData))return void e.preventDefault();break;case"normal":var sNodes=minder.getSelectedNodes();if("application/km"===MimeType.whichMimeType(textData)){var _node,nodes=decode(MimeType.getPureText(textData));sNodes.forEach((function(node){for(var i=nodes.length-1;i>=0;i--)_node=minder.createNode(null,node),minder.importNode(_node,nodes[i]),_selectedNodes.push(_node),node.appendChild(_node)})),minder.select(_selectedNodes,!0),_selectedNodes=[],minder.refresh()}else{if(clipBoardEvent.clipboardData&&clipBoardEvent.clipboardData.items[0].type.indexOf("image")>-1){var imageFile=clipBoardEvent.clipboardData.items[0].getAsFile();return angular.element(document.body).injector().get("server").uploadImage(imageFile).then((function(json){var resp=json.data;0===resp.errno&&minder.execCommand("image",resp.data.url)}))}sNodes.forEach((function(node){minder.Text2Children(node,textData)}))}e.preventDefault()}}}))}function encode(nodes){for(var _nodes=[],i=0,l=nodes.length;i<l;i++)_nodes.push(minder.exportNode(nodes[i]));return kmencode(Data.getRegisterProtocol("json").encode(_nodes))}}}},_p[7]={value:function(require,exports,module){return module.exports=function ContainerRuntime(){var container;if(!(container="string"==typeof this.selector?document.querySelector(this.selector):this.selector))throw new Error("Invalid selector: "+this.selector);container.classList.add("km-editor"),this.container=container}}},_p[8]={value:function(require,exports,module){var Hotbox=_p.r(2);new(_p.r(19))("drag");return module.exports=function DragRuntime(){var downX,downY,fsm=this.fsm,minder=this.minder,hotbox=this.hotbox;this.receiver.element,function setupFsm(){fsm.when("* -> drag",(function(){})),fsm.when("drag -> *",(function(exit,enter,reason){}))}();var maxX,maxY,osx,osy,containerY,frame,flag=1,freeHorizen=!1,freeVirtical=!1;function move(direction,speed){if(!direction)return freeHorizen=freeVirtical=!1,frame&&kity.releaseFrame(frame),void(frame=null);frame||(frame=kity.requestFrame(function(direction,speed,minder){return function(frame){switch(direction){case"left":minder._viewDragger.move({x:-speed,y:0},0);break;case"top":minder._viewDragger.move({x:0,y:-speed},0);break;case"right":minder._viewDragger.move({x:speed,y:0},0);break;case"bottom":minder._viewDragger.move({x:0,y:speed},0);break;default:return}frame.next()}}(direction,speed,minder)))}minder.on("mousedown",(function(e){flag=0;var rect=minder.getPaper().container.getBoundingClientRect();downX=e.originEvent.clientX,downY=e.originEvent.clientY,containerY=rect.top,maxX=rect.width,maxY=rect.height})),minder.on("mousemove",(function(e){if("drag"===fsm.state()&&0==flag&&minder.getSelectedNode()&&(Math.abs(downX-e.originEvent.clientX)>20||Math.abs(downY-e.originEvent.clientY)>20)&&(osx=e.originEvent.clientX,osy=e.originEvent.clientY-containerY,osx<20?move("right",20-osx):osx>maxX-20?move("left",20+osx-maxX):freeHorizen=!0,osy<20?move("bottom",osy):osy>maxY-20?move("top",20+osy-maxY):freeVirtical=!0,freeHorizen&&freeVirtical&&move(!1)),"drag"!==fsm.state()&&0===flag&&minder.getSelectedNode()&&(Math.abs(downX-e.originEvent.clientX)>20||Math.abs(downY-e.originEvent.clientY)>20))return"hotbox"===fsm.state()&&hotbox.active(Hotbox.STATE_IDLE),fsm.jump("drag","user-drag")})),window.addEventListener("mouseup",(function(){if(flag=1,"drag"===fsm.state())return move(!1),fsm.jump("normal","drag-finish")}),!1)}}},_p[9]={value:function(require,exports,module){var debug=new(_p.r(19))("fsm");function handlerConditionMatch(condition,when,exit,enter){return condition.when==when&&(("*"==condition.enter||condition.enter==enter)&&("*"==condition.exit||condition.exit==exit||void 0))}function FSM(defaultState){var currentState=defaultState,handlers=[];this.jump=function(newState,reason){if(!reason)throw new Error("Please tell fsm the reason to jump");var i,handler,oldState=currentState,notify=[oldState,newState].concat([].slice.call(arguments,1));for(i=0;i<handlers.length;i++)if(handlerConditionMatch((handler=handlers[i]).condition,"before",oldState,newState)&&handler.apply(null,notify))return;for(currentState=newState,debug.log("[{0}] {1} -> {2}",reason,oldState,newState),i=0;i<handlers.length;i++)handlerConditionMatch((handler=handlers[i]).condition,"after",oldState,newState)&&handler.apply(null,notify);return currentState},this.state=function(){return currentState},this.when=function(condition,handler){var when,resolved,exit,enter;if(1==arguments.length&&(handler=condition,condition="* -> *"),2==(resolved=condition.split(" - ")).length?when="before":2==(resolved=condition.split(" -> ")).length&&(when="after"),!when)throw new Error("Illegal fsm condition: "+condition);exit=resolved[0],enter=resolved[1],handler.condition={when,exit,enter},handlers.push(handler)}}return module.exports=function FSMRumtime(){this.fsm=new FSM("normal")}}},_p[10]={value:function(require,exports,module){var jsonDiff=_p.r(22);return window.diff=jsonDiff,module.exports=function HistoryRuntime(){var lastSnap,patchLock,undoDiffs,redoDiffs,minder=this.minder,hotbox=this.hotbox;function reset(){undoDiffs=[],redoDiffs=[],lastSnap=minder.exportJson()}function makeUndoDiff(){var headSnap=minder.exportJson(),diff=jsonDiff(headSnap,lastSnap);if(diff.length){for(undoDiffs.push(diff);undoDiffs.length>100;)undoDiffs.shift();return lastSnap=headSnap,!0}}function undo(){patchLock=!0;var undoDiff=undoDiffs.pop();undoDiff&&(minder.applyPatches(undoDiff),function makeRedoDiff(){var revertSnap=minder.exportJson();redoDiffs.push(jsonDiff(revertSnap,lastSnap)),lastSnap=revertSnap}()),patchLock=!1}function redo(){patchLock=!0;var redoDiff=redoDiffs.pop();redoDiff&&(minder.applyPatches(redoDiff),makeUndoDiff()),patchLock=!1}function hasUndo(){return!!undoDiffs.length}function hasRedo(){return!!redoDiffs.length}this.history={reset,undo,redo,hasUndo,hasRedo},reset(),minder.on("contentchange",(function changed(){patchLock||makeUndoDiff()&&(redoDiffs=[])})),minder.on("import",reset),minder.on("patch",(function updateSelection(e){if(patchLock){var patch=e.patch;switch(patch.express){case"node.add":minder.select(patch.node.getChild(patch.index),!0);break;case"node.remove":case"data.replace":case"data.remove":case"data.add":minder.select(patch.node,!0)}}}));var main=hotbox.state("main");main.button({position:"top",label:"撤销",key:"Ctrl + Z",enable:hasUndo,action:undo,next:"idle"}),main.button({position:"top",label:"重做",key:"Ctrl + Y",enable:hasRedo,action:redo,next:"idle"})}}},_p[11]={value:function(require,exports,module){var Hotbox=_p.r(2);return module.exports=function HotboxRuntime(){var fsm=this.fsm,minder=this.minder,receiver=this.receiver,container=this.container,hotbox=new Hotbox(container);hotbox.setParentFSM(fsm),fsm.when("normal -> hotbox",(function(exit,enter,reason){var position,node=minder.getSelectedNode();if(node){var box=node.getRenderBox();position={x:box.cx,y:box.cy}}hotbox.active("main",position)})),fsm.when("normal -> normal",(function(exit,enter,reason,e){"shortcut-handle"==reason&&(hotbox.dispatch(e)?e.preventDefault():minder.dispatchKeyEvent(e))})),fsm.when("modal -> normal",(function(exit,enter,reason,e){"import-text-finish"==reason&&receiver.element.focus()})),this.hotbox=hotbox}}},_p[12]={value:function(require,exports,module){_p.r(21);var debug=new(_p.r(19))("input");return module.exports=function InputRuntime(){var fsm=this.fsm,minder=this.minder,hotbox=this.hotbox,receiver=this.receiver,receiverElement=receiver.element,isGecko=window.kity.Browser.gecko;function editText(){var node=minder.getSelectedNode();if(node){var textContainer=receiverElement;if(receiverElement.innerText="","bold"===node.getData("font-weight")){var b=document.createElement("b");textContainer.appendChild(b),textContainer=b}if("italic"===node.getData("font-style")){var i=document.createElement("i");textContainer.appendChild(i),textContainer=i}textContainer.innerText=minder.queryCommandValue("text"),isGecko&&receiver.fixFFCaretDisappeared(),fsm.jump("input","input-request"),receiver.selectAll()}}function enterInputMode(){var node=minder.getSelectedNode();if(node){var fontSize=node.getData("font-size")||node.getStyle("font-size");receiverElement.style.fontSize=fontSize+"px",receiverElement.style.minWidth=0,receiverElement.style.minWidth=receiverElement.clientWidth+"px",receiverElement.style.fontWeight=node.getData("font-weight")||"",receiverElement.style.fontStyle=node.getData("font-style")||"",receiverElement.classList.add("input"),receiverElement.focus()}}function exitInputMode(){receiverElement.classList.remove("input"),receiver.selectAll()}function updatePosition(){var planed=updatePosition,focusNode=minder.getSelectedNode();focusNode&&(planed.timer||(planed.timer=setTimeout((function(){var box=focusNode.getRenderBox("TextRenderer");receiverElement.style.left=Math.round(box.x)+"px",receiverElement.style.top=(debug.flaged?Math.round(box.bottom+30):Math.round(box.y))+"px",planed.timer=0}))))}!function setupReciverElement(){debug.flaged&&receiverElement.classList.add("debug");receiverElement.onmousedown=function(e){e.stopPropagation()},minder.on("layoutallfinish viewchange viewchanged selectionchange",(function(e){"viewchange"==e.type&&"input"!=fsm.state()||updatePosition()})),updatePosition()}(),function setupFsm(){fsm.when("* -> input",enterInputMode),fsm.when("input -> *",(function(exit,enter,reason){return"input-cancel"===reason?exitInputMode():function commitInputResult(){var textNodes=[].slice.call(receiverElement.childNodes);setTimeout((function(){receiverElement.innerHTML=""}),0);var node=minder.getSelectedNode();if(textNodes=function commitInputText(textNodes){for(var str,_divChildNodes,space_l,text="",TAB_CHAR="\t",ENTER_CHAR="\n",STR_CHECK=/\S/,SPACE_CHAR=" ",SPACE_CHAR_REGEXP=new RegExp("( |"+String.fromCharCode(160)+")"),BR=document.createElement("br"),isBold=!1,isItalic=!1,i=0,l=textNodes.length;i<l;i++)switch(str=textNodes[i],Object.prototype.toString.call(str)){case"[object HTMLBRElement]":text+=ENTER_CHAR;break;case"[object Text]":if(str=str.textContent.replace("&nbsp;"," "),STR_CHECK.test(str))text+=str;else for(space_l=str.length;space_l--;)SPACE_CHAR_REGEXP.test(str[space_l])?text+=SPACE_CHAR:str[space_l]===TAB_CHAR&&(text+=TAB_CHAR);break;case"[object HTMLElement]":switch(str.nodeName){case"B":isBold=!0;break;case"I":isItalic=!0}[].splice.apply(textNodes,[i,1].concat([].slice.call(str.childNodes))),l=textNodes.length,i--;break;case"[object HTMLSpanElement]":[].splice.apply(textNodes,[i,1].concat([].slice.call(str.childNodes))),l=textNodes.length,i--;break;case"[object HTMLImageElement]":str.src&&/http(|s):\/\//.test(str.src)&&minder.execCommand("Image",str.src,str.alt);break;case"[object HTMLDivElement]":_divChildNodes=[];var di=0;for(l=str.childNodes.length;di<l;di++)_divChildNodes.push(str.childNodes[di]);_divChildNodes.push(BR),[].splice.apply(textNodes,[i,1].concat(_divChildNodes)),l=textNodes.length,i--;break;default:if(str&&str.childNodes.length){_divChildNodes=[];for(di=0,l=str.childNodes.length;di<l;di++)_divChildNodes.push(str.childNodes[di]);_divChildNodes.push(BR),[].splice.apply(textNodes,[i,1].concat(_divChildNodes)),l=textNodes.length,i--}else str&&void 0!==str.textContent?text+=str.textContent:text+=""}text=(text=text.replace(/^\n*|\n*$/g,"")).replace(new RegExp("(\n|\r|\n\r)( |"+String.fromCharCode(160)+"){4}","g"),"$1\t"),minder.getSelectedNode().setText(text),isBold?minder.queryCommandState("bold")||minder.execCommand("bold"):minder.queryCommandState("bold")&&minder.execCommand("bold");isItalic?minder.queryCommandState("italic")||minder.execCommand("italic"):minder.queryCommandState("italic")&&minder.execCommand("italic");return exitInputMode(),text}(textNodes),function commitInputNode(node,text){try{minder.decodeData("text",text).then((function(json){function importText(node,json,minder){var data=json.data;node.setText(data.text||"");for(var childrenTreeData=json.children||[],i=0;i<childrenTreeData.length;i++){importText(minder.createNode(null,node),childrenTreeData[i],minder)}return node}importText(node,json,minder),minder.fire("contentchange"),minder.getRoot().renderTree(),minder.layout(300)}))}catch(e){if(minder.fire("contentchange"),minder.getRoot().renderTree(),"Error: Invalid local format"!==e.toString())throw e}}(node,textNodes),"root"==node.type){var rootText=minder.getRoot().getText();minder.fire("initChangeRoot",{text:rootText})}}()})),receiver.onblur((function(e){"input"==fsm.state()&&fsm.jump("normal","input-commit")})),minder.on("beforemousedown",(function(){"input"==fsm.state()&&fsm.jump("normal","input-commit")})),minder.on("dblclick",(function(){minder.getSelectedNode()&&"readonly"!==minder._status&&editText()}))}(),function setupHotbox(){hotbox.state("main").button({position:"center",label:"编辑",key:"F2",enable:function(){return-1!=minder.queryCommandState("text")},action:editText})}(),this.editText=editText}}},_p[13]={value:function(require,exports,module){var Hotbox=_p.r(2);return module.exports=function JumpingRuntime(){var downX,downY,fsm=this.fsm,minder=this.minder,receiver=this.receiver,container=this.container,receiverElement=receiver.element,hotbox=this.hotbox,compositionLock=!1;receiver.listen("normal",(function(e){if(receiver.enable(),e.is("Space"))return e.preventDefault(),kity.Browser.safari&&(receiverElement.innerHTML=""),fsm.jump("hotbox","space-trigger");if("keydown"===e.type){if(minder.getSelectedNode()){if(function isIntendToInput(e){return!(e.ctrlKey||e.metaKey||e.altKey)&&(e.keyCode>=65&&e.keyCode<=90||e.keyCode>=48&&e.keyCode<=57||108!=e.keyCode&&e.keyCode>=96&&e.keyCode<=111||108!=e.keyCode&&e.keyCode>=96&&e.keyCode<=111||229==e.keyCode||0===e.keyCode)}(e))return fsm.jump("input","user-input")}else receiverElement.innerHTML="";fsm.jump("normal","shortcut-handle",e)}})),receiver.listen("hotbox",(function(e){receiver.disable(),e.preventDefault();hotbox.dispatch(e);if(hotbox.state()==Hotbox.STATE_IDLE&&"hotbox"==fsm.state())return fsm.jump("normal","hotbox-idle")})),receiver.listen("input",(function(e){if(receiver.enable(),"keydown"==e.type){if(e.is("Enter"))return e.preventDefault(),fsm.jump("normal","input-commit");if(e.is("Esc"))return e.preventDefault(),fsm.jump("normal","input-cancel");(e.is("Tab")||e.is("Shift + Tab"))&&e.preventDefault()}else if("keyup"==e.type&&e.is("Esc")){if(e.preventDefault(),!compositionLock)return fsm.jump("normal","input-cancel")}else"compositionstart"==e.type?compositionLock=!0:"compositionend"==e.type&&setTimeout((function(){compositionLock=!1}))})),container.addEventListener("mousedown",(function(e){2==e.button&&e.preventDefault(),"hotbox"==fsm.state()?(hotbox.active(Hotbox.STATE_IDLE),fsm.jump("normal","blur")):"normal"==fsm.state()&&2==e.button&&(downX=e.clientX,downY=e.clientY)}),!1),container.addEventListener("mousewheel",(function(e){"hotbox"==fsm.state()&&(hotbox.active(Hotbox.STATE_IDLE),fsm.jump("normal","mousemove-blur"))}),!1),container.addEventListener("contextmenu",(function(e){e.preventDefault()})),container.addEventListener("mouseup",(function(e){"normal"==fsm.state()&&2==e.button&&e.clientX==downX&&e.clientY==downY&&minder.getSelectedNode()&&fsm.jump("hotbox","content-menu")}),!1),hotbox.$element.addEventListener("mousedown",(function(e){e.stopPropagation()}))}}},_p[14]={value:function(require,exports,module){var Minder=_p.r(4);return module.exports=function MinderRuntime(){var minder=new Minder({enableKeyReceiver:!1,enableAnimation:!0});minder.renderTo(this.selector),minder.setTheme(null),minder.select(minder.getRoot(),!0),minder.execCommand("text","中心主题"),this.minder=minder}}},_p[15]={value:function(require,exports,module){return module.exports=function NodeRuntime(){var runtime=this,minder=this.minder,hotbox=this.hotbox,fsm=this.fsm,main=hotbox.state("main"),AppendLock=0;["前移:Alt+Up:ArrangeUp","下级:Tab|Insert:AppendChildNode","同级:Enter:AppendSiblingNode","后移:Alt+Down:ArrangeDown","删除:Delete|Backspace:RemoveNode","上级:Shift+Tab|Shift+Insert:AppendParentNode"].forEach((function(button){var parts=button.split(":"),label=parts.shift(),key=parts.shift(),command=parts.shift();main.button({position:"ring",label,key,action:function(){if(0===command.indexOf("Append")){AppendLock++,minder.execCommand(command,"分支主题"),minder.on("layoutallfinish",(function afterAppend(){--AppendLock||runtime.editText(),minder.off("layoutallfinish",afterAppend)}))}else minder.execCommand(command),fsm.jump("normal","command-executed")},enable:function(){return-1!=minder.queryCommandState(command)}})})),main.button({position:"bottom",label:"导入节点",key:"Alt + V",enable:function(){return 1==minder.getSelectedNodes().length},action:function importNodeData(){minder.fire("importNodeData")},next:"idle"}),main.button({position:"bottom",label:"导出节点",key:"Alt + C",enable:function(){return 1==minder.getSelectedNodes().length},action:function exportNodeData(){minder.fire("exportNodeData")},next:"idle"})}}},_p[16]={value:function(require,exports,module){return module.exports=function PriorityRuntime(){var minder=this.minder,hotbox=this.hotbox;hotbox.state("main").button({position:"top",label:"优先级",key:"P",next:"priority",enable:function(){return-1!=minder.queryCommandState("priority")}});var priority=hotbox.state("priority");"123456789".replace(/./g,(function(p){priority.button({position:"ring",label:"P"+p,key:p,action:function(){minder.execCommand("Priority",p)}})})),priority.button({position:"center",label:"移除",key:"Del",action:function(){minder.execCommand("Priority",0)}}),priority.button({position:"top",label:"返回",key:"esc",next:"back"})}}},_p[17]={value:function(require,exports,module){return module.exports=function ProgressRuntime(){var minder=this.minder,hotbox=this.hotbox;hotbox.state("main").button({position:"top",label:"进度",key:"G",next:"progress",enable:function(){return-1!=minder.queryCommandState("progress")}});var progress=hotbox.state("progress");"012345678".replace(/./g,(function(p){progress.button({position:"ring",label:"G"+p,key:p,action:function(){minder.execCommand("Progress",parseInt(p)+1)}})})),progress.button({position:"center",label:"移除",key:"Del",action:function(){minder.execCommand("Progress",0)}}),progress.button({position:"top",label:"返回",key:"esc",next:"back"})}}},_p[18]={value:function(require,exports,module){var key=_p.r(23);_p.r(2);return module.exports=function ReceiverRuntime(){var fsm=this.fsm,minder=this.minder,element=document.createElement("div");element.contentEditable=!0,element.setAttribute("tabindex",-1),element.classList.add("receiver"),element.onkeydown=element.onkeypress=element.onkeyup=dispatchKeyEvent,element.addEventListener("compositionstart",dispatchKeyEvent),this.container.appendChild(element);var receiver={element,selectAll:function(){element.innerHTML||(element.innerHTML="&nbsp;");var range=document.createRange(),selection=window.getSelection();range.selectNodeContents(element),selection.removeAllRanges(),selection.addRange(range),element.focus()},enable:function(){element.setAttribute("contenteditable",!0)},disable:function(){element.setAttribute("contenteditable",!1)},fixFFCaretDisappeared:function(){element.removeAttribute("contenteditable"),element.setAttribute("contenteditable","true"),element.blur(),element.focus()},onblur:function(handler){element.onblur=handler}};receiver.selectAll(),minder.on("beforemousedown",receiver.selectAll),minder.on("receiverfocus",receiver.selectAll),minder.on("readonly",(function(){minder.disable(),editor.receiver.element.parentElement.removeChild(editor.receiver.element),editor.hotbox.$container.removeChild(editor.hotbox.$element)}));var listeners=[];function dispatchKeyEvent(e){var listener;e.is=function(keyExpression){for(var subs=keyExpression.split("|"),i=0;i<subs.length;i++)if(key.is(this,subs[i]))return!0;return!1};for(var i=0;i<listeners.length;i++)if(("*"==(listener=listeners[i]).notifyState||listener.notifyState==fsm.state())&&listener.call(null,e))return}receiver.listen=function(state,listener){1==arguments.length&&(listener=state,state="*"),listener.notifyState=state,listeners.push(listener)},this.receiver=receiver}}},_p[19]={value:function(require,exports,module){var format=_p.r(20);function noop(){}return module.exports=function Debug(flag){if(this.flaged=-1!=window.location.search.indexOf(flag)){var h=function stringHash(str){for(var hash=0,i=0;i<str.length;i++)hash+=str.charCodeAt(i);return hash}(flag)%360,flagStyle=format("background: hsl({0}, 50%, 80%); color: hsl({0}, 100%, 30%); padding: 2px 3px; margin: 1px 3px 0 0;border-radius: 2px;",h),textStyle="background: none; color: black;";this.log=function(){var output=format.apply(null,arguments);console.log(format("%c{0}%c{1}",flag,output),flagStyle,textStyle)}}else this.log=noop}}},_p[20]={value:function(require,exports,module){return module.exports=function format(template,args){return"object"!=typeof args&&(args=[].slice.call(arguments,1)),String(template).replace(/\{(\w+)\}/gi,(function(match,$key){return args[$key]||$key}))}}},_p[21]={value:function(require,exports,module){!("innerText"in document.createElement("a"))&&"getSelection"in window&&(HTMLElement.prototype.__defineGetter__("innerText",(function(){var str,i,selection=window.getSelection(),ranges=[];for(i=0;i<selection.rangeCount;i++)ranges[i]=selection.getRangeAt(i);for(selection.removeAllRanges(),selection.selectAllChildren(this),str=selection.toString(),selection.removeAllRanges(),i=0;i<ranges.length;i++)selection.addRange(ranges[i]);return str})),HTMLElement.prototype.__defineSetter__("innerText",(function(text){this.innerHTML=(text||"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")})))}},_p[22]={value:function(require,exports,module){var _objectKeys=Object.keys?Object.keys:function(o){var keys=[];for(var i in o)o.hasOwnProperty(i)&&keys.push(i);return keys};function escapePathComponent(str){return-1===str.indexOf("/")&&-1===str.indexOf("~")?str:str.replace(/~/g,"~0").replace(/\//g,"~1")}function deepClone(obj){return"object"==typeof obj?JSON.parse(JSON.stringify(obj)):obj}function _generate(mirror,obj,patches,path){for(var newKeys=_objectKeys(obj),oldKeys=_objectKeys(mirror),deleted=!1,t=oldKeys.length-1;t>=0;t--){var oldVal=mirror[key=oldKeys[t]];if(obj.hasOwnProperty(key)){var newVal=obj[key];"object"==typeof oldVal&&null!=oldVal&&"object"==typeof newVal&&null!=newVal?_generate(oldVal,newVal,patches,path+"/"+escapePathComponent(key)):oldVal!=newVal&&(!0,patches.push({op:"replace",path:path+"/"+escapePathComponent(key),value:deepClone(newVal)}))}else patches.push({op:"remove",path:path+"/"+escapePathComponent(key)}),deleted=!0}if(deleted||newKeys.length!=oldKeys.length)for(t=0;t<newKeys.length;t++){var key=newKeys[t];mirror.hasOwnProperty(key)||patches.push({op:"add",path:path+"/"+escapePathComponent(key),value:deepClone(obj[key])})}}return module.exports=function compare(tree1,tree2){var patches=[];return _generate(tree1,tree2,patches,""),patches}}},_p[23]={value:function(require,exports,module){var keymap=_p.r(24);function hash(unknown){return"string"==typeof unknown?function hashKeyExpression(keyExpression){var hashCode=0;return keyExpression.toLowerCase().split(/\s*\+\s*/).forEach((function(name){switch(name){case"ctrl":case"cmd":hashCode|=4096;break;case"alt":hashCode|=8192;break;case"shift":hashCode|=16384;break;default:hashCode|=keymap[name]}})),hashCode}(unknown):function hashKeyEvent(keyEvent){var hashCode=0;(keyEvent.ctrlKey||keyEvent.metaKey)&&(hashCode|=4096);keyEvent.altKey&&(hashCode|=8192);keyEvent.shiftKey&&(hashCode|=16384);if(-1===[16,17,18,91].indexOf(keyEvent.keyCode)){if(229===keyEvent.keyCode&&keyEvent.keyIdentifier)return hashCode|parseInt(keyEvent.keyIdentifier.substr(2),16);hashCode|=keyEvent.keyCode}return hashCode}(unknown)}exports.hash=hash,exports.is=function is(a,b){return a&&b&&hash(a)==hash(b)}}},_p[24]={value:function(require,exports,module){var keymap={Shift:16,Control:17,Alt:18,CapsLock:20,BackSpace:8,Tab:9,Enter:13,Esc:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Insert:45,Left:37,Up:38,Right:39,Down:40,Direction:{37:1,38:1,39:1,40:1},Del:46,NumLock:144,Cmd:91,CmdFF:224,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"`":192,"=":187,"-":189,"/":191,".":190};for(var key in keymap)keymap.hasOwnProperty(key)&&(keymap[key.toLowerCase()]=keymap[key]);var aCharCode="a".charCodeAt(0);"abcdefghijklmnopqrstuvwxyz".split("").forEach((function(letter){keymap[letter]=letter.charCodeAt(0)-aCharCode+65}));var n=9;do{keymap[n.toString()]=n+48}while(--n);module.exports=keymap}};var moduleMapping={"expose-editor":1};!function use(name){_p.r([moduleMapping[name]])}("expose-editor")}()}}]);