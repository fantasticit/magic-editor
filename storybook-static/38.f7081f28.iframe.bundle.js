/*! For license information please see 38.f7081f28.iframe.bundle.js.LICENSE.txt */
(self.webpackChunkthink_single_editor=self.webpackChunkthink_single_editor||[]).push([[38],{"./src/extensions/mind/menu/kityminder/kityminder.core.js":(__unused_webpack_module,__unused_webpack_exports,__webpack_require__)=>{var process=__webpack_require__("./node_modules/.pnpm/process@0.11.10/node_modules/process/browser.js");!function(){var _p={r:function(index){if(_p[index].inited)return _p[index].value;if("function"!=typeof _p[index].value)return _p[index].inited=!0,_p[index].value;var module={exports:{}},returnValue=_p[index].value(null,module.exports,module);if(_p[index].inited=!0,_p[index].value=returnValue,void 0!==returnValue)return returnValue;for(var key in module.exports)if(module.exports.hasOwnProperty(key))return _p[index].inited=!0,_p[index].value=module.exports,module.exports}};_p[0]={value:function(require,exports,module){var kity=_p.r(17),connect=_p.r(11),connectMarker=(new kity.Marker).pipe((function(){var dot=new kity.Circle(6);this.addShape(dot),this.setRef(6,0).setViewBox(-7,-7,14,14).setWidth(7).setHeight(7),this.dot=dot,this.node.setAttribute("markerUnits","userSpaceOnUse")}));connect.register("arc",(function(node,parent,connection,width,color){var start,end,vector,box=node.getLayoutBox(),pBox=parent.getLayoutBox(),abs=Math.abs,pathData=[],side=box.x>pBox.x?"right":"left";node.getMinder().getPaper().addResource(connectMarker),start=new kity.Point(pBox.cx,pBox.cy),end="left"==side?new kity.Point(box.right+2,box.cy):new kity.Point(box.left-2,box.cy),vector=kity.Vector.fromPoints(start,end),pathData.push("M",start),pathData.push("A",abs(vector.x),abs(vector.y),0,0,vector.x*vector.y>0?0:1,end),connection.setMarker(connectMarker),connectMarker.dot.fill(color),connection.setPathData(pathData)}))}},_p[1]={value:function(require,exports,module){var kity=_p.r(17),connect=_p.r(11),connectMarker=(new kity.Marker).pipe((function(){var dot=new kity.Circle(6);this.addShape(dot),this.setRef(6,0).setViewBox(-7,-7,14,14).setWidth(7).setHeight(7),this.dot=dot,this.node.setAttribute("markerUnits","userSpaceOnUse")}));connect.register("arc_tp",(function(node,parent,connection,width,color){var start,end,end_box=node.getLayoutBox(),start_box=parent.getLayoutBox(),index=node.getIndex(),nextNode=parent.getChildren()[index+1];node.getIndex()>0&&(start_box=parent.getChildren()[index-1].getLayoutBox());Math.abs;var pathData=[];end_box.x,start_box.x;node.getMinder().getPaper().addResource(connectMarker),start=new kity.Point(start_box.cx,start_box.cy),end=new kity.Point(end_box.cx,end_box.cy);var jl=Math.sqrt(Math.pow(start.x-end.x,2)+Math.pow(start.y-end.y,2));if(jl=0==node.getIndex()?.4*jl:jl,kity.Vector.fromPoints(start,end),pathData.push("M",start),pathData.push("A",jl,jl,0,0,1,end),connection.setMarker(connectMarker),connectMarker.dot.fill(color),connection.setPathData(pathData),nextNode&&nextNode.getConnection()){var nextConnection=nextNode.getConnection(),next_end_box=nextNode.getLayoutBox(),next_end=new kity.Point(next_end_box.cx,next_end_box.cy),jl2=Math.sqrt(Math.pow(end.x-next_end.x,2)+Math.pow(end.y-next_end.y,2));(pathData=[]).push("M",end),pathData.push("A",jl2,jl2,0,0,1,next_end),nextConnection.setMarker(connectMarker),connectMarker.dot.fill(color),nextConnection.setPathData(pathData)}}))}},_p[2]={value:function(require,exports,module){_p.r(17);_p.r(11).register("bezier",(function(node,parent,connection){var po=parent.getLayoutVertexOut(),pi=node.getLayoutVertexIn(),v=parent.getLayoutVectorOut().normalize(),r=Math.round,abs=Math.abs,pathData=[];if(pathData.push("M",r(po.x),r(po.y)),abs(v.x)>abs(v.y)){var hx=(pi.x+po.x)/2;pathData.push("C",hx,po.y,hx,pi.y,pi.x,pi.y)}else{var hy=(pi.y+po.y)/2;pathData.push("C",po.x,hy,pi.x,hy,pi.x,pi.y)}connection.setMarker(null),connection.setPathData(pathData)}))}},_p[3]={value:function(require,exports,module){_p.r(17);_p.r(11).register("fish-bone-master",(function(node,parent,connection){var pout=parent.getLayoutVertexOut(),pin=node.getLayoutVertexIn(),abs=Math.abs,dy=abs(pout.y-pin.y),dx=abs(pout.x-pin.x),pathData=[];pathData.push("M",pout.x,pout.y),pathData.push("h",dx-dy),pathData.push("L",pin.x,pin.y),connection.setMarker(null),connection.setPathData(pathData)}))}},_p[4]={value:function(require,exports,module){_p.r(17);_p.r(11).register("l",(function(node,parent,connection){var po=parent.getLayoutVertexOut(),pi=node.getLayoutVertexIn(),vo=parent.getLayoutVectorOut(),pathData=[],r=Math.round,abs=Math.abs;pathData.push("M",po.round()),abs(vo.x)>abs(vo.y)?pathData.push("H",r(pi.x)):pathData.push("V",pi.y),pathData.push("L",pi),connection.setPathData(pathData)}))}},_p[5]={value:function(require,exports,module){_p.r(17);_p.r(11).register("poly",(function(node,parent,connection,width){var po=parent.getLayoutVertexOut(),pi=node.getLayoutVertexIn(),v=parent.getLayoutVectorOut().normalize(),r=Math.round,abs=Math.abs,pathData=[];switch(pathData.push("M",r(po.x),r(po.y)),!0){case abs(v.x)>abs(v.y)&&v.x<0:pathData.push("h",-parent.getStyle("margin-left")),pathData.push("v",pi.y-po.y),pathData.push("H",pi.x);break;case abs(v.x)>abs(v.y)&&v.x>=0:pathData.push("h",parent.getStyle("margin-right")),pathData.push("v",pi.y-po.y),pathData.push("H",pi.x);break;case abs(v.x)<=abs(v.y)&&v.y<0:pathData.push("v",-parent.getStyle("margin-top")),pathData.push("h",pi.x-po.x),pathData.push("V",pi.y);break;case abs(v.x)<=abs(v.y)&&v.y>=0:pathData.push("v",parent.getStyle("margin-bottom")),pathData.push("h",pi.x-po.x),pathData.push("V",pi.y)}connection.setMarker(null),connection.setPathData(pathData)}))}},_p[6]={value:function(require,exports,module){var kity=_p.r(17);_p.r(11).register("under",(function(node,parent,connection,width,color){var p1,p2,p3,mx,box=node.getLayoutBox(),pBox=parent.getLayoutBox(),pathData=(Math.abs,[]),side=box.x>pBox.x?"right":"left",underY=(node.getStyle("connect-radius"),box.bottom+3),startY="sub"==parent.getType()?pBox.bottom+3:pBox.cy;"right"==side?(p1=new kity.Point(pBox.right,startY),p2=new kity.Point(box.left-10,underY),p3=new kity.Point(box.right,underY)):(p1=new kity.Point(pBox.left,startY),p2=new kity.Point(box.right+10,underY),p3=new kity.Point(box.left,underY)),mx=(p1.x+p2.x)/2,pathData.push("M",p1),pathData.push("C",mx,p1.y,mx,p2.y,p2),pathData.push("L",p3),connection.setMarker(null),connection.setPathData(pathData)}))}},_p[7]={value:function(require,exports,module){var vrect,kity=_p.r(17),Minder=_p.r(19);-1!=location.href.indexOf("boxv")&&(Object.defineProperty(kity.Box.prototype,"visualization",{get:function(){return vrect?vrect.setBox(this):null}}),Minder.registerInitHook((function(){this.on("paperrender",(function(){(vrect=new kity.Rect).fill("rgba(200, 200, 200, .5)"),vrect.stroke("orange"),this.getRenderContainer().addShape(vrect)}))})))}},_p[8]={value:function(require,exports,module){var Minder=_p.r(19),animateDefaultOptions={enableAnimation:!0,layoutAnimationDuration:300,viewAnimationDuration:100,zoomAnimationDuration:300},resoredAnimationOptions={};Minder.registerInitHook((function(){this.setDefaultOptions(animateDefaultOptions),this.getOption("enableAnimation")||this.disableAnimation()})),Minder.prototype.enableAnimation=function(){for(var name in animateDefaultOptions)animateDefaultOptions.hasOwnProperty(name)&&this.setOption(resoredAnimationOptions[name])},Minder.prototype.disableAnimation=function(){for(var name in animateDefaultOptions)animateDefaultOptions.hasOwnProperty(name)&&(resoredAnimationOptions[name]=this.getOption(name),this.setOption(name,0))}}},_p[9]={value:function(require,exports,module){var kity=_p.r(17),Minder=(_p.r(33),_p.r(19)),MinderEvent=(_p.r(21),_p.r(13)),Command=kity.createClass("Command",{constructor:function(){this._isContentChange=!0,this._isSelectionChange=!1},execute:function(minder,args){throw new Error("Not Implement: Command.execute()")},setContentChanged:function(val){this._isContentChange=!!val},isContentChanged:function(){return this._isContentChange},setSelectionChanged:function(val){this._isSelectionChange=!!val},isSelectionChanged:function(){return this._isContentChange},queryState:function(km){return 0},queryValue:function(km){return 0},isNeedUndo:function(){return!0}});Command.STATE_NORMAL=0,Command.STATE_ACTIVE=1,Command.STATE_DISABLED=-1,kity.extendClass(Minder,{_getCommand:function(name){return this._commands[name.toLowerCase()]},_queryCommand:function(name,type,args){var cmd=this._getCommand(name);if(cmd){var queryCmd=cmd["query"+type];if(queryCmd)return queryCmd.apply(cmd,[this].concat(args))}return 0},queryCommandState:function(name){return this._queryCommand(name,"State",[].slice.call(arguments,1))},queryCommandValue:function(name){return this._queryCommand(name,"Value",[].slice.call(arguments,1))},execCommand:function(name){if(!name)return null;name=name.toLowerCase();var cmd,result,eventParams,cmdArgs=[].slice.call(arguments,1),me=this;return eventParams={command:cmd=this._getCommand(name),commandName:name.toLowerCase(),commandArgs:cmdArgs},!(!cmd||!~this.queryCommandState(name))&&(this._hasEnterExecCommand?(result=cmd.execute.apply(cmd,[me].concat(cmdArgs)),this._hasEnterExecCommand||this._interactChange()):(this._hasEnterExecCommand=!0,this._fire(new MinderEvent("beforeExecCommand",eventParams,!0))||(this._fire(new MinderEvent("preExecCommand",eventParams,!1)),result=cmd.execute.apply(cmd,[me].concat(cmdArgs)),this._fire(new MinderEvent("execCommand",eventParams,!1)),cmd.isContentChanged()&&this._firePharse(new MinderEvent("contentchange")),this._interactChange()),this._hasEnterExecCommand=!1),void 0===result?null:result)}}),module.exports=Command}},_p[10]={value:function(require,exports,module){_p.r(33);function traverse(node,fn){fn(node),node.children&&node.children.forEach((function(child){traverse(child,fn)}))}return function compatibility(json){switch(json.version||(json.root?"1.4.0":"1.1.3")){case"1.1.3":!function c_113_120(json){var ocs=json.data.currentstyle;delete json.data.currentstyle,"bottom"==ocs?(json.template="structure",json.theme="snow"):"default"==ocs&&(json.template="default",json.theme="classic");traverse(json,(function(node){var data=node.data;"PriorityIcon"in data&&(data.priority=data.PriorityIcon,delete data.PriorityIcon),"ProgressIcon"in data&&(data.progress=1+(data.ProgressIcon-1<<1),delete data.ProgressIcon),delete data.point,delete data.layout}))}(json);case"1.2.0":case"1.2.1":!function c_120_130(json){traverse(json,(function(node){var data=node.data;delete data.layout_bottom_offset,delete data.layout_default_offset,delete data.layout_filetree_offset}))}(json);case"1.3.0":case"1.3.1":case"1.3.2":case"1.3.3":case"1.3.4":case"1.3.5":!function c_130_140(json){json.root={data:json.data,children:json.children},delete json.data,delete json.children}(json)}return json}}},_p[11]={value:function(require,exports,module){var kity=_p.r(17),utils=_p.r(33),Module=_p.r(20),Minder=_p.r(19),MinderNode=_p.r(21),_connectProviders={};function register(name,provider){_connectProviders[name]=provider}register("default",(function(node,parent,connection){connection.setPathData(["M",parent.getLayoutVertexOut(),"L",node.getLayoutVertexIn()])})),kity.extendClass(MinderNode,{getConnect:function(){return this.data.connect||"default"},getConnectProvider:function(){return _connectProviders[this.getConnect()]||_connectProviders.default},getConnection:function(){return this._connection||null}}),kity.extendClass(Minder,{getConnectContainer:function(){return this._connectContainer},createConnect:function(node){if(!node.isRoot()){var connection=new kity.Path;node._connection=connection,this._connectContainer.addShape(connection),this.updateConnect(node)}},removeConnect:function(node){var me=this;node.traverse((function(node){me._connectContainer.removeShape(node._connection),node._connection=null}))},updateConnect:function(node){var connection=node._connection,parent=node.parent;if(parent&&connection)if(parent.isCollapsed())connection.setVisible(!1);else{connection.setVisible(!0);var provider=node.getConnectProvider(),strokeColor=node.getStyle("connect-color")||"white",strokeWidth=node.getStyle("connect-width")||2;connection.stroke(strokeColor,strokeWidth),provider(node,parent,connection,strokeWidth,strokeColor),strokeWidth%2==0?connection.setTranslate(.5,.5):connection.setTranslate(0,0)}}}),Module.register("Connect",{init:function(){this._connectContainer=(new kity.Group).setId(utils.uuid("minder_connect_group")),this.getRenderContainer().prependShape(this._connectContainer)},events:{nodeattach:function(e){this.createConnect(e.node)},nodedetach:function(e){this.removeConnect(e.node)},"layoutapply layoutfinish noderender":function(e){this.updateConnect(e.node)}}}),exports.register=register}},_p[12]={value:function(require,exports,module){var kity=_p.r(17),Minder=(_p.r(33),_p.r(19)),MinderEvent=(_p.r(21),_p.r(13)),compatibility=_p.r(10),Promise=_p.r(25),protocols={};exports.registerProtocol=function registerProtocol(name,protocol){for(var pname in protocols[name]=protocol,protocols)protocols.hasOwnProperty(pname)&&(protocols[pname]=protocols[pname],protocols[pname].name=pname)},exports.getRegisterProtocol=function getRegisterProtocol(name){return void 0===name?protocols:protocols[name]||null},kity.extendClass(Minder,{setup:function(target){if("string"==typeof target&&(target=document.querySelector(target)),target){var protocol=target.getAttribute("minder-data-type");if(protocol in protocols){var data=target.textContent;target.textContent=null,this.renderTo(target),this.importData(protocol,data)}return this}},exportJson:function(){var json={root:function exportNode(node){var exported={};exported.data=node.getData();var childNodes=node.getChildren();exported.children=[];for(var i=0;i<childNodes.length;i++)exported.children.push(exportNode(childNodes[i]));return exported}(this.getRoot())};return json.template=this.getTemplate(),json.theme=this.getTheme(),json.version=Minder.version,JSON.parse(JSON.stringify(json))},Text2Children:function(node,text){if(node instanceof kityminder.Node){for(var jsonNode,children=[],jsonMap={},level=0,TAB_REGEXP=/^(\t|\x20{4})/,lines=text.split(/\r|\n|\r\n/),line="",i=0,minder=this;void 0!==(line=lines[i++]);)if(!isEmpty(line=line.replace(/&nbsp;/g,"")))if(level=getLevel(line),jsonNode=getNode(line),0===level)jsonMap={},children.push(jsonNode),jsonMap[0]=children[children.length-1];else{if(!jsonMap[level-1])throw new Error("Invalid local format");addChild(jsonMap[level-1],jsonNode),jsonMap[level]=jsonNode}!function importChildren(node,children){for(var i=0,l=children.length;i<l;i++){var childNode=minder.createNode(null,node);childNode.setData("text",children[i].data.text||""),importChildren(childNode,children[i].children)}}(node,children),minder.refresh()}function isEmpty(line){return""===line&&!/\S/.test(line)}function getNode(line){return{data:{text:line.replace(/^(\t|\x20{4})+/,"").replace(/(\t|\x20{4})+$/,"")},children:[]}}function getLevel(text){for(var level=0;TAB_REGEXP.test(text);)text=text.replace(TAB_REGEXP,""),level++;return level}function addChild(parent,node){parent.children.push(node)}},exportNode:function(node){var exported={};exported.data=node.getData();var childNodes=node.getChildren();exported.children=[];for(var i=0;i<childNodes.length;i++)exported.children.push(this.exportNode(childNodes[i]));return exported},importNode:function(node,json){var data=json.data;for(var field in node.data={},data)node.setData(field,data[field]);for(var childrenTreeData=json.children||[],i=0;i<childrenTreeData.length;i++){var childNode=this.createNode(null,node);this.importNode(childNode,childrenTreeData[i])}return node},importJson:function(json){if(json){for(this._fire(new MinderEvent("preimport",null,!1));this._root.getChildren().length;)this.removeNode(this._root.getChildren()[0]);return json=compatibility(json),this.importNode(this._root,json.root),this.setTemplate(json.template||"default"),this.setTheme(json.theme||null),this.refresh(),this.fire("import"),this._firePharse({type:"contentchange"}),this._interactChange(),this}},exportData:function(protocolName,option){var json,protocol;return json=this.exportJson(),!protocolName||(protocol=protocols[protocolName])&&protocol.encode?(this._fire(new MinderEvent("beforeexport",{json,protocolName,protocol})),Promise.resolve(protocol.encode(json,this,option))):Promise.reject(new Error("Not supported protocol:"+protocolName))},importData:function(protocolName,data,option){var protocol,minder=this;if(protocolName&&(!(protocol=protocols[protocolName])||!protocol.decode))return Promise.reject(new Error("Not supported protocol:"+protocolName));var params={local:data,protocolName,protocol};return this._fire(new MinderEvent("beforeimport",params)),Promise.resolve(protocol.decode(data,this,option)).then((function(json){return minder.importJson(json),json}))},decodeData:function(protocolName,data,option){var protocol;if(protocolName&&(!(protocol=protocols[protocolName])||!protocol.decode))return Promise.reject(new Error("Not supported protocol:"+protocolName));var params={local:data,protocolName,protocol};return this._fire(new MinderEvent("beforeimport",params)),Promise.resolve(protocol.decode(data,this,option))}})}},_p[13]={value:function(require,exports,module){var kity=_p.r(17),Minder=(_p.r(33),_p.r(19)),MinderEvent=kity.createClass("MindEvent",{constructor:function(type,params,canstop){(params=params||{}).getType&&"ShapeEvent"==params.getType()?(this.kityEvent=params,this.originEvent=params.originEvent):params.target&&params.preventDefault?this.originEvent=params:kity.Utils.extend(this,params),this.type=type,this._canstop=canstop||!1},getPosition:function(refer){if(this.kityEvent)return refer&&"minder"!=refer?this.kityEvent.getPosition.call(this.kityEvent,refer):this.kityEvent.getPosition(this.minder.getRenderContainer())},getTargetNode:function(){var findShape=this.kityEvent&&this.kityEvent.targetShape;if(!findShape)return null;for(;!findShape.minderNode&&findShape.container;)findShape=findShape.container;var node=findShape.minderNode;return node&&findShape.getOpacity()<1?null:node||null},stopPropagation:function(){this._stoped=!0},stopPropagationImmediately:function(){this._immediatelyStoped=!0,this._stoped=!0},shouldStopPropagation:function(){return this._canstop&&this._stoped},shouldStopPropagationImmediately:function(){return this._canstop&&this._immediatelyStoped},preventDefault:function(){this.originEvent.preventDefault()},isRightMB:function(){var isRightMB=!1;return!!this.originEvent&&("which"in this.originEvent?isRightMB=3==this.originEvent.which:"button"in this.originEvent&&(isRightMB=2==this.originEvent.button),isRightMB)},getKeyCode:function(){var evt=this.originEvent;return evt.keyCode||evt.which}});Minder.registerInitHook((function(option){this._initEvents()})),kity.extendClass(Minder,{_initEvents:function(){this._eventCallbacks={}},_resetEvents:function(){this._initEvents(),this._bindEvents()},_bindEvents:function(){this._paper.on("click dblclick mousedown contextmenu mouseup mousemove mouseover mousewheel DOMMouseScroll touchstart touchmove touchend dragenter dragleave drop",this._firePharse.bind(this)),window&&window.addEventListener("resize",this._firePharse.bind(this))},dispatchKeyEvent:function(e){this._firePharse(e)},_firePharse:function(e){var beforeEvent,preEvent,executeEvent;"DOMMouseScroll"==e.type&&(e.type="mousewheel",e.wheelDelta=e.originEvent.wheelDelta=-10*e.originEvent.detail,e.wheelDeltaX=e.originEvent.mozMovementX,e.wheelDeltaY=e.originEvent.mozMovementY),beforeEvent=new MinderEvent("before"+e.type,e,!0),this._fire(beforeEvent)||(preEvent=new MinderEvent("pre"+e.type,e,!0),executeEvent=new MinderEvent(e.type,e,!0),(this._fire(preEvent)||this._fire(executeEvent))&&this._fire(new MinderEvent("after"+e.type,e,!1)))},_interactChange:function(e){var me=this;me._interactScheduled||(setTimeout((function(){me._fire(new MinderEvent("interactchange")),me._interactScheduled=!1}),100),me._interactScheduled=!0)},_listen:function(type,callback){(this._eventCallbacks[type]||(this._eventCallbacks[type]=[])).push(callback)},_fire:function(e){e.minder=this;var status=this.getStatus(),callbacks=this._eventCallbacks[e.type.toLowerCase()]||[];if(status&&(callbacks=callbacks.concat(this._eventCallbacks[status+"."+e.type.toLowerCase()]||[])),0!==callbacks.length){this.getStatus();for(var i=0;i<callbacks.length&&(callbacks[i].call(this,e),!e.shouldStopPropagationImmediately());i++);return e.shouldStopPropagation()}},on:function(name,callback){var km=this;return name.split(/\s+/).forEach((function(n){km._listen(n.toLowerCase(),callback)})),this},off:function(name,callback){var i,j,callbacks,removeIndex,types=name.split(/\s+/);for(i=0;i<types.length;i++)if(callbacks=this._eventCallbacks[types[i].toLowerCase()]){for(removeIndex=null,j=0;j<callbacks.length;j++)callbacks[j]==callback&&(removeIndex=j);null!==removeIndex&&callbacks.splice(removeIndex,1)}},fire:function(type,params){var e=new MinderEvent(type,params);return this._fire(e),this}}),module.exports=MinderEvent}},_p[14]={value:function(require,exports,module){var kity=_p.r(17),Minder=_p.r(19);Minder.registerInitHook((function(){this.on("beforemousedown",(function(e){this.focus(),e.preventDefault()})),this.on("paperrender",(function(){this.focus()}))})),kity.extendClass(Minder,{focus:function(){this.isFocused()||(this._renderTarget.classList.add("focus"),this.renderNodeBatch(this.getSelectedNodes()));return this.fire("focus"),this},blur:function(){this.isFocused()&&(this._renderTarget.classList.remove("focus"),this.renderNodeBatch(this.getSelectedNodes()));return this.fire("blur"),this},isFocused:function(){var renderTarget=this._renderTarget;return renderTarget&&renderTarget.classList.contains("focus")}})}},_p[15]={value:function(require,exports,module){var keymap={Backspace:8,Tab:9,Enter:13,Shift:16,Control:17,Alt:18,CapsLock:20,Esc:27,Spacebar:32,PageUp:33,PageDown:34,End:35,Home:36,Insert:45,Left:37,Up:38,Right:39,Down:40,direction:{37:1,38:1,39:1,40:1},Del:46,NumLock:144,Cmd:91,CmdFF:224,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"`":192,"=":187,"-":189,"/":191,".":190,controlKeys:{16:1,17:1,18:1,20:1,91:1,224:1},notContentChange:{13:1,9:1,33:1,34:1,35:1,36:1,16:1,17:1,18:1,20:1,91:1,37:1,38:1,39:1,40:1,113:1,114:1,115:1,144:1,27:1},isSelectedNodeKey:{37:1,38:1,39:1,40:1,13:1,9:1}};for(var key in keymap)keymap.hasOwnProperty(key)&&(keymap[key.toLowerCase()]=keymap[key]);var aCharCode="a".charCodeAt(0);"abcdefghijklmnopqrstuvwxyz".split("").forEach((function(letter){keymap[letter]=letter.charCodeAt(0)-aCharCode+65}));var n=9;do{keymap[n.toString()]=n+48}while(--n);module.exports=keymap}},_p[16]={value:function(require,exports,module){var kity=_p.r(17),Minder=(_p.r(33),_p.r(19));Minder.registerInitHook((function(option){this.setDefaultOptions({enableKeyReceiver:!0}),this.getOption("enableKeyReceiver")&&this.on("paperrender",(function(){this._initKeyReceiver()}))})),kity.extendClass(Minder,{_initKeyReceiver:function(){if(!this._keyReceiver){var receiver=this._keyReceiver=document.createElement("input");receiver.classList.add("km-receiver"),this._renderTarget.appendChild(receiver);var minder=this;!function listen(element,type,handler){type.split(" ").forEach((function(name){element.addEventListener(name,handler,!1)}))}(receiver,"keydown keyup keypress copy paste blur focus input",(function(e){switch(e.type){case"blur":minder.blur();break;case"focus":minder.focus();break;case"input":receiver.value=null}minder._firePharse(e),e.preventDefault()})),this.on("focus",(function(){receiver.select(),receiver.focus()})),this.on("blur",(function(){receiver.blur()})),this.isFocused()&&(receiver.select(),receiver.focus())}}})}},_p[17]={value:function(require,exports,module){module.exports=window.kity}},_p[18]={value:function(require,exports,module){var _defaultLayout,kity=_p.r(17),utils=_p.r(33),Minder=_p.r(19),MinderNode=_p.r(21),_layouts=(_p.r(13),_p.r(9),{});var Layout=kity.createClass("Layout",{doLayout:function(parent,children){throw new Error("Not Implement: Layout.doLayout()")},align:function(nodes,border,offset){var me=this;offset=offset||0,nodes.forEach((function(node){var tbox=me.getTreeBox([node]),matrix=node.getLayoutTransform();switch(border){case"left":return matrix.translate(offset-tbox.left,0);case"right":return matrix.translate(offset-tbox.right,0);case"top":return matrix.translate(0,offset-tbox.top);case"bottom":return matrix.translate(0,offset-tbox.bottom)}}))},stack:function(nodes,axis,distance){var me=this,position=0;return distance=distance||function(node,next,axis){return node.getStyle({x:"margin-right",y:"margin-bottom"}[axis])+next.getStyle({x:"margin-left",y:"margin-top"}[axis])},nodes.forEach((function(node,index,nodes){var tbox=me.getTreeBox([node]),size={x:tbox.width,y:tbox.height}[axis],offset={x:tbox.left,y:tbox.top}[axis],matrix=node.getLayoutTransform();"x"==axis?matrix.translate(position-offset,0):matrix.translate(0,position-offset),position+=size,nodes[index+1]&&(position+=distance(node,nodes[index+1],axis))})),position},move:function(nodes,dx,dy){nodes.forEach((function(node){node.getLayoutTransform().translate(dx,dy)}))},getBranchBox:function(nodes){var i,node,matrix,contentBox,box=new kity.Box;for(i=0;i<nodes.length;i++)matrix=(node=nodes[i]).getLayoutTransform(),contentBox=node.getContentBox(),box=box.merge(matrix.transformBox(contentBox));return box},getTreeBox:function(nodes){var i,node,matrix,treeBox,box=new kity.Box;for(nodes instanceof Array||(nodes=[nodes]),i=0;i<nodes.length;i++)matrix=(node=nodes[i]).getLayoutTransform(),treeBox=node.getContentBox(),node.isExpanded()&&node.children.length&&(treeBox=treeBox.merge(this.getTreeBox(node.children))),box=box.merge(matrix.transformBox(treeBox));return box},getOrderHint:function(node){return[]}});Layout.register=function register(name,layout){_layouts[name]=layout,_defaultLayout=_defaultLayout||name},Minder.registerInitHook((function(options){this.refresh()})),utils.extend(Minder,{getLayoutList:function(){return _layouts},getLayoutInstance:function(name){var LayoutClass=_layouts[name];if(!LayoutClass)throw new Error("Missing Layout: "+name);return new LayoutClass}}),kity.extendClass(MinderNode,{getLayout:function(){var layout=this.getData("layout");return layout=layout||(this.isRoot()?_defaultLayout:this.parent.getLayout())},setLayout:function(name){return name&&("inherit"==name?this.setData("layout"):this.setData("layout",name)),this},layout:function(name){return this.setLayout(name).getMinder().layout(),this},getLayoutInstance:function(){return Minder.getLayoutInstance(this.getLayout())},getOrderHint:function(refer){return this.parent.getLayoutInstance().getOrderHint(this)},getLayoutTransform:function(){return this._layoutTransform||new kity.Matrix},getGlobalLayoutTransformPreview:function(){var pMatrix=this.parent?this.parent.getLayoutTransform():new kity.Matrix,matrix=this.getLayoutTransform(),offset=this.getLayoutOffset();return offset&&(matrix=matrix.clone().translate(offset.x,offset.y)),pMatrix.merge(matrix)},getLayoutPointPreview:function(){return this.getGlobalLayoutTransformPreview().transformPoint(new kity.Point)},getGlobalLayoutTransform:function(){return this._globalLayoutTransform?this._globalLayoutTransform:this.parent?this.parent.getGlobalLayoutTransform():new kity.Matrix},setLayoutTransform:function(matrix){return this._layoutTransform=matrix,this},setGlobalLayoutTransform:function(matrix){return this.getRenderContainer().setMatrix(this._globalLayoutTransform=matrix),this},setVertexIn:function(p){this._vertexIn=p},setVertexOut:function(p){this._vertexOut=p},getVertexIn:function(){return this._vertexIn||new kity.Point},getVertexOut:function(){return this._vertexOut||new kity.Point},getLayoutVertexIn:function(){return this.getGlobalLayoutTransform().transformPoint(this.getVertexIn())},getLayoutVertexOut:function(){return this.getGlobalLayoutTransform().transformPoint(this.getVertexOut())},setLayoutVectorIn:function(v){return this._layoutVectorIn=v,this},setLayoutVectorOut:function(v){return this._layoutVectorOut=v,this},getLayoutVectorIn:function(){return this._layoutVectorIn||new kity.Vector},getLayoutVectorOut:function(){return this._layoutVectorOut||new kity.Vector},getLayoutBox:function(){return this.getGlobalLayoutTransform().transformBox(this.getContentBox())},getLayoutPoint:function(){return this.getGlobalLayoutTransform().transformPoint(new kity.Point)},getLayoutOffset:function(){if(!this.parent)return new kity.Point;var data=this.getData("layout_"+this.parent.getLayout()+"_offset");return data?new kity.Point(data.x,data.y):new kity.Point},setLayoutOffset:function(p){return this.parent?(this.setData("layout_"+this.parent.getLayout()+"_offset",p?{x:p.x,y:p.y}:void 0),this):this},hasLayoutOffset:function(){return!!this.getData("layout_"+this.parent.getLayout()+"_offset")},resetLayoutOffset:function(){return this.setLayoutOffset(null)},getLayoutRoot:function(){return this.isLayoutRoot()?this:this.parent.getLayoutRoot()},isLayoutRoot:function(){return this.getData("layout")||this.isRoot()}}),kity.extendClass(Minder,{layout:function(){var duration=this.getOption("layoutAnimationDuration");function layoutNode(node,round){node.isExpanded(),node.children.forEach((function(child){layoutNode(child,round)})),node.getLayoutInstance().doLayout(node,node.getChildren(),round)}this.getRoot().traverse((function(node){node.setLayoutTransform(null)})),layoutNode(this.getRoot(),1),layoutNode(this.getRoot(),2);var minder=this;return this.applyLayoutResult(this.getRoot(),duration,(function(){setTimeout((function(){minder.fire("layoutallfinish")}),0)})),this.fire("layout")},refresh:function(){return this.getRoot().renderTree(),this.layout().fire("contentchange")._interactChange(),this},applyLayoutResult:function(root,duration,callback){root=root||this.getRoot();var me=this,complex=root.getComplex();function consume(){--complex||callback&&callback()}function applyMatrix(node,matrix){node.setGlobalLayoutTransform(matrix),me.fire("layoutapply",{node,matrix})}return complex>200&&(duration=0),function apply(node,pMatrix){var matrix=node.getLayoutTransform().merge(pMatrix.clone()),lastMatrix=node.getGlobalLayoutTransform()||new kity.Matrix,offset=node.getLayoutOffset();matrix.translate(offset.x,offset.y),matrix.m.e=Math.round(matrix.m.e),matrix.m.f=Math.round(matrix.m.f),node._layoutTimeline&&(node._layoutTimeline.stop(),node._layoutTimeline=null),duration?node._layoutTimeline=new kity.Animator(lastMatrix,matrix,applyMatrix).start(node,duration,"ease").on("finish",(function(){setTimeout((function(){applyMatrix(node,matrix),me.fire("layoutfinish",{node,matrix}),consume()}),150)})):(applyMatrix(node,matrix),me.fire("layoutfinish",{node,matrix}),consume());for(var i=0;i<node.children.length;i++)apply(node.children[i],matrix)}(root,root.parent?root.parent.getGlobalLayoutTransform():new kity.Matrix),this}}),module.exports=Layout}},_p[19]={value:function(require,exports,module){var kity=_p.r(17),utils=_p.r(33),_initHooks=[],Minder=kity.createClass("Minder",{constructor:function(options){this._options=utils.extend({},options);for(var initHook,initHooks=_initHooks.slice();initHooks.length;)"function"==typeof(initHook=initHooks.shift())&&initHook.call(this,this._options);this.fire("finishInitHook")}});Minder.version="1.4.43",Minder.registerInitHook=function(hook){_initHooks.push(hook)},module.exports=Minder}},_p[20]={value:function(require,exports,module){var kity=_p.r(17),utils=_p.r(33),Minder=_p.r(19),_modules={};exports.register=function(name,module){_modules[name]=module},Minder.registerInitHook((function(){this._initModules()})),kity.extendClass(Minder,{_initModules:function(){var i,name,type,moduleDeals,dealCommands,dealEvents,dealRenderers,modulesPool=_modules,modulesToLoad=this._options.modules||utils.keys(modulesPool);this._commands={},this._query={},this._modules={},this._rendererClasses={};for(i=0;i<modulesToLoad.length;i++)if(modulesPool[name=modulesToLoad[i]]&&(moduleDeals="function"==typeof modulesPool[name]?modulesPool[name].call(this):modulesPool[name],this._modules[name]=moduleDeals,moduleDeals)){for(name in moduleDeals.defaultOptions&&this.setDefaultOptions(moduleDeals.defaultOptions),moduleDeals.init&&moduleDeals.init.call(this,this._options),dealCommands=moduleDeals.commands)this._commands[name.toLowerCase()]=new dealCommands[name];if(dealEvents=moduleDeals.events)for(type in dealEvents)this.on(type,dealEvents[type]);if(dealRenderers=moduleDeals.renderers)for(type in dealRenderers)this._rendererClasses[type]=this._rendererClasses[type]||[],utils.isArray(dealRenderers[type])?this._rendererClasses[type]=this._rendererClasses[type].concat(dealRenderers[type]):this._rendererClasses[type].push(dealRenderers[type]);moduleDeals.commandShortcutKeys&&this.addCommandShortcutKeys(moduleDeals.commandShortcutKeys)}},_garbage:function(){for(this.clearSelect();this._root.getChildren().length;)this._root.removeChild(0)},destroy:function(){var modules=this._modules;for(var key in this._resetEvents(),this._garbage(),modules)modules[key].destroy&&modules[key].destroy.call(this)},reset:function(){var modules=this._modules;for(var key in this._garbage(),modules)modules[key].reset&&modules[key].reset.call(this)}})}},_p[21]={value:function(require,exports,module){var kity=_p.r(17),utils=_p.r(33),Minder=_p.r(19),MinderNode=kity.createClass("MinderNode",{constructor:function(textOrData){this.parent=null,this.root=this,this.children=[],this.data={id:utils.guid(),created:+new Date},this.initContainers(),utils.isString(textOrData)?this.setText(textOrData):utils.isObject(textOrData)&&utils.extend(this.data,textOrData)},initContainers:function(){this.rc=(new kity.Group).setId(utils.uuid("minder_node")),this.rc.minderNode=this},isRoot:function(){return this.root===this},isLeaf:function(){return 0===this.children.length},getRoot:function(){return this.root||this},getParent:function(){return this.parent},getSiblings:function(){var children=this.parent.children,siblings=[],self=this;return children.forEach((function(child){child!=self&&siblings.push(child)})),siblings},getLevel:function(){for(var level=0,ancestor=this.parent;ancestor;)level++,ancestor=ancestor.parent;return level},getComplex:function(){var complex=0;return this.traverse((function(){complex++})),complex},getType:function(type){return this.type=["root","main","sub"][Math.min(this.getLevel(),2)],this.type},isAncestorOf:function(test){for(var ancestor=test.parent;ancestor;){if(ancestor==this)return!0;ancestor=ancestor.parent}return!1},getData:function(key){return key?this.data[key]:this.data},setData:function(key,value){if("object"==typeof key){var data=key;for(key in data)data.hasOwnProperty(key)&&(this.data[key]=data[key])}else this.data[key]=value;return this},setText:function(text){return this.data.text=text},getText:function(){return this.data.text||null},preTraverse:function(fn,excludeThis){var children=this.getChildren();excludeThis||fn(this);for(var i=0;i<children.length;i++)children[i].preTraverse(fn)},postTraverse:function(fn,excludeThis){for(var children=this.getChildren(),i=0;i<children.length;i++)children[i].postTraverse(fn);excludeThis||fn(this)},traverse:function(fn,excludeThis){return this.postTraverse(fn,excludeThis)},getChildren:function(){return this.children},getIndex:function(){return this.parent?this.parent.children.indexOf(this):-1},insertChild:function(node,index){void 0===index&&(index=this.children.length),node.parent&&node.parent.removeChild(node),node.parent=this,node.root=this.root,this.children.splice(index,0,node)},appendChild:function(node){return this.insertChild(node)},prependChild:function(node){return this.insertChild(node,0)},removeChild:function(elem){var removed,index=elem;elem instanceof MinderNode&&(index=this.children.indexOf(elem)),index>=0&&((removed=this.children.splice(index,1)[0]).parent=null,removed.root=removed)},clearChildren:function(){this.children=[]},getChild:function(index){return this.children[index]},getRenderContainer:function(){return this.rc},getCommonAncestor:function(node){return MinderNode.getCommonAncestor(this,node)},contains:function(node){return this==node||this.isAncestorOf(node)},clone:function(){var cloned=new MinderNode;return cloned.data=utils.clone(this.data),this.children.forEach((function(child){cloned.appendChild(child.clone())})),cloned},compareTo:function(node){if(!utils.comparePlainObject(this.data,node.data))return!1;if(!utils.comparePlainObject(this.temp,node.temp))return!1;if(this.children.length!=node.children.length)return!1;for(var i=0;this.children[i];){if(!this.children[i].compareTo(node.children[i]))return!1;i++}return!0},getMinder:function(){return this.getRoot().minder}});MinderNode.getCommonAncestor=function(nodeA,nodeB){if(nodeA instanceof Array)return MinderNode.getCommonAncestor.apply(this,nodeA);switch(arguments.length){case 1:return nodeA.parent||nodeA;case 2:if(nodeA.isAncestorOf(nodeB))return nodeA;if(nodeB.isAncestorOf(nodeA))return nodeB;for(var ancestor=nodeA.parent;ancestor&&!ancestor.isAncestorOf(nodeB);)ancestor=ancestor.parent;return ancestor;default:return Array.prototype.reduce.call(arguments,(function(prev,current){return MinderNode.getCommonAncestor(prev,current)}),nodeA)}},kity.extendClass(Minder,{getRoot:function(){return this._root},setRoot:function(root){this._root=root,root.minder=this},getAllNode:function(){var nodes=[];return this.getRoot().traverse((function(node){nodes.push(node)})),nodes},getNodeById:function(id){return this.getNodesById([id])[0]},getNodesById:function(ids){var nodes=this.getAllNode(),result=[];return nodes.forEach((function(node){-1!=ids.indexOf(node.getData("id"))&&result.push(node)})),result},createNode:function(textOrData,parent,index){var node=new MinderNode(textOrData);return this.fire("nodecreate",{node,parent,index}),this.appendNode(node,parent,index),node},appendNode:function(node,parent,index){return parent&&parent.insertChild(node,index),this.attachNode(node),this},removeNode:function(node){node.parent&&(node.parent.removeChild(node),this.detachNode(node),this.fire("noderemove",{node}))},attachNode:function(node){var rc=this.getRenderContainer();node.traverse((function(current){current.attached=!0,rc.addShape(current.getRenderContainer())})),rc.addShape(node.getRenderContainer()),this.fire("nodeattach",{node})},detachNode:function(node){var rc=this.getRenderContainer();node.traverse((function(current){current.attached=!1,rc.removeShape(current.getRenderContainer())})),this.fire("nodedetach",{node})},getMinderTitle:function(){return this.getRoot().getText()}}),module.exports=MinderNode}},_p[22]={value:function(require,exports,module){var kity=_p.r(17),utils=_p.r(33),Minder=_p.r(19);Minder.registerInitHook((function(options){this._defaultOptions={}})),kity.extendClass(Minder,{setDefaultOptions:function(options){return utils.extend(this._defaultOptions,options),this},getOption:function(key){return key?key in this._options?this._options[key]:this._defaultOptions[key]:utils.extend({},this._defaultOptions,this._options)},setOption:function(key,value){this._options[key]=value}})}},_p[23]={value:function(require,exports,module){var kity=_p.r(17),utils=_p.r(33),Minder=_p.r(19);Minder.registerInitHook((function(){this._initPaper()})),kity.extendClass(Minder,{_initPaper:function(){this._paper=new kity.Paper,this._paper._minder=this,this._paper.getNode().ondragstart=function(e){e.preventDefault()},this._paper.shapeNode.setAttribute("transform","translate(0.5, 0.5)"),this._addRenderContainer(),this.setRoot(this.createNode()),this._options.renderTo&&this.renderTo(this._options.renderTo)},_addRenderContainer:function(){this._rc=(new kity.Group).setId(utils.uuid("minder")),this._paper.addShape(this._rc)},renderTo:function(target){if("string"==typeof target&&(target=document.querySelector(target)),target){if("script"==target.tagName.toLowerCase()){var newTarget=document.createElement("div");newTarget.id=target.id,newTarget.class=target.class,target.parentNode.insertBefore(newTarget,target),target.parentNode.removeChild(target),target=newTarget}target.classList.add("km-view"),this._paper.renderTo(this._renderTarget=target),this._bindEvents(),this.fire("paperrender")}return this},getRenderContainer:function(){return this._rc},getPaper:function(){return this._paper},getRenderTarget:function(){return this._renderTarget}})}},_p[24]={value:function(require,exports,module){var kity=_p.r(17),Minder=_p.r(19);function insertNode(minder,info,parent,index){return parent=minder.createNode(info.data,parent,index),info.children.forEach((function(childInfo,index){insertNode(minder,childInfo,parent,index)})),parent}function applyPatch(minder,patch){var path=patch.path.split("/");path.shift();var node,changed=path.shift();if("root"==changed){var segment,index,dataIndex=path.indexOf("data");if(dataIndex>-1){changed="data";var dataPath=path.splice(dataIndex+1);patch.dataPath=dataPath}else changed="node";for(node=minder.getRoot();segment=path.shift();)"children"!=segment&&(void 0!==index&&(node=node.getChild(index)),index=+segment);patch.index=index,patch.node=node}switch(patch.express=[changed,patch.op].join(".")){case"theme.replace":minder.useTheme(patch.value);break;case"template.replace":minder.useTemplate(patch.value);break;case"node.add":insertNode(minder,patch.value,patch.node,patch.index).renderTree(),minder.layout();break;case"node.remove":minder.removeNode(patch.node.getChild(patch.index)),minder.layout();break;case"data.add":case"data.replace":case"data.remove":var field,data=patch.node.data;for(path=patch.dataPath.slice();data&&path.length>1;)(field=path.shift())in data?data=data[field]:"remove"!=patch.op&&(data=data[field]={});data&&(data[field=path.shift()]=patch.value),"expandState"==field?node.renderTree():node.render(),minder.layout()}minder.fire("patch",{patch})}kity.extendClass(Minder,{applyPatches:function(patches){for(var i=0;i<patches.length;i++)applyPatch(this,patches[i]);return this.fire("contentchange"),this}})}},_p[25]={value:function(require,exports,module){var Promise=function(executor){if(!(this instanceof Promise))return new Promise(executor);this.id="Thenable/1.0.7",this.state=0,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],"function"==typeof executor&&executor.call(this,this.fulfill.bind(this),this.reject.bind(this))};Promise.prototype={fulfill:function(value){return deliver(this,1,"fulfillValue",value)},reject:function(value){return deliver(this,2,"rejectReason",value)},then:function(onFulfilled,onRejected){var next=new Promise;return this.onFulfilled.push(resolver(onFulfilled,next,"fulfill")),this.onRejected.push(resolver(onRejected,next,"reject")),execute(this),next}},Promise.all=function(arr){return new Promise((function(resolve,reject){var len=arr.length,i=0,res=0,results=[];for(0===len&&resolve(results);i<len;)arr[i].then((function(result){results.push(result),++res===len&&resolve(results)}),(function(val){reject(val)})),i++}))};var deliver=function(curr,state,name,value){return 0===curr.state&&(curr.state=state,curr[name]=value,execute(curr)),curr},execute=function(curr){1===curr.state?execute_handlers(curr,"onFulfilled",curr.fulfillValue):2===curr.state&&execute_handlers(curr,"onRejected",curr.rejectReason)},execute_handlers=function(curr,name,value){if(0!==curr[name].length){var handlers=curr[name];curr[name]=[];var func=function(){for(var i=0;i<handlers.length;i++)handlers[i](value)};"object"==typeof process&&"function"==typeof process.nextTick?process.nextTick(func):"function"==typeof setImmediate?setImmediate(func):setTimeout(func,0)}},resolver=function(cb,next,method){return function(value){if("function"!=typeof cb)next[method].call(next,value);else{var result;try{result=value instanceof Promise?value.then(cb):cb(value)}catch(e){return void next.reject(e)}resolve(next,result)}}},resolve=function(promise,x){if(promise!==x){var then;if("object"==typeof x&&null!==x||"function"==typeof x)try{then=x.then}catch(e){return void promise.reject(e)}if("function"!=typeof then)promise.fulfill(x);else{var resolved=!1;try{then.call(x,(function(y){resolved||(resolved=!0,y===x?promise.reject(new TypeError("circular thenable chain")):resolve(promise,y))}),(function(r){resolved||(resolved=!0,promise.reject(r))}))}catch(e){resolved||promise.reject(e)}}}else promise.reject(new TypeError("cannot resolve promise with itself"))};Promise.resolve=function(value){return new Promise((function(resolve){resolve(value)}))},Promise.reject=function(reason){return new Promise((function(resolve,reject){reject(reason)}))},module.exports=Promise}},_p[26]={value:function(require,exports,module){var kity=_p.r(17),Minder=_p.r(19);_p.r(13);Minder.registerInitHook((function(options){options.readOnly&&this.setDisabled()})),kity.extendClass(Minder,{disable:function(){var me=this;me.bkqueryCommandState=me.queryCommandState,me.bkqueryCommandValue=me.queryCommandValue,me.queryCommandState=function(type){var cmd=this._getCommand(type);return cmd&&cmd.enableReadOnly?me.bkqueryCommandState.apply(me,arguments):-1},me.queryCommandValue=function(type){var cmd=this._getCommand(type);return cmd&&cmd.enableReadOnly?me.bkqueryCommandValue.apply(me,arguments):null},this.setStatus("readonly"),me._interactChange()},enable:function(){var me=this;me.bkqueryCommandState&&(me.queryCommandState=me.bkqueryCommandState,delete me.bkqueryCommandState),me.bkqueryCommandValue&&(me.queryCommandValue=me.bkqueryCommandValue,delete me.bkqueryCommandValue),this.setStatus("normal"),me._interactChange()}})}},_p[27]={value:function(require,exports,module){var kity=_p.r(17),Minder=_p.r(19),MinderNode=_p.r(21),Renderer=kity.createClass("Renderer",{constructor:function(node){this.node=node},create:function(node){throw new Error("Not implement: Renderer.create()")},shouldRender:function(node){return!0},watchChange:function(data){void 0===this.watchingData||this.watchingData,this.watchingData=data},shouldDraw:function(node){return!0},update:function(shape,node,box){return this.shouldDraw()&&this.draw(shape,node),this.place(shape,node,box)},draw:function(shape,node){throw new Error("Not implement: Renderer.draw()")},place:function(shape,node,box){throw new Error("Not implement: Renderer.place()")},getRenderShape:function(){return this._renderShape||null},setRenderShape:function(shape){this._renderShape=shape}});kity.extendClass(Minder,function createMinderExtension(){function createRendererForNode(node,registered){var renderers=[];["center","left","right","top","bottom","outline","outside"].forEach((function(section){var before="before"+section,after="after"+section;registered[before]&&(renderers=renderers.concat(registered[before])),registered[section]&&(renderers=renderers.concat(registered[section])),registered[after]&&(renderers=renderers.concat(registered[after]))})),node._renderers=renderers.map((function(Renderer){return new Renderer(node)}))}return{renderNodeBatch:function(nodes){var rendererCount,i,j,renderer,node,rendererClasses=this._rendererClasses,lastBoxes=[];if(nodes.length){for(j=0;j<nodes.length;j++)(node=nodes[j])._renderers||createRendererForNode(node,rendererClasses),node._contentBox=new kity.Box,this.fire("beforerender",{node});for(rendererCount=nodes[0]._renderers.length,i=0;i<rendererCount;i++){for(j=0;j<nodes.length;j++)"function"==typeof lastBoxes[j]&&(lastBoxes[j]=lastBoxes[j]()),lastBoxes[j]instanceof kity.Box||(lastBoxes[j]=new kity.Box(lastBoxes[j]));for(j=0;j<nodes.length;j++)renderer=(node=nodes[j])._renderers[i],lastBoxes[j]&&(node._contentBox=node._contentBox.merge(lastBoxes[j]),renderer.contentBox=lastBoxes[j]),renderer.shouldRender(node)?(renderer.getRenderShape()||(renderer.setRenderShape(renderer.create(node)),renderer.bringToBack?node.getRenderContainer().prependShape(renderer.getRenderShape()):node.getRenderContainer().appendShape(renderer.getRenderShape())),renderer.getRenderShape().setVisible(!0),lastBoxes[j]=renderer.update(renderer.getRenderShape(),node,node._contentBox)):renderer.getRenderShape()&&(renderer.getRenderShape().setVisible(!1),lastBoxes[j]=null)}for(j=0;j<nodes.length;j++)this.fire("noderender",{node:nodes[j]})}},renderNode:function(node){var latestBox,rendererClasses=this._rendererClasses;node._renderers||createRendererForNode(node,rendererClasses),this.fire("beforerender",{node}),node._contentBox=new kity.Box,node._renderers.forEach((function(renderer){renderer.shouldRender(node)?(renderer.getRenderShape()||(renderer.setRenderShape(renderer.create(node)),renderer.bringToBack?node.getRenderContainer().prependShape(renderer.getRenderShape()):node.getRenderContainer().appendShape(renderer.getRenderShape())),renderer.getRenderShape().setVisible(!0),"function"==typeof(latestBox=renderer.update(renderer.getRenderShape(),node,node._contentBox))&&(latestBox=latestBox()),latestBox&&(node._contentBox=node._contentBox.merge(latestBox),renderer.contentBox=latestBox)):renderer.getRenderShape()&&renderer.getRenderShape().setVisible(!1)})),this.fire("noderender",{node})}}}()),kity.extendClass(MinderNode,{render:function(){if(this.attached)return this.getMinder().renderNode(this),this},renderTree:function(){if(this.attached){var list=[];return this.traverse((function(node){list.push(node)})),this.getMinder().renderNodeBatch(list),this}},getRenderer:function(type){var rs=this._renderers;if(!rs)return null;for(var i=0;i<rs.length;i++)if(rs[i].getType()==type)return rs[i];return null},getContentBox:function(){return this.parent&&this.parent.isCollapsed()?new kity.Box:this._contentBox||new kity.Box},getRenderBox:function(rendererType,refer){var renderer=rendererType&&this.getRenderer(rendererType),contentBox=renderer?renderer.contentBox:this.getContentBox();return kity.Matrix.getCTM(this.getRenderContainer(),refer||"paper").transformBox(contentBox)}}),module.exports=Renderer}},_p[28]={value:function(require,exports,module){var kity=_p.r(17),utils=_p.r(33),Minder=_p.r(19),MinderNode=_p.r(21);Minder.registerInitHook((function(){this._initSelection()})),kity.extendClass(Minder,{_initSelection:function(){this._selectedNodes=[]},renderChangedSelection:function(last){var current=this.getSelectedNodes(),changed=[];for(current.forEach((function(node){-1==last.indexOf(node)&&changed.push(node)})),last.forEach((function(node){-1==current.indexOf(node)&&changed.push(node)})),changed.length&&(this._interactChange(),this.fire("selectionchange"));changed.length;)changed.shift().render()},getSelectedNodes:function(){return this._selectedNodes},getSelectedNode:function(){return this.getSelectedNodes()[0]||null},removeAllSelectedNodes:function(){var last=this._selectedNodes.splice(0);return this._selectedNodes=[],this.renderChangedSelection(last),this.fire("selectionclear")},removeSelectedNodes:function(nodes){var me=this,last=this._selectedNodes.slice(0);return(nodes=utils.isArray(nodes)?nodes:[nodes]).forEach((function(node){var index;-1!==(index=me._selectedNodes.indexOf(node))&&me._selectedNodes.splice(index,1)})),this.renderChangedSelection(last),this},select:function(nodes,isSingleSelect){var lastSelect=this.getSelectedNodes().slice(0);isSingleSelect&&(this._selectedNodes=[]);var me=this;return(nodes=utils.isArray(nodes)?nodes:[nodes]).forEach((function(node){-1===me._selectedNodes.indexOf(node)&&me._selectedNodes.unshift(node)})),this.renderChangedSelection(lastSelect),this},selectById:function(ids,isSingleSelect){ids=utils.isArray(ids)?ids:[ids];var nodes=this.getNodesById(ids);return this.select(nodes,isSingleSelect)},toggleSelect:function(node){return utils.isArray(node)?node.forEach(this.toggleSelect.bind(this)):node.isSelected()?this.removeSelectedNodes(node):this.select(node),this},isSingleSelect:function(){return 1==this._selectedNodes.length},getSelectedAncestors:function(includeRoot){var judge,nodes=this.getSelectedNodes().slice(0),ancestors=[],rootIndex=nodes.indexOf(this.getRoot());function hasAncestor(nodes,judge){for(var i=nodes.length-1;i>=0;--i)if(nodes[i].isAncestorOf(judge))return!0;return!1}for(~rootIndex&&!includeRoot&&nodes.splice(rootIndex,1),nodes.sort((function(node1,node2){return node1.getLevel()-node2.getLevel()}));judge=nodes.pop();)hasAncestor(nodes,judge)||ancestors.push(judge);return ancestors}}),kity.extendClass(MinderNode,{isSelected:function(){var minder=this.getMinder();return minder&&-1!=minder.getSelectedNodes().indexOf(this)}})}},_p[29]={value:function(require,exports,module){var kity=_p.r(17),utils=_p.r(33),keymap=_p.r(15),Minder=_p.r(19),MinderEvent=_p.r(13);function getMetaKeyCode(unknown){var metaKeyCode=0;return"string"==typeof unknown?unknown.toLowerCase().split(/\+\s*/).forEach((function(name){switch(name){case"ctrl":case"cmd":metaKeyCode|=4096;break;case"alt":metaKeyCode|=8192;break;case"shift":metaKeyCode|=16384;break;default:metaKeyCode|=keymap[name]}})):((unknown.ctrlKey||unknown.metaKey)&&(metaKeyCode|=4096),unknown.altKey&&(metaKeyCode|=8192),unknown.shiftKey&&(metaKeyCode|=16384),metaKeyCode|=unknown.keyCode),metaKeyCode}kity.extendClass(MinderEvent,{isShortcutKey:function(keyCombine){var keyEvent=this.originEvent;return!!keyEvent&&getMetaKeyCode(keyCombine)==getMetaKeyCode(keyEvent)}}),Minder.registerInitHook((function(){this._initShortcutKey()})),kity.extendClass(Minder,{_initShortcutKey:function(){this._bindShortcutKeys()},_bindShortcutKeys:function(){var map=this._shortcutKeys={};this.on("keydown",(function(e){for(var keys in map)if(map.hasOwnProperty(keys)&&e.isShortcutKey(keys)){var fn=map[keys];if(fn.__statusCondition&&fn.__statusCondition!=this.getStatus())return;fn(),e.preventDefault()}}))},addShortcut:function(keys,fn){var binds=this._shortcutKeys;keys.split(/\|\s*/).forEach((function(combine){var status,parts=combine.split("::");parts.length>1&&(combine=parts[1],status=parts[0],fn.__statusCondition=status),binds[combine]=fn}))},addCommandShortcutKeys:function(cmd,keys){var binds=this._commandShortcutKeys||(this._commandShortcutKeys={}),obj={};keys?obj[cmd]=keys:obj=cmd;var minder=this;utils.each(obj,(function(keys,command){binds[command]=keys,minder.addShortcut(keys,(function execCommandByShortcut(){-1!==minder.queryCommandState(command)&&minder.execCommand(command)}))}))},getCommandShortcutKey:function(cmd){var binds=this._commandShortcutKeys;return binds&&binds[cmd]||null},supportClipboardEvent:function(window){return!!window.ClipboardEvent}(window)})}},_p[30]={value:function(require,exports,module){var kity=_p.r(17),Minder=_p.r(19),sf=~window.location.href.indexOf("status"),tf=~window.location.href.indexOf("trace");Minder.registerInitHook((function(){this._initStatus()})),kity.extendClass(Minder,{_initStatus:function(){this._status="normal",this._rollbackStatus="normal"},setStatus:function(status,force){return"readonly"!=this._status||force?(status!=this._status&&(this._rollbackStatus=this._status,this._status=status,this.fire("statuschange",{lastStatus:this._rollbackStatus,currentStatus:this._status}),sf&&(console.log(window.event.type,this._rollbackStatus,"->",this._status),tf&&console.trace())),this):this},rollbackStatus:function(){this.setStatus(this._rollbackStatus)},getRollbackStatus:function(){return this._rollbackStatus},getStatus:function(){return this._status}})}},_p[31]={value:function(require,exports,module){var originGetTheme,originGetLayout,originGetConnect,kity=_p.r(17),utils=_p.r(33),Minder=_p.r(19),Command=_p.r(9),MinderNode=_p.r(21),Module=_p.r(20),_templates={};exports.register=function register(name,supports){_templates[name]=supports},utils.extend(Minder,{getTemplateList:function(){return _templates}}),kity.extendClass(Minder,(originGetTheme=Minder.prototype.getTheme,{useTemplate:function(name,duration){this.setTemplate(name),this.refresh(duration||800)},getTemplate:function(){return this._template||"default"},setTemplate:function(name){this._template=name||null},getTemplateSupport:function(method){var supports=_templates[this.getTemplate()];return supports&&supports[method]},getTheme:function(node){return(this.getTemplateSupport("getTheme")||originGetTheme).call(this,node)}})),kity.extendClass(MinderNode,(originGetLayout=MinderNode.prototype.getLayout,originGetConnect=MinderNode.prototype.getConnect,{getLayout:function(){return(this.getMinder().getTemplateSupport("getLayout")||originGetLayout).call(this,this)},getConnect:function(){return(this.getMinder().getTemplateSupport("getConnect")||originGetConnect).call(this,this)}})),Module.register("TemplateModule",{commands:{template:kity.createClass("TemplateCommand",{base:Command,execute:function(minder,name){minder.useTemplate(name),minder.execCommand("camera")},queryValue:function(minder){return minder.getTemplate()||"default"}})}})}},_p[32]={value:function(require,exports,module){var kity=_p.r(17),utils=_p.r(33),Minder=_p.r(19),MinderNode=_p.r(21),Module=_p.r(20),Command=_p.r(9),cssLikeValueMatcher={left:function(value){return 3 in value&&value[3]||1 in value&&value[1]||value[0]},right:function(value){return 1 in value&&value[1]||value[0]},top:function(value){return value[0]},bottom:function(value){return 2 in value&&value[2]||value[0]}},_themes={};exports.register=function register(name,theme){_themes[name]=theme},utils.extend(Minder,{getThemeList:function(){return _themes}}),kity.extendClass(Minder,{useTheme:function(name){return this.setTheme(name),this.refresh(800),!0},setTheme:function(name){if(name&&!_themes[name])throw new Error("Theme "+name+" not exists!");var lastTheme=this._theme;this._theme=name||null;var container=this.getRenderTarget();return container&&(container.classList.remove("km-theme-"+lastTheme),name&&container.classList.add("km-theme-"+name),container.style.background=this.getStyle("background")),this.fire("themechange",{theme:name}),this},getTheme:function(node){return this._theme||this.getOption("defaultTheme")||"fresh-blue"},getThemeItems:function(node){this.getTheme(node);return _themes[this.getTheme(node)]},getStyle:function(item,node){var segment,dir,value,matcher,items=this.getThemeItems(node);if(item in items)return items[item];if((segment=item.split("-")).length<2)return null;if(dir=segment.pop(),(item=segment.join("-"))in items){if(value=items[item],utils.isArray(value)&&(matcher=cssLikeValueMatcher[dir]))return matcher(value);if(!isNaN(value))return value}return null},getNodeStyle:function(node,name){var value=this.getStyle(node.getType()+"-"+name,node);return null!==value?value:this.getStyle(name,node)}}),kity.extendClass(MinderNode,{getStyle:function(name){return this.getMinder().getNodeStyle(this,name)}}),Module.register("Theme",{defaultOptions:{defaultTheme:"fresh-blue"},commands:{theme:kity.createClass("ThemeCommand",{base:Command,execute:function(km,name){return km.useTheme(name)},queryValue:function(km){return km.getTheme()||"default"}})}}),Minder.registerInitHook((function(){this.setTheme()}))}},_p[33]={value:function(require,exports){var kity=_p.r(17),uuidMap={};exports.extend=kity.Utils.extend.bind(kity.Utils),exports.each=kity.Utils.each.bind(kity.Utils),exports.uuid=function(group){return uuidMap[group]=uuidMap[group]?uuidMap[group]+1:1,group+uuidMap[group]},exports.guid=function(){return(1e6*+new Date+Math.floor(1e6*Math.random())).toString(36)},exports.trim=function(str){return str.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},exports.keys=function(plain){var keys=[];for(var key in plain)plain.hasOwnProperty(key)&&keys.push(key);return keys},exports.clone=function(source){return JSON.parse(JSON.stringify(source))},exports.comparePlainObject=function(a,b){return JSON.stringify(a)==JSON.stringify(b)},exports.encodeHtml=function(str,reg){return str?str.replace(reg||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,(function(a,b){return b?a:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[a]})):""},exports.clearWhiteSpace=function(str){return str.replace(/[\u200b\t\r\n]/g,"")},exports.each(["String","Function","Array","Number","RegExp","Object"],(function(v){var toString=Object.prototype.toString;exports["is"+v]=function(obj){return toString.apply(obj)=="[object "+v+"]"}}))}},_p[34]={value:function(require,exports,module){module.exports=window.kityminder=_p.r(35)}},_p[35]={value:function(require,exports,module){var kityminder={version:_p.r(19).version};_p.r(33),kityminder.Minder=_p.r(19),kityminder.Command=_p.r(9),kityminder.Node=_p.r(21),_p.r(22),_p.r(8),kityminder.Event=_p.r(13),kityminder.data=_p.r(12),_p.r(10),kityminder.KeyMap=_p.r(15),_p.r(29),_p.r(30),_p.r(23),_p.r(28),_p.r(14),_p.r(16),kityminder.Module=_p.r(20),_p.r(26),kityminder.Render=_p.r(27),kityminder.Connect=_p.r(11),kityminder.Layout=_p.r(18),kityminder.Theme=_p.r(32),kityminder.Template=_p.r(31),kityminder.Promise=_p.r(25),_p.r(7),_p.r(24),_p.r(42),_p.r(43),_p.r(44),_p.r(45),_p.r(46),_p.r(47),_p.r(48),_p.r(50),_p.r(49),_p.r(51),_p.r(52),_p.r(53),_p.r(54),_p.r(55),_p.r(56),_p.r(57),_p.r(58),_p.r(59),_p.r(60),_p.r(61),_p.r(62),_p.r(63),_p.r(64),_p.r(68),_p.r(65),_p.r(67),_p.r(66),_p.r(40),_p.r(36),_p.r(37),_p.r(38),_p.r(39),_p.r(41),_p.r(75),_p.r(78),_p.r(77),_p.r(76),_p.r(78),_p.r(80),_p.r(79),_p.r(0),_p.r(1),_p.r(2),_p.r(3),_p.r(4),_p.r(5),_p.r(6),_p.r(69),_p.r(73),_p.r(70),_p.r(72),_p.r(71),_p.r(74),module.exports=kityminder}},_p[36]={value:function(require,exports,module){var kity=_p.r(17),Layout=_p.r(18);["left","right","top","bottom"].forEach((function registerLayoutForDirection(name){var axis="left"==name||"right"==name?"x":"y",dir="left"==name||"top"==name?-1:1,oppsite={left:"right",right:"left",top:"bottom",bottom:"top",x:"y",y:"x"};Layout.register(name,kity.createClass({base:Layout,doLayout:function(parent,children){var pbox=parent.getContentBox();if("x"==axis?(parent.setVertexOut(new kity.Point(pbox[name],pbox.cy)),parent.setLayoutVectorOut(new kity.Vector(dir,0))):(parent.setVertexOut(new kity.Point(pbox.cx,pbox[name])),parent.setLayoutVectorOut(new kity.Vector(0,dir))),!children.length)return!1;children.forEach((function(child){var cbox=child.getContentBox();child.setLayoutTransform(new kity.Matrix),"x"==axis?(child.setVertexIn(new kity.Point(cbox[oppsite[name]],cbox.cy)),child.setLayoutVectorIn(new kity.Vector(dir,0))):(child.setVertexIn(new kity.Point(cbox.cx,cbox[oppsite[name]])),child.setLayoutVectorIn(new kity.Vector(0,dir)))})),this.align(children,oppsite[name]),this.stack(children,oppsite[axis]);var bbox=this.getBranchBox(children),xAdjust=0,yAdjust=0;"x"==axis?(xAdjust=pbox[name],xAdjust+=dir*parent.getStyle("margin-"+name),xAdjust+=dir*children[0].getStyle("margin-"+oppsite[name]),yAdjust=pbox.bottom,yAdjust-=pbox.height/2,yAdjust-=bbox.height/2,yAdjust-=bbox.y):(xAdjust=pbox.right,xAdjust-=pbox.width/2,xAdjust-=bbox.width/2,xAdjust-=bbox.x,yAdjust=pbox[name],yAdjust+=dir*parent.getStyle("margin-"+name),yAdjust+=dir*children[0].getStyle("margin-"+oppsite[name])),this.move(children,xAdjust,yAdjust)},getOrderHint:function getOrderHint(node){var hint=[],box=node.getLayoutBox();return"x"==axis?(hint.push({type:"up",node,area:new kity.Box({x:box.x,y:box.top-node.getStyle("margin-top")-5,width:box.width,height:node.getStyle("margin-top")}),path:["M",box.x,box.top-5,"L",box.right,box.top-5]}),hint.push({type:"down",node,area:new kity.Box({x:box.x,y:box.bottom+5,width:box.width,height:node.getStyle("margin-bottom")}),path:["M",box.x,box.bottom+5,"L",box.right,box.bottom+5]})):(hint.push({type:"up",node,area:new kity.Box({x:box.left-node.getStyle("margin-left")-5,y:box.top,width:node.getStyle("margin-left"),height:box.height}),path:["M",box.left-5,box.top,"L",box.left-5,box.bottom]}),hint.push({type:"down",node,area:new kity.Box({x:box.right+5,y:box.top,width:node.getStyle("margin-right"),height:box.height}),path:["M",box.right+5,box.top,"L",box.right+5,box.bottom]})),hint}}))}))}},_p[37]={value:function(require,exports,module){var kity=_p.r(17),Layout=_p.r(18);[-1,1].forEach((function registerLayoutForDir(dir){var name="filetree-"+(dir>0?"down":"up");Layout.register(name,kity.createClass({base:Layout,doLayout:function(parent,children,round){var pBox=parent.getContentBox();if(parent.setVertexOut(new kity.Point(pBox.left+20,dir>0?pBox.bottom:pBox.top)),parent.setLayoutVectorOut(new kity.Vector(0,dir)),children.length){children.forEach((function(child){var cbox=child.getContentBox();child.setLayoutTransform(new kity.Matrix),child.setVertexIn(new kity.Point(cbox.left,cbox.cy)),child.setLayoutVectorIn(new kity.Vector(1,0))})),this.align(children,"left"),this.stack(children,"y");var xAdjust=0;xAdjust+=pBox.left,xAdjust+=20,xAdjust+=children[0].getStyle("margin-left");var yAdjust=0;dir>0?(yAdjust+=pBox.bottom,yAdjust+=parent.getStyle("margin-bottom"),yAdjust+=children[0].getStyle("margin-top")):(yAdjust-=this.getTreeBox(children).bottom,yAdjust+=pBox.top,yAdjust-=parent.getStyle("margin-top"),yAdjust-=children[0].getStyle("margin-bottom")),this.move(children,xAdjust,yAdjust)}},getOrderHint:function(node){var hint=[],box=node.getLayoutBox(),offset=node.getLevel()>1?3:5;return hint.push({type:"up",node,area:new kity.Box({x:box.x,y:box.top-node.getStyle("margin-top")-offset,width:box.width,height:node.getStyle("margin-top")}),path:["M",box.x,box.top-offset,"L",box.right,box.top-offset]}),hint.push({type:"down",node,area:new kity.Box({x:box.x,y:box.bottom+offset,width:box.width,height:node.getStyle("margin-bottom")}),path:["M",box.x,box.bottom+offset,"L",box.right,box.bottom+offset]}),hint}}))}))}},_p[38]={value:function(require,exports,module){var kity=_p.r(17),Layout=_p.r(18);Layout.register("fish-bone-master",kity.createClass("FishBoneMasterLayout",{base:Layout,doLayout:function(parent,children,round){var upPart=[],downPart=[],child=children[0],pBox=parent.getContentBox();if(parent.setVertexOut(new kity.Point(pBox.right,pBox.cy)),parent.setLayoutVectorOut(new kity.Vector(1,0)),child){child.getContentBox();var pMarginRight=parent.getStyle("margin-right"),cMarginLeft=child.getStyle("margin-left"),cMarginTop=child.getStyle("margin-top"),cMarginBottom=child.getStyle("margin-bottom");children.forEach((function(child,index){child.setLayoutTransform(new kity.Matrix);var cBox=child.getContentBox();index%2?(downPart.push(child),child.setVertexIn(new kity.Point(cBox.left,cBox.top)),child.setLayoutVectorIn(new kity.Vector(1,1))):(upPart.push(child),child.setVertexIn(new kity.Point(cBox.left,cBox.bottom)),child.setLayoutVectorIn(new kity.Vector(1,-1)))})),this.stack(upPart,"x"),this.stack(downPart,"x"),this.align(upPart,"bottom"),this.align(downPart,"top");var xAdjust=pBox.right+pMarginRight+cMarginLeft,yAdjustUp=pBox.cy-cMarginBottom-parent.getStyle("margin-top"),yAdjustDown=pBox.cy+cMarginTop+parent.getStyle("margin-bottom");this.move(upPart,xAdjust,yAdjustUp),this.move(downPart,xAdjust+cMarginLeft,yAdjustDown)}}}))}},_p[39]={value:function(require,exports,module){var kity=_p.r(17),Layout=_p.r(18);Layout.register("fish-bone-slave",kity.createClass("FishBoneSlaveLayout",{base:Layout,doLayout:function(parent,children,round){var layout=this,abs=Math.abs,pBox=parent.getContentBox(),vi=parent.getLayoutVectorIn();parent.setLayoutVectorOut(vi);var goldX=pBox.left+.382*pBox.width,pout=new kity.Point(goldX,vi.y>0?pBox.bottom:pBox.top);parent.setVertexOut(pout);var child=children[0];if(child){var cBox=child.getContentBox();children.forEach((function(child,index){child.setLayoutTransform(new kity.Matrix),child.setLayoutVectorIn(new kity.Vector(1,0)),child.setVertexIn(new kity.Point(cBox.left,cBox.cy))})),this.stack(children,"y"),this.align(children,"left");var xAdjust=0,yAdjust=0;xAdjust+=pout.x,parent.getLayoutVectorOut().y<0?(yAdjust-=this.getTreeBox(children).bottom,yAdjust+=parent.getContentBox().top,yAdjust-=parent.getStyle("margin-top"),yAdjust-=child.getStyle("margin-bottom")):(yAdjust+=parent.getContentBox().bottom,yAdjust+=parent.getStyle("margin-bottom"),yAdjust+=child.getStyle("margin-top")),this.move(children,xAdjust,yAdjust),2==round&&children.forEach((function(child){var m=child.getLayoutTransform(),cbox=child.getContentBox(),pin=m.transformPoint(new kity.Point(cbox.left,0));layout.move([child],abs(pin.y-pout.y),0)}))}}}))}},_p[40]={value:function(require,exports,module){var kity=_p.r(17),Layout=_p.r(18),Minder=_p.r(19);Layout.register("mind",kity.createClass({base:Layout,doLayout:function(node,children){var half=Math.ceil(node.children.length/2),right=[],left=[];children.forEach((function(child){child.getIndex()<half?right.push(child):left.push(child)}));var leftLayout=Minder.getLayoutInstance("left"),rightLayout=Minder.getLayoutInstance("right");leftLayout.doLayout(node,left),rightLayout.doLayout(node,right);var box=node.getContentBox();node.setVertexOut(new kity.Point(box.cx,box.cy)),node.setLayoutVectorOut(new kity.Vector(0,0))},getOrderHint:function(node){var hint=[],box=node.getLayoutBox();return hint.push({type:"up",node,area:new kity.Box({x:box.x,y:box.top-node.getStyle("margin-top")-5,width:box.width,height:node.getStyle("margin-top")}),path:["M",box.x,box.top-5,"L",box.right,box.top-5]}),hint.push({type:"down",node,area:new kity.Box({x:box.x,y:box.bottom+5,width:box.width,height:node.getStyle("margin-bottom")}),path:["M",box.x,box.bottom+5,"L",box.right,box.bottom+5]}),hint}}))}},_p[41]={value:function(require,exports,module){var kity=_p.r(17),Layout=_p.r(18);_p.r(19);Layout.register("tianpan",kity.createClass({base:Layout,doLayout:function(parent,children){if(0!=children.length){var x,y,box,layout=this,pbox=parent.getContentBox(),_theta=5,_r=Math.max(pbox.width,50);children.forEach((function(child,index){child.setLayoutTransform(new kity.Matrix),box=layout.getTreeBox(child),_r=Math.max(Math.max(box.width,box.height),_r)})),_r=_r/1.5/Math.PI,children.forEach((function(child,index){x=_r*(Math.cos(_theta)+Math.sin(_theta)*_theta),y=_r*(Math.sin(_theta)-Math.cos(_theta)*_theta),_theta+=.9-.02*index,child.setLayoutVectorIn(new kity.Vector(1,0)),child.setVertexIn(new kity.Point(pbox.cx,pbox.cy)),child.setLayoutTransform(new kity.Matrix),layout.move([child],x,y)}))}},getOrderHint:function(node){var hint=[],box=node.getLayoutBox();return hint.push({type:"up",node,area:{x:box.x,y:box.top-node.getStyle("margin-top")-5,width:box.width,height:node.getStyle("margin-top")},path:["M",box.x,box.top-5,"L",box.right,box.top-5]}),hint.push({type:"down",node,area:{x:box.x,y:box.bottom+5,width:box.width,height:node.getStyle("margin-bottom")},path:["M",box.x,box.bottom+5,"L",box.right,box.bottom+5]}),hint}}))}},_p[42]={value:function(require,exports,module){var kity=_p.r(17),MinderNode=_p.r(21),Command=_p.r(9),Module=_p.r(20);function asc(nodeA,nodeB){return nodeA.getIndex()-nodeB.getIndex()}function desc(nodeA,nodeB){return-asc(nodeA,nodeB)}kity.extendClass(MinderNode,{arrange:function(index){var parent=this.parent;if(parent){var sibling=parent.children;if(!(index<0||index>=sibling.length))return sibling.splice(this.getIndex(),1),sibling.splice(index,0,this),this}}});var ArrangeUpCommand=kity.createClass("ArrangeUpCommand",{base:Command,execute:function(km){var nodes=km.getSelectedNodes();nodes.sort(asc);var lastIndexes=nodes.map((function(node){return node.getIndex()}));nodes.forEach((function(node,index){node.arrange(lastIndexes[index]-1)})),km.layout(300)},queryState:function(km){return km.getSelectedNode()?0:-1}}),ArrangeDownCommand=kity.createClass("ArrangeUpCommand",{base:Command,execute:function(km){var nodes=km.getSelectedNodes();nodes.sort(desc);var lastIndexes=nodes.map((function(node){return node.getIndex()}));nodes.forEach((function(node,index){node.arrange(lastIndexes[index]+1)})),km.layout(300)},queryState:function(km){return km.getSelectedNode()?0:-1}}),ArrangeCommand=kity.createClass("ArrangeCommand",{base:Command,execute:function(km,index){var nodes=km.getSelectedNodes().slice();if(nodes.length&&MinderNode.getCommonAncestor(nodes)==nodes[0].parent){var indexed=nodes.map((function(node){return{index:node.getIndex(),node}})),asc=Math.min.apply(Math,indexed.map((function(one){return one.index})))>=index;indexed.sort((function(a,b){return asc?b.index-a.index:a.index-b.index})),indexed.forEach((function(one){one.node.arrange(index)})),km.layout(300)}},queryState:function(km){return km.getSelectedNode()?0:-1}});Module.register("ArrangeModule",{commands:{arrangeup:ArrangeUpCommand,arrangedown:ArrangeDownCommand,arrange:ArrangeCommand},contextmenu:[{command:"arrangeup"},{command:"arrangedown"},{divider:!0}],commandShortcutKeys:{arrangeup:"normal::alt+Up",arrangedown:"normal::alt+Down"}})}},_p[43]={value:function(require,exports,module){var kity=_p.r(17),Command=(_p.r(33),_p.r(19),_p.r(21),_p.r(9)),Module=_p.r(20),TextRenderer=_p.r(61);Module.register("basestylemodule",(function(){var km=this;function getNodeDataOrStyle(node,name){return node.getData(name)||node.getStyle(name)}return TextRenderer.registerStyleHook((function(node,textGroup){var fontWeight=getNodeDataOrStyle(node,"font-weight"),fontStyle=getNodeDataOrStyle(node,"font-style");[fontWeight,fontStyle].join("/");textGroup.eachItem((function(index,item){item.setFont({weight:fontWeight,style:fontStyle})}))})),{commands:{bold:kity.createClass("boldCommand",{base:Command,execute:function(km){var nodes=km.getSelectedNodes();1==this.queryState("bold")?nodes.forEach((function(n){n.setData("font-weight").render()})):nodes.forEach((function(n){n.setData("font-weight","bold").render()})),km.layout()},queryState:function(){var nodes=km.getSelectedNodes(),result=0;return 0===nodes.length?-1:(nodes.forEach((function(n){if(n&&n.getData("font-weight"))return result=1,!1})),result)}}),italic:kity.createClass("italicCommand",{base:Command,execute:function(km){var nodes=km.getSelectedNodes();1==this.queryState("italic")?nodes.forEach((function(n){n.setData("font-style").render()})):nodes.forEach((function(n){n.setData("font-style","italic").render()})),km.layout()},queryState:function(){var nodes=km.getSelectedNodes(),result=0;return 0===nodes.length?-1:(nodes.forEach((function(n){if(n&&n.getData("font-style"))return result=1,!1})),result)}})},commandShortcutKeys:{bold:"ctrl+b",italic:"ctrl+i"}}}))}},_p[44]={value:function(require,exports,module){var kity=_p.r(17),MinderNode=(_p.r(33),_p.r(21)),Command=_p.r(9);_p.r(20).register("ClipboardModule",(function(){var km=this,_clipboardNodes=[],_selectedNodes=[];function appendChildNode(parent,child){_selectedNodes.push(child),km.appendNode(child,parent),child.render(),child.setLayoutOffset(null);var children=child.children.map((function(node){return node.clone()}));child.clearChildren();for(var ci,i=0;ci=children[i];i++)appendChildNode(child,ci)}function sendToClipboard(nodes){nodes.length&&(nodes.sort((function(a,b){return a.getIndex()-b.getIndex()})),_clipboardNodes=nodes.map((function(node){return node.clone()})))}var CopyCommand=kity.createClass("CopyCommand",{base:Command,execute:function(km){sendToClipboard(km.getSelectedAncestors(!0)),this.setContentChanged(!1)}}),CutCommand=kity.createClass("CutCommand",{base:Command,execute:function(km){var ancestors=km.getSelectedAncestors();0!==ancestors.length&&(sendToClipboard(ancestors),km.select(MinderNode.getCommonAncestor(ancestors),!0),ancestors.slice().forEach((function(node){km.removeNode(node)})),km.layout(300))}}),PasteCommand=kity.createClass("PasteCommand",{base:Command,execute:function(km){if(_clipboardNodes.length){var nodes=km.getSelectedNodes();if(!nodes.length)return;for(var ni,i=0;ni=_clipboardNodes[i];i++)for(var node,j=0;node=nodes[j];j++)appendChildNode(node,ni.clone());km.select(_selectedNodes,!0),_selectedNodes=[],km.layout(300)}},queryState:function(km){return km.getSelectedNode()?0:-1}});if(km.supportClipboardEvent&&!kity.Browser.gecko){return{commands:{copy:CopyCommand,cut:CutCommand,paste:PasteCommand},clipBoardEvents:{copy:function(e){this.fire("beforeCopy",e)}.bind(km),cut:function(e){this.fire("beforeCut",e)}.bind(km),paste:function(e){this.fire("beforePaste",e)}.bind(km)},sendToClipboard}}return{commands:{copy:CopyCommand,cut:CutCommand,paste:PasteCommand},commandShortcutKeys:{copy:"normal::ctrl+c|",cut:"normal::ctrl+x",paste:"normal::ctrl+v"},sendToClipboard}}))}},_p[45]={value:function(require,exports,module){var kity=_p.r(17),MinderNode=(_p.r(33),_p.r(21)),Command=_p.r(9),Module=_p.r(20),MoveToParentCommand=kity.createClass("MoveToParentCommand",{base:Command,execute:function(minder,nodes,parent){for(var node,i=0;i<nodes.length;i++)(node=nodes[i]).parent&&(node.parent.removeChild(node),parent.appendChild(node),node.render());parent.expand(),minder.select(nodes,!0)}}),DropHinter=kity.createClass("DropHinter",{base:kity.Group,constructor:function(){this.callBase(),this.rect=new kity.Rect,this.addShape(this.rect)},render:function(target){this.setVisible(!!target),target&&(this.rect.setBox(target.getLayoutBox()).setRadius(target.getStyle("radius")||0).stroke(target.getStyle("drop-hint-color")||"yellow",target.getStyle("drop-hint-width")||2),this.bringTop())}}),OrderHinter=kity.createClass("OrderHinter",{base:kity.Group,constructor:function(){this.callBase(),this.area=new kity.Rect,this.path=new kity.Path,this.addShapes([this.area,this.path])},render:function(hint){this.setVisible(!!hint),hint&&(this.area.setBox(hint.area),this.area.fill(hint.node.getStyle("order-hint-area-color")||"rgba(0, 255, 0, .5)"),this.path.setPathData(hint.path),this.path.stroke(hint.node.getStyle("order-hint-path-color")||"#0f0",hint.node.getStyle("order-hint-path-width")||1))}}),TreeDragger=kity.createClass("TreeDragger",{constructor:function(minder){this._minder=minder,this._dropHinter=new DropHinter,this._orderHinter=new OrderHinter,minder.getRenderContainer().addShapes([this._dropHinter,this._orderHinter])},dragStart:function(position){this._startPosition=position},dragMove:function(position){if(this._startPosition){var movement=kity.Vector.fromPoints(this._dragPosition||this._startPosition,position),minder=this._minder;if(this._dragPosition=position,!this._dragMode){if(kity.Vector.fromPoints(this._dragPosition,this._startPosition).length()<10)return;if(!this._enterDragMode())return}for(var i=0;i<this._dragSources.length;i++)this._dragSources[i].setLayoutOffset(this._dragSources[i].getLayoutOffset().offset(movement)),minder.applyLayoutResult(this._dragSources[i]);this._dropTest()?this._renderOrderHint(this._orderSucceedHint=null):this._orderTest()}},dragEnd:function(){if(this._startPosition=null,this._dragPosition=null,this._dragMode){if(this._fadeDragSources(1),this._dropSucceedTarget)this._dragSources.forEach((function(source){source.setLayoutOffset(null)})),this._minder.layout(-1),this._minder.execCommand("movetoparent",this._dragSources,this._dropSucceedTarget);else if(this._orderSucceedHint){var hint=this._orderSucceedHint,index=hint.node.getIndex(),sourceIndexes=this._dragSources.map((function(source){return source.setLayoutOffset(null),source.getIndex()})),maxIndex=Math.max.apply(Math,sourceIndexes);index<Math.min.apply(Math,sourceIndexes)&&"down"==hint.type&&index++,index>maxIndex&&"up"==hint.type&&index--,hint.node.setLayoutOffset(null),this._minder.execCommand("arrange",index),this._renderOrderHint(null)}else this._minder.fire("savescene");this._minder.layout(300),this._leaveDragMode(),this._minder.fire("contentchange")}},_enterDragMode:function(){return this._calcDragSources(),this._dragSources.length?(this._fadeDragSources(.5),this._calcDropTargets(),this._calcOrderHints(),this._dragMode=!0,this._minder.setStatus("dragtree"),!0):(this._startPosition=null,!1)},_calcDragSources:function(){this._dragSources=this._minder.getSelectedAncestors()},_fadeDragSources:function(opacity){var minder=this._minder;this._dragSources.forEach((function(source){source.getRenderContainer().setOpacity(opacity,200),source.traverse((function(node){opacity<1?minder.detachNode(node):minder.attachNode(node)}),!0)}))},_calcDropTargets:function(){this._dropTargets=function findAvailableParents(nodes,root){var i,availables=[];return availables.push(root),root.getChildren().forEach((function(test){for(i=0;i<nodes.length;i++)if(nodes[i]==test)return;availables=availables.concat(findAvailableParents(nodes,test))})),availables}(this._dragSources,this._minder.getRoot()),this._dropTargetBoxes=this._dropTargets.map((function(source){return source.getLayoutBox()}))},_calcOrderHints:function(){var sources=this._dragSources,ancestor=MinderNode.getCommonAncestor(sources);if(ancestor==sources[0]&&(ancestor=sources[0].parent),0!==sources.length&&ancestor==sources[0].parent){var siblings=ancestor.children;this._orderHints=siblings.reduce((function(hint,sibling){return-1==sources.indexOf(sibling)&&(hint=hint.concat(sibling.getOrderHint())),hint}),[])}else this._orderHints=[]},_leaveDragMode:function(){this._dragMode=!1,this._dropSucceedTarget=null,this._orderSucceedHint=null,this._renderDropHint(null),this._renderOrderHint(null),this._minder.rollbackStatus()},_drawForDragMode:function(){this._text.setContent(this._dragSources.length+" items"),this._text.setPosition(this._startPosition.x,this._startPosition.y+5),this._minder.getRenderContainer().addShape(this)},_boxTest:function(targets,targetBoxMapper,judge){var i,j,target,sourceBox,targetBox,sourceBoxes=this._dragSources.map((function(source){return source.getLayoutBox()}));for(judge=judge||function(intersectBox,sourceBox,targetBox){return intersectBox&&!intersectBox.isEmpty()},i=0;i<targets.length;i++)for(target=targets[i],targetBox=targetBoxMapper.call(this,target,i),j=0;j<sourceBoxes.length;j++){if(judge((sourceBox=sourceBoxes[j]).intersect(targetBox),sourceBox,targetBox))return target}return null},_dropTest:function(){return this._dropSucceedTarget=this._boxTest(this._dropTargets,(function(target,i){return this._dropTargetBoxes[i]}),(function(intersectBox,sourceBox,targetBox){function area(box){return box.width*box.height}return!!intersectBox&&(!!area(intersectBox)&&(area(intersectBox)>.5*Math.min(area(sourceBox),area(targetBox))||(intersectBox.width+1>=Math.min(sourceBox.width,targetBox.width)||intersectBox.height+1>=Math.min(sourceBox.height,targetBox.height))))})),this._renderDropHint(this._dropSucceedTarget),!!this._dropSucceedTarget},_orderTest:function(){return this._orderSucceedHint=this._boxTest(this._orderHints,(function(hint){return hint.area})),this._renderOrderHint(this._orderSucceedHint),!!this._orderSucceedHint},_renderDropHint:function(target){this._dropHinter.render(target)},_renderOrderHint:function(hint){this._orderHinter.render(hint)},preventDragMove:function(){this._startPosition=null}});Module.register("DragTree",(function(){var dragger;return{init:function(){dragger=new TreeDragger(this),window.addEventListener("mouseup",(function(){dragger.dragEnd()}))},events:{"normal.mousedown inputready.mousedown":function(e){e.originEvent.button||e.getTargetNode()&&e.getTargetNode()!=this.getRoot()&&dragger.dragStart(e.getPosition())},"normal.mousemove dragtree.mousemove":function(e){dragger.dragMove(e.getPosition())},"normal.mouseup dragtree.beforemouseup":function(e){dragger.dragEnd(),e.preventDefault()},statuschange:function(e){"textedit"==e.lastStatus&&"normal"==e.currentStatus&&dragger.preventDragMove()}},commands:{movetoparent:MoveToParentCommand}}}))}},_p[46]={value:function(require,exports,module){var kity=_p.r(17),utils=_p.r(33),keymap=_p.r(15),MinderNode=_p.r(21),Command=_p.r(9),Module=_p.r(20),Renderer=_p.r(27);Module.register("Expand",(function(){var minder=this;kity.extendClass(MinderNode,{expand:function(){return this.setData("expandState","expand"),this},collapse:function(){return this.setData("expandState","collapse"),this},isExpanded:function(){return"collapse"!==this.getData("expandState")&&(this.isRoot()||this.parent.isExpanded())},isCollapsed:function(){return!this.isExpanded()}});var ExpandCommand=kity.createClass("ExpandCommand",{base:Command,execute:function(km,justParents){var node=km.getSelectedNode();if(node){for(justParents&&(node=node.parent);node.parent;)node.expand(),node=node.parent;node.renderTree(),km.layout(100)}},queryState:function(km){var node=km.getSelectedNode();return!node||node.isRoot()||node.isExpanded()?-1:0}}),ExpandToLevelCommand=kity.createClass("ExpandToLevelCommand",{base:Command,execute:function(km,level){km.getRoot().traverse((function(node){node.getLevel()<level&&node.expand(),node.getLevel()!=level||node.isLeaf()||node.collapse()})),km.refresh(100)},enableReadOnly:!0}),CollapseCommand=kity.createClass("CollapseCommand",{base:Command,execute:function(km){var node=km.getSelectedNode();node&&(node.collapse(),node.renderTree(),km.layout())},queryState:function(km){var node=km.getSelectedNode();return node&&!node.isRoot()&&node.isExpanded()?0:-1}}),Expander=kity.createClass("Expander",{base:kity.Group,constructor:function(node){this.callBase(),this.radius=6,this.outline=new kity.Circle(this.radius).stroke("gray").fill("white"),this.sign=(new kity.Path).stroke("gray"),this.addShapes([this.outline,this.sign]),this.initEvent(node),this.setId(utils.uuid("node_expander")),this.setStyle("cursor","pointer")},initEvent:function(node){this.on("mousedown",(function(e){minder.select([node],!0),node.isExpanded()?node.collapse():node.expand(),node.renderTree().getMinder().layout(100),node.getMinder().fire("contentchange"),e.stopPropagation(),e.preventDefault()})),this.on("dblclick click mouseup",(function(e){e.stopPropagation(),e.preventDefault()}))},setState:function(state){if("hide"!=state){this.setVisible(!0);var pathData=["M",1.5-this.radius,0,"L",this.radius-1.5,0];"collapse"==state&&pathData.push(["M",0,1.5-this.radius,"L",0,this.radius-1.5]),this.sign.setPathData(pathData)}else this.setVisible(!1)}});return{commands:{expand:ExpandCommand,expandtolevel:ExpandToLevelCommand,collapse:CollapseCommand},events:{layoutapply:function(e){var r=e.node.getRenderer("ExpanderRenderer");r.getRenderShape()&&r.update(r.getRenderShape(),e.node)},beforerender:function(e){var node=e.node,visible=!node.parent||node.parent.isExpanded();node.getRenderContainer().setVisible(visible),visible||e.stopPropagation()},"normal.keydown":function(e){if("textedit"!=this.getStatus()){if(e.originEvent.keyCode==keymap["/"]){var node=this.getSelectedNode();if(!node||node==this.getRoot())return;var expanded=node.isExpanded();this.getSelectedNodes().forEach((function(node){expanded?node.collapse():node.expand(),node.renderTree()})),this.layout(100),this.fire("contentchange"),e.preventDefault(),e.stopPropagationImmediately()}e.isShortcutKey("Alt+`")&&this.execCommand("expandtolevel",9999);for(var i=1;i<6;i++)e.isShortcutKey("Alt+"+i)&&this.execCommand("expandtolevel",i)}}},renderers:{outside:kity.createClass("ExpanderRenderer",{base:Renderer,create:function(node){if(!node.isRoot())return this.expander=new Expander(node),node.getRenderContainer().prependShape(this.expander),node.expanderRenderer=this,this.node=node,this.expander},shouldRender:function(node){return!node.isRoot()},update:function(expander,node,box){if(node.parent){var visible=node.parent.isExpanded();expander.setState(visible&&node.children.length?node.getData("expandState"):"hide");var vector=node.getLayoutVectorIn().normalize(expander.radius+node.getStyle("stroke-width")),position=node.getVertexIn().offset(vector.reverse());this.expander.setTranslate(position)}}})},contextmenu:[{command:"expandtoleaf",query:function(){return!minder.getSelectedNode()},fn:function(minder){minder.execCommand("expandtolevel",9999)}},{command:"expandtolevel1",query:function(){return!minder.getSelectedNode()},fn:function(minder){minder.execCommand("expandtolevel",1)}},{command:"expandtolevel2",query:function(){return!minder.getSelectedNode()},fn:function(minder){minder.execCommand("expandtolevel",2)}},{command:"expandtolevel3",query:function(){return!minder.getSelectedNode()},fn:function(minder){minder.execCommand("expandtolevel",3)}},{divider:!0}]}}))}},_p[47]={value:function(require,exports,module){var kity=_p.r(17),Command=(_p.r(33),_p.r(19),_p.r(21),_p.r(9)),Module=_p.r(20);function getNodeDataOrStyle(node,name){return node.getData(name)||node.getStyle(name)}_p.r(61).registerStyleHook((function(node,textGroup){var dataColor=node.getData("color"),selectedColor=node.getStyle("selected-color"),styleColor=node.getStyle("color"),foreColor=dataColor||(node.isSelected()&&selectedColor?selectedColor:styleColor),fontFamily=getNodeDataOrStyle(node,"font-family"),fontSize=getNodeDataOrStyle(node,"font-size");textGroup.fill(foreColor),textGroup.eachItem((function(index,item){item.setFont({family:fontFamily,size:fontSize})}))})),Module.register("fontmodule",{commands:{forecolor:kity.createClass("fontcolorCommand",{base:Command,execute:function(km,color){km.getSelectedNodes().forEach((function(n){n.setData("color",color),n.render()}))},queryState:function(km){return 0===km.getSelectedNodes().length?-1:0},queryValue:function(km){return 1==km.getSelectedNodes().length?km.getSelectedNodes()[0].getData("color"):"mixed"}}),background:kity.createClass("backgroudCommand",{base:Command,execute:function(km,color){km.getSelectedNodes().forEach((function(n){n.setData("background",color),n.render()}))},queryState:function(km){return 0===km.getSelectedNodes().length?-1:0},queryValue:function(km){return 1==km.getSelectedNodes().length?km.getSelectedNodes()[0].getData("background"):"mixed"}}),fontfamily:kity.createClass("fontfamilyCommand",{base:Command,execute:function(km,family){km.getSelectedNodes().forEach((function(n){n.setData("font-family",family),n.render(),km.layout()}))},queryState:function(km){return 0===km.getSelectedNodes().length?-1:0},queryValue:function(km){var node=km.getSelectedNode();return node?node.getData("font-family"):null}}),fontsize:kity.createClass("fontsizeCommand",{base:Command,execute:function(km,size){km.getSelectedNodes().forEach((function(n){n.setData("font-size",size),n.render(),km.layout(300)}))},queryState:function(km){return 0===km.getSelectedNodes().length?-1:0},queryValue:function(km){var node=km.getSelectedNode();return node?node.getData("font-size"):null}})}})}},_p[48]={value:function(require,exports,module){var kity=_p.r(17),Command=(_p.r(33),_p.r(19),_p.r(21),_p.r(9)),Module=_p.r(20),Renderer=_p.r(27);Module.register("hyperlink",{commands:{hyperlink:kity.createClass("hyperlink",{base:Command,execute:function(km,url,title){km.getSelectedNodes().forEach((function(n){n.setData("hyperlink",url),n.setData("hyperlinkTitle",url&&title),n.render()})),km.layout()},queryState:function(km){var nodes=km.getSelectedNodes(),result=0;return 0===nodes.length?-1:(nodes.forEach((function(n){if(n&&n.getData("hyperlink"))return result=0,!1})),result)},queryValue:function(km){var node=km.getSelectedNode();return{url:node.getData("hyperlink"),title:node.getData("hyperlinkTitle")}}})},renderers:{right:kity.createClass("hyperlinkrender",{base:Renderer,create:function(){var link=new kity.HyperLink,linkshape=new kity.Path,outline=new kity.Rect(24,22,-2,-6,4).fill("rgba(255, 255, 255, 0)");return linkshape.setPathData("M16.614,10.224h-1.278c-1.668,0-3.07-1.07-3.599-2.556h4.877c0.707,0,1.278-0.571,1.278-1.278V3.834 c0-0.707-0.571-1.278-1.278-1.278h-4.877C12.266,1.071,13.668,0,15.336,0h1.278c2.116,0,3.834,1.716,3.834,3.834V6.39 C20.448,8.508,18.73,10.224,16.614,10.224z M5.112,5.112c0-0.707,0.573-1.278,1.278-1.278h7.668c0.707,0,1.278,0.571,1.278,1.278 S14.765,6.39,14.058,6.39H6.39C5.685,6.39,5.112,5.819,5.112,5.112z M2.556,3.834V6.39c0,0.707,0.573,1.278,1.278,1.278h4.877 c-0.528,1.486-1.932,2.556-3.599,2.556H3.834C1.716,10.224,0,8.508,0,6.39V3.834C0,1.716,1.716,0,3.834,0h1.278 c1.667,0,3.071,1.071,3.599,2.556H3.834C3.129,2.556,2.556,3.127,2.556,3.834z").fill("#666"),link.addShape(outline),link.addShape(linkshape),link.setTarget("_blank"),link.setStyle("cursor","pointer"),link.on("mouseover",(function(){outline.fill("rgba(255, 255, 200, .8)")})).on("mouseout",(function(){outline.fill("rgba(255, 255, 255, 0)")})),link},shouldRender:function(node){return node.getData("hyperlink")},update:function(link,node,box){var href=node.getData("hyperlink");link.setHref("#");for(var allowed=["^http:","^https:","^ftp:","^mailto:"],i=0;i<allowed.length;i++){if(new RegExp(allowed[i]).test(href)){link.setHref(href);break}}var title=node.getData("hyperlinkTitle");title=title?[title,"(",href,")"].join(""):href,link.node.setAttributeNS("http://www.w3.org/1999/xlink","title",title);var spaceRight=node.getStyle("space-right");return link.setTranslate(box.right+spaceRight+2,-5),new kity.Box({x:box.right+spaceRight,y:-11,width:24,height:22})}})}})}},_p[49]={value:function(require,exports,module){var kity=_p.r(17),keymap=_p.r(15),Module=_p.r(20);_p.r(9);Module.register("ImageViewer",(function(){function createEl(name,classNames,children){var el=document.createElement(name);return addClass(el,classNames),children&&children.length&&children.forEach((function(child){el.appendChild(child)})),el}function on(el,event,handler){el.addEventListener(event,handler)}function addClass(el,classNames){classNames&&classNames.split(" ").forEach((function(className){el.classList.add(className)}))}var ImageViewer=kity.createClass("ImageViewer",{constructor:function(){var btnClose=createEl("button","km-image-viewer-btn km-image-viewer-close"),btnSource=createEl("button","km-image-viewer-btn km-image-viewer-source"),image=this.image=createEl("img"),toolbar=this.toolbar=createEl("div","km-image-viewer-toolbar",[btnSource,btnClose]),container=createEl("div","km-image-viewer-container",[image]),viewer=this.viewer=createEl("div","km-image-viewer",[toolbar,container]);this.hotkeyHandler=this.hotkeyHandler.bind(this),on(btnClose,"click",this.close.bind(this)),on(btnSource,"click",this.viewSource.bind(this)),on(image,"click",this.zoomImage.bind(this)),on(viewer,"contextmenu",this.toggleToolbar.bind(this)),on(document,"keydown",this.hotkeyHandler)},dispose:function(){this.close(),document.removeEventListener("remove",this.hotkeyHandler)},hotkeyHandler:function(e){this.actived&&e.keyCode===keymap.esc&&this.close()},toggleToolbar:function(e){e&&e.preventDefault(),this.toolbar.classList.toggle("hidden")},zoomImage:function(restore){var image=this.image;"boolean"==typeof restore?restore&&addClass(image,"limited"):image.classList.toggle("limited")},viewSource:function(src){window.open(this.image.src)},open:function(src){var input=document.querySelector("input");input&&(input.focus(),input.blur()),this.image.src=src,this.zoomImage(!0),document.body.appendChild(this.viewer),this.actived=!0},close:function(){this.image.src="",document.body.removeChild(this.viewer),this.actived=!1}});return{init:function(){this.viewer=new ImageViewer},events:{"normal.dblclick":function(e){var shape=e.kityEvent.targetShape;"Image"===shape.__KityClassName&&shape.url&&this.viewer.open(shape.url)}}}}))}},_p[50]={value:function(require,exports,module){var kity=_p.r(17),Command=(_p.r(33),_p.r(19),_p.r(21),_p.r(9)),Module=_p.r(20),Renderer=_p.r(27);Module.register("image",(function(){return{defaultOptions:{maxImageWidth:200,maxImageHeight:200},commands:{image:kity.createClass("ImageCommand",{base:Command,execute:function(km,url,title){var nodes=km.getSelectedNodes();!function loadImageSize(url,callback){var img=document.createElement("img");img.onload=function(){callback(img.width,img.height)},img.onerror=function(){callback(null)},img.src=url}(url,(function(width,height){nodes.forEach((function(n){var size=function fitImageSize(width,height,maxWidth,maxHeight){var ratio=width/height;return width>maxWidth&&ratio>maxWidth/maxHeight?height=(width=maxWidth)/ratio:height>maxHeight&&(width=(height=maxHeight)*ratio),{width:0|width,height:0|height}}(width,height,km.getOption("maxImageWidth"),km.getOption("maxImageHeight"));n.setData("image",url),n.setData("imageTitle",url&&title),n.setData("imageSize",url&&size),n.render()})),km.fire("saveScene"),km.layout(300)}))},queryState:function(km){var nodes=km.getSelectedNodes(),result=0;return 0===nodes.length?-1:(nodes.forEach((function(n){if(n&&n.getData("image"))return result=0,!1})),result)},queryValue:function(km){var node=km.getSelectedNode();return{url:node.getData("image"),title:node.getData("imageTitle")}}})},renderers:{top:kity.createClass("ImageRenderer",{base:Renderer,create:function(node){return new kity.Image(node.getData("image"))},shouldRender:function(node){return node.getData("image")},update:function(image,node,box){var url=node.getData("image"),title=node.getData("imageTitle"),size=node.getData("imageSize"),spaceTop=node.getStyle("space-top");if(size){title&&image.node.setAttributeNS("http://www.w3.org/1999/xlink","title",title);var x=box.cx-size.width/2,y=box.y-size.height-spaceTop;return image.setUrl(url).setX(0|x).setY(0|y).setWidth(0|size.width).setHeight(0|size.height),new kity.Box(0|x,0|y,0|size.width,0|size.height)}}})}}}))}},_p[51]={value:function(require,exports,module){_p.r(17),_p.r(33),_p.r(15),_p.r(19),_p.r(21),_p.r(9);var Module=_p.r(20);_p.r(27);Module.register("KeyboardModule",(function(){var min=Math.min,max=Math.max,sqrt=(Math.abs,Math.sqrt);Math.exp;function buildPositionNetwork(root){var p,pointIndexes=[];root.traverse((function(node){(p=node.getLayoutBox()).width&&p.height&&pointIndexes.push({left:p.x,top:p.y,right:p.x+p.width,bottom:p.y+p.height,width:p.width,height:p.height,node})}));for(var i=0;i<pointIndexes.length;i++)findClosestPointsFor(pointIndexes,i)}function getCoefedDistance(box1,box2){var xMin,xMax,yMin,yMax,xDist,yDist,dist;xMin=min(box1.left,box2.left),xMax=max(box1.right,box2.right),yMin=min(box1.top,box2.top),yMax=max(box1.bottom,box2.bottom),xDist=xMax-xMin-box1.width-box2.width,yDist=yMax-yMin-box1.height-box2.height,dist=xDist<0?yDist:yDist<0?xDist:sqrt(xDist*xDist+yDist*yDist);var node1=box1.node,node2=box2.node;return node1.parent==node2.parent&&(dist/=10),node2.parent==node1&&(dist/=5),dist}function findClosestPointsFor(pointIndexes,iFind){for(var current,dist,find=pointIndexes[iFind],most={},i=0;i<pointIndexes.length;i++)i!=iFind&&(dist=getCoefedDistance(current=pointIndexes[i],find),current.right<find.left&&(!most.left||dist<most.left.dist)&&(most.left={dist,node:current.node}),current.left>find.right&&(!most.right||dist<most.right.dist)&&(most.right={dist,node:current.node}),current.bottom<find.top&&(!most.top||dist<most.top.dist)&&(most.top={dist,node:current.node}),current.top>find.bottom&&(!most.down||dist<most.down.dist)&&(most.down={dist,node:current.node}));find.node._nearestNodes={right:most.right&&most.right.node||null,top:most.top&&most.top.node||null,left:most.left&&most.left.node||null,down:most.down&&most.down.node||null}}return{events:{layoutallfinish:function(){buildPositionNetwork(this.getRoot())},"normal.keydown readonly.keydown":function(e){var minder=this;["left","right","up","down"].forEach((function(key){e.isShortcutKey(key)&&(!function navigateTo(km,direction){var referNode=km.getSelectedNode();if(!referNode)return km.select(km.getRoot()),void buildPositionNetwork(km.getRoot());referNode._nearestNodes||buildPositionNetwork(km.getRoot());var nextNode=referNode._nearestNodes[direction];nextNode&&km.select(nextNode,!0)}(minder,"up"==key?"top":key),e.preventDefault())}))}}}}))}},_p[52]={value:function(require,exports,module){var kity=_p.r(17),Command=_p.r(9),Module=_p.r(20),LayoutCommand=kity.createClass("LayoutCommand",{base:Command,execute:function(minder,name){minder.getSelectedNodes().forEach((function(node){node.layout(name)}))},queryValue:function(minder){var node=minder.getSelectedNode();if(node)return node.getData("layout")},queryState:function(minder){return minder.getSelectedNode()?0:-1}}),ResetLayoutCommand=kity.createClass("ResetLayoutCommand",{base:Command,execute:function(minder){var nodes=minder.getSelectedNodes();nodes.length||(nodes=[minder.getRoot()]),nodes.forEach((function(node){node.traverse((function(child){child.resetLayoutOffset(),child.isRoot()||child.setData("layout",null)}))})),minder.layout(300)},enableReadOnly:!0});Module.register("LayoutModule",{commands:{layout:LayoutCommand,resetlayout:ResetLayoutCommand},contextmenu:[{command:"resetlayout"},{divider:!0}],commandShortcutKeys:{resetlayout:"Ctrl+Shift+L"}})}},_p[53]={value:function(require,exports,module){var kity=_p.r(17),MinderNode=(_p.r(33),_p.r(19),_p.r(21)),Command=_p.r(9),Module=_p.r(20),AppendChildCommand=(_p.r(27),kity.createClass("AppendChildCommand",{base:Command,execute:function(km,text){var parent=km.getSelectedNode();if(!parent)return null;var node=km.createNode(text,parent);km.select(node,!0),parent.isExpanded()?node.render():(parent.expand(),parent.renderTree()),km.layout(600)},queryState:function(km){return km.getSelectedNode()?0:-1}})),AppendSiblingCommand=kity.createClass("AppendSiblingCommand",{base:Command,execute:function(km,text){var sibling=km.getSelectedNode(),parent=sibling.parent;if(!parent)return km.execCommand("AppendChildNode",text);var node=km.createNode(text,parent,sibling.getIndex()+1);node.setGlobalLayoutTransform(sibling.getGlobalLayoutTransform()),km.select(node,!0),node.render(),km.layout(600)},queryState:function(km){return km.getSelectedNode()?0:-1}}),RemoveNodeCommand=kity.createClass("RemoverNodeCommand",{base:Command,execute:function(km){var nodes=km.getSelectedNodes(),ancestor=MinderNode.getCommonAncestor.apply(null,nodes),index=nodes[0].getIndex();if(nodes.forEach((function(node){node.isRoot()||km.removeNode(node)})),1==nodes.length){var selectBack=ancestor.children[index-1]||ancestor.children[index];km.select(selectBack||ancestor||km.getRoot(),!0)}else km.select(ancestor||km.getRoot(),!0);km.layout(600)},queryState:function(km){var selectedNode=km.getSelectedNode();return selectedNode&&!selectedNode.isRoot()?0:-1}}),AppendParentCommand=kity.createClass("AppendParentCommand",{base:Command,execute:function(km,text){var nodes=km.getSelectedNodes();nodes.sort((function(a,b){return a.getIndex()-b.getIndex()}));var parent=nodes[0].parent,newParent=km.createNode(text,parent,nodes[0].getIndex());nodes.forEach((function(node){newParent.appendChild(node)})),newParent.setGlobalLayoutTransform(nodes[nodes.length>>1].getGlobalLayoutTransform()),km.select(newParent,!0),km.layout(600)},queryState:function(km){var nodes=km.getSelectedNodes();if(!nodes.length)return-1;var parent=nodes[0].parent;if(!parent)return-1;for(var i=1;i<nodes.length;i++)if(nodes[i].parent!=parent)return-1;return 0}});Module.register("NodeModule",(function(){return{commands:{AppendChildNode:AppendChildCommand,AppendSiblingNode:AppendSiblingCommand,RemoveNode:RemoveNodeCommand,AppendParentNode:AppendParentCommand},commandShortcutKeys:{appendsiblingnode:"normal::Enter",appendchildnode:"normal::Insert|Tab",appendparentnode:"normal::Shift+Tab|normal::Shift+Insert",removenode:"normal::Del|Backspace"}}}))}},_p[54]={value:function(require,exports,module){var kity=_p.r(17),Command=(_p.r(33),_p.r(19),_p.r(21),_p.r(9)),Module=_p.r(20),Renderer=_p.r(27);Module.register("NoteModule",(function(){var NoteCommand=kity.createClass("NoteCommand",{base:Command,execute:function(minder,note){var node=minder.getSelectedNode();node.setData("note",note),node.render(),node.getMinder().layout(300)},queryState:function(minder){return 1===minder.getSelectedNodes().length?0:-1},queryValue:function(minder){var node=minder.getSelectedNode();return node&&node.getData("note")}}),NoteIcon=kity.createClass("NoteIcon",{base:kity.Group,constructor:function(){this.callBase(),this.width=16,this.height=17,this.rect=new kity.Rect(16,17,.5,-8.5,2).fill("transparent"),this.path=(new kity.Path).setPathData("M9,9H3V8h6L9,9L9,9z M9,7H3V6h6V7z M9,5H3V4h6V5z M8.5,11H2V2h8v7.5 M9,12l2-2V1H1v11").setTranslate(2.5,-6.5),this.addShapes([this.rect,this.path]),this.on("mouseover",(function(){this.rect.fill("rgba(255, 255, 200, .8)")})).on("mouseout",(function(){this.rect.fill("transparent")})),this.setStyle("cursor","pointer")}});return{renderers:{right:kity.createClass("NoteIconRenderer",{base:Renderer,create:function(node){var icon=new NoteIcon;return icon.on("mousedown",(function(e){e.preventDefault(),node.getMinder().fire("editnoterequest")})),icon.on("mouseover",(function(){node.getMinder().fire("shownoterequest",{node,icon})})),icon.on("mouseout",(function(){node.getMinder().fire("hidenoterequest",{node,icon})})),icon},shouldRender:function(node){return node.getData("note")},update:function(icon,node,box){var x=box.right+node.getStyle("space-left"),y=box.cy;return icon.path.fill(node.getStyle("color")),icon.setTranslate(x,y),new kity.Box(x,Math.round(y-icon.height/2),icon.width,icon.height)}})},commands:{note:NoteCommand}}}))}},_p[55]={value:function(require,exports,module){var kity=_p.r(17),utils=_p.r(33),Module=(_p.r(19),_p.r(21),_p.r(9),_p.r(20)),Renderer=_p.r(27),OutlineRenderer=kity.createClass("OutlineRenderer",{base:Renderer,create:function(node){var outline=(new kity.Rect).setId(utils.uuid("node_outline"));return this.bringToBack=!0,outline},update:function(outline,node,box){var shape=node.getStyle("shape"),paddingLeft=node.getStyle("padding-left"),paddingRight=node.getStyle("padding-right"),paddingTop=node.getStyle("padding-top"),paddingBottom=node.getStyle("padding-bottom"),outlineBox={x:box.x-paddingLeft,y:box.y-paddingTop,width:box.width+paddingLeft+paddingRight,height:box.height+paddingTop+paddingBottom},radius=node.getStyle("radius");if(shape&&"circle"==shape){var p=Math.pow;radius=(0,Math.round)(Math.sqrt(p(outlineBox.width,2)+p(outlineBox.height,2))/2),outlineBox.x=box.cx-radius,outlineBox.y=box.cy-radius,outlineBox.width=2*radius,outlineBox.height=2*radius}var prefix=node.isSelected()?node.getMinder().isFocused()?"selected-":"blur-selected-":"";return outline.setPosition(outlineBox.x,outlineBox.y).setSize(outlineBox.width,outlineBox.height).setRadius(radius).fill(node.getData("background")||node.getStyle(prefix+"background")||node.getStyle("background")).stroke(node.getStyle(prefix+"stroke"||0),node.getStyle(prefix+"stroke-width")),new kity.Box(outlineBox)}}),ShadowRenderer=kity.createClass("ShadowRenderer",{base:Renderer,create:function(node){return this.bringToBack=!0,new kity.Rect},shouldRender:function(node){return node.getStyle("shadow")},update:function(shadow,node,box){shadow.setPosition(box.x+4,box.y+5).fill(node.getStyle("shadow"));var shape=node.getStyle("shape");if(shape){if("circle"==shape){var width=Math.max(box.width,box.height);shadow.setSize(width,width),shadow.setRadius(width/2)}}else shadow.setSize(box.width,box.height),shadow.setRadius(node.getStyle("radius"))}}),marker=new kity.Marker;marker.setWidth(10),marker.setHeight(12),marker.setRef(0,0),marker.setViewBox(-6,-4,8,10),marker.addShape((new kity.Path).setPathData("M-5-3l5,3,-5,3").stroke("#33ffff"));var wireframeOption=/wire/.test(window.location.href),WireframeRenderer=kity.createClass("WireframeRenderer",{base:Renderer,create:function(){var wireframe=new kity.Group,oxy=this.oxy=(new kity.Path).stroke("#f6f").setPathData("M0,-50L0,50M-50,0L50,0"),box=this.wireframe=(new kity.Rect).stroke("lightgreen"),vectorIn=this.vectorIn=(new kity.Path).stroke("#66ffff"),vectorOut=this.vectorOut=(new kity.Path).stroke("#66ffff");return vectorIn.setMarker(marker,"end"),vectorOut.setMarker(marker,"end"),wireframe.addShapes([oxy,box,vectorIn,vectorOut])},shouldRender:function(){return wireframeOption},update:function(created,node,box){this.wireframe.setPosition(box.x,box.y).setSize(box.width,box.height);var pin=node.getVertexIn(),pout=node.getVertexOut(),vin=node.getLayoutVectorIn().normalize(30),vout=node.getLayoutVectorOut().normalize(30);this.vectorIn.setPathData(["M",pin.offset(vin.reverse()),"L",pin]),this.vectorOut.setPathData(["M",pout,"l",vout])}});Module.register("OutlineModule",(function(){return{events:wireframeOption?{ready:function(){this.getPaper().addResource(marker)},layoutallfinish:function(){this.getRoot().traverse((function(node){node.getRenderer("WireframeRenderer").update(null,node,node.getContentBox())}))}}:null,renderers:{outline:OutlineRenderer,outside:[ShadowRenderer,WireframeRenderer]}}}))}},_p[56]={value:function(require,exports,module){var kity=_p.r(17),utils=_p.r(33),Command=(_p.r(19),_p.r(21),_p.r(9)),Module=_p.r(20),Renderer=_p.r(27);Module.register("PriorityModule",(function(){var PRIORITY_COLORS=[null,["#FF1200","#840023"],["#0074FF","#01467F"],["#00AF00","#006300"],["#FF962E","#B25000"],["#A464FF","#4720C4"],["#A3A3A3","#515151"],["#A3A3A3","#515151"],["#A3A3A3","#515151"],["#A3A3A3","#515151"]],MASK_PATH="M20,10c0,3.866-3.134,7-7,7H7c-3.866,0-7-3.134-7-7V7c0-3.866,3.134-7,7-7h6c3.866,0,7,3.134,7,7V10z",PriorityIcon=kity.createClass("PriorityIcon",{base:kity.Group,constructor:function(){this.callBase(),this.setSize(20),this.create(),this.setId(utils.uuid("node_priority"))},setSize:function(size){this.width=this.height=size},create:function(){var back,mask,number;(new kity.Path).setPathData(MASK_PATH).fill("white"),back=(new kity.Path).setPathData("M0,13c0,3.866,3.134,7,7,7h6c3.866,0,7-3.134,7-7V7H0V13z").setTranslate(.5,.5),mask=(new kity.Path).setPathData(MASK_PATH).setOpacity(.8).setTranslate(.5,.5),number=(new kity.Text).setX(this.width/2-.5).setY(this.height/2).setTextAnchor("middle").setVerticalAlign("middle").setFontItalic(!0).setFontSize(12).fill("white"),this.addShapes([back,mask,number]),this.mask=mask,this.back=back,this.number=number},setValue:function(value){var back=this.back,mask=this.mask,number=this.number,color=PRIORITY_COLORS[value];color&&(back.fill(color[1]),mask.fill(color[0])),number.setContent(value)}});return{commands:{priority:kity.createClass("SetPriorityCommand",{base:Command,execute:function(km,value){for(var nodes=km.getSelectedNodes(),i=0;i<nodes.length;i++)nodes[i].setData("priority",value||null).render();km.layout()},queryValue:function(km){for(var val,nodes=km.getSelectedNodes(),i=0;i<nodes.length&&!(val=nodes[i].getData("priority"));i++);return val||null},queryState:function(km){return km.getSelectedNodes().length?0:-1}})},renderers:{left:kity.createClass("PriorityRenderer",{base:Renderer,create:function(node){return new PriorityIcon},shouldRender:function(node){return node.getData("priority")},update:function(icon,node,box){var x,y,data=node.getData("priority"),spaceLeft=node.getStyle("space-left");return icon.setValue(data),x=box.left-icon.width-spaceLeft,y=-icon.height/2,icon.setTranslate(x,y),new kity.Box({x,y,width:icon.width,height:icon.height})}})}}}))}},_p[57]={value:function(require,exports,module){var kity=_p.r(17),utils=_p.r(33),Command=(_p.r(19),_p.r(21),_p.r(9)),Module=_p.r(20),Renderer=_p.r(27);Module.register("ProgressModule",(function(){var FRAME_GRAD=(new kity.LinearGradient).pipe((function(g){g.setStartPosition(0,0),g.setEndPosition(0,1),g.addStop(0,"#fff"),g.addStop(1,"#ccc")}));this.getPaper().addResource(FRAME_GRAD);var ProgressIcon=kity.createClass("ProgressIcon",{base:kity.Group,constructor:function(value){this.callBase(),this.setSize(20),this.create(),this.setValue(value),this.setId(utils.uuid("node_progress")),this.translate(.5,.5)},setSize:function(size){this.width=this.height=size},create:function(){var bg,pie,shadow,frame,check;bg=new kity.Circle(9).fill("#FFED83"),pie=new kity.Pie(9,0).fill("#43BC00"),shadow=(new kity.Path).setPathData("M10,3c4.418,0,8,3.582,8,8h1c0-5.523-3.477-10-9-10S1,5.477,1,11h1C2,6.582,5.582,3,10,3z").setTranslate(-10,-10).fill("#8E8E8E"),frame=(new kity.Path).setTranslate(-10,-10).setPathData("M10,0C4.477,0,0,4.477,0,10c0,5.523,4.477,10,10,10s10-4.477,10-10C20,4.477,15.523,0,10,0zM10,18c-4.418,0-8-3.582-8-8s3.582-8,8-8s8,3.582,8,8S14.418,18,10,18z").fill(FRAME_GRAD),check=(new kity.Path).setTranslate(-10,-10).setPathData("M15.812,7.896l-6.75,6.75l-4.5-4.5L6.25,8.459l2.812,2.803l5.062-5.053L15.812,7.896z").fill("#EEE"),this.addShapes([bg,pie,shadow,check,frame]),this.pie=pie,this.check=check},setValue:function(value){this.pie.setAngle(-360*(value-1)/8),this.check.setVisible(9==value)}});return{commands:{progress:kity.createClass("ProgressCommand",{base:Command,execute:function(km,value){for(var nodes=km.getSelectedNodes(),i=0;i<nodes.length;i++)nodes[i].setData("progress",value||null).render();km.layout()},queryValue:function(km){for(var val,nodes=km.getSelectedNodes(),i=0;i<nodes.length&&!(val=nodes[i].getData("progress"));i++);return val||null},queryState:function(km){return km.getSelectedNodes().length?0:-1}})},renderers:{left:kity.createClass("ProgressRenderer",{base:Renderer,create:function(node){return new ProgressIcon},shouldRender:function(node){return node.getData("progress")},update:function(icon,node,box){var x,y,data=node.getData("progress"),spaceLeft=node.getStyle("space-left");return icon.setValue(data),x=box.left-icon.width-spaceLeft,y=-icon.height/2,icon.setTranslate(x+icon.width/2,y+icon.height/2),new kity.Box(x,y,icon.width,icon.height)}})}}}))}},_p[58]={value:function(require,exports,module){var kity=_p.r(17),Minder=(_p.r(33),_p.r(19)),Command=(_p.r(21),_p.r(9)),Module=_p.r(20),Renderer=_p.r(27);Module.register("Resource",(function(){var k,g,r,l,m,o,p,q,t,w,blake32=(k=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],m=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479],w=function(i){return i<0&&(i+=4294967296),("00000000"+i.toString(16)).slice(-8)},o=[[16,50,84,118,152,186,220,254],[174,132,249,109,193,32,123,53],[139,12,37,223,234,99,23,73],[151,19,205,235,98,165,4,143],[9,117,66,250,30,203,134,211],[194,166,176,56,212,87,239,145],[92,241,222,164,112,54,41,184],[189,231,28,147,5,79,104,162],[246,158,59,128,44,125,65,90],[42,72,103,81,191,233,195,13]],p=function(a,b,n){var s=q[a]^q[b];q[a]=s>>>n|s<<32-n},g=function(i,a,b,c,d){var u=l+o[r][i]%16,v=l+(o[r][i]>>4);b=4+b%4,c=8+c%4,d=12+d%4,q[a%=4]+=q[b]+(t[u]^m[v%16]),p(d,a,16),q[c]+=q[d],p(b,c,12),q[a]+=q[b]+(t[v]^m[u%16]),p(d,a,8),q[c]+=q[d],p(b,c,7)},function(a,b){var c,d,e,L,f,h,j,i;for(b instanceof Array&&4===b.length||(b=[0,0,0,0]),d=k.slice(0),c=m.slice(0,8),r=0;r<4;r+=1)c[r]^=b[r];if(f=(e=16*a.length)%512>446||e%512==0?0:e,e%512==432)a+="老";else{for(a+="耀";a.length%32!=27;)a+="\0";a+=""}for(t=[],i=0;i<a.length;i+=2)t.push(65536*a.charCodeAt(i)+a.charCodeAt(i+1));for(t.push(0),t.push(e),h=t.length-16,j=0,l=0;l<t.length;l+=16){for(j+=512,L=l===h?f:Math.min(e,j),(q=d.concat(c))[12]^=L,q[13]^=L,r=0;r<10;r+=1)for(i=0;i<8;i+=1)i<4?g(i,i,i,i,i):g(i,i,i+1,i+2,i+3);for(i=0;i<8;i+=1)d[i]^=b[i%4]^q[i]^q[i+8]}return d.map(w).join("")}),RESOURCE_COLOR_SERIES=[51,303,75,200,157,0,26,254].map((function(h){return kity.Color.createHSL(h,100,85)}));kity.extendClass(Minder,{getHashCode:function(str){var i,hash=1315423911;for(i=(str=blake32(str)).length-1;i>=0;i--)hash^=(hash<<5)+str.charCodeAt(i)+(hash>>2);return 2147483647&hash},getResourceColor:function(resource){var nextIndex,colorMapping=this._getResourceColorIndexMapping();return Object.prototype.hasOwnProperty.call(colorMapping,resource)||(nextIndex=this._getNextResourceColorIndex(),colorMapping[resource]=nextIndex),RESOURCE_COLOR_SERIES[colorMapping[resource]]||kity.Color.createHSL(Math.floor(this.getHashCode(resource)/2147483647*359),100,85)},getUsedResource:function(){var resource,mapping=this._getResourceColorIndexMapping(),used=[];for(resource in mapping)Object.prototype.hasOwnProperty.call(mapping,resource)&&used.push(resource);return used},_getNextResourceColorIndex:function(){var resource,used,i,colorMapping=this._getResourceColorIndexMapping();for(resource in used=[],colorMapping)Object.prototype.hasOwnProperty.call(colorMapping,resource)&&used.push(colorMapping[resource]);for(i=0;i<RESOURCE_COLOR_SERIES.length;i++)if(!~used.indexOf(i))return i;return-1},_getResourceColorIndexMapping:function(){return this._resourceColorMapping||(this._resourceColorMapping={})}});var ResourceCommand=kity.createClass("ResourceCommand",{base:Command,execute:function(minder,resource){var nodes=minder.getSelectedNodes();"string"==typeof resource&&(resource=[resource]),nodes.forEach((function(node){node.setData("resource",resource).render()})),minder.layout(200)},queryValue:function(minder){var nodes=minder.getSelectedNodes(),resource=[];return nodes.forEach((function(node){var nodeResource=node.getData("resource");nodeResource&&nodeResource.forEach((function(name){~resource.indexOf(name)||resource.push(name)}))})),resource},queryState:function(km){return km.getSelectedNode()?0:-1}}),ResourceOverlay=kity.createClass("ResourceOverlay",{base:kity.Group,constructor:function(){var text,rect;this.callBase(),rect=this.rect=(new kity.Rect).setRadius(4),text=this.text=(new kity.Text).setFontSize(12).setVerticalAlign("middle"),this.addShapes([rect,text])},setValue:function(resourceName,color){var text,box,rect;text=this.text,resourceName==this.lastResourceName?box=this.lastBox:(text.setContent(resourceName),box=text.getBoundaryBox(),this.lastResourceName=resourceName,this.lastBox=box),text.setX(8).fill(color.dec("l",70)),(rect=this.rect).setPosition(0,box.y-4),this.width=Math.round(box.width+16),this.height=Math.round(box.height+8),rect.setSize(this.width,this.height),rect.fill(color)}});return{commands:{resource:ResourceCommand},renderers:{right:kity.createClass("ResourceRenderer",{base:Renderer,create:function(node){return this.overlays=[],new kity.Group},shouldRender:function(node){return node.getData("resource")&&node.getData("resource").length},update:function(container,node,box){var spaceRight=node.getStyle("space-right"),overlays=this.overlays,resource=node.getData("resource").filter((function(ele){return null!==ele}));if(0!==resource.length){var i,overlay,x,minder=node.getMinder();for(x=0,i=0;i<resource.length;i++)x+=spaceRight,(overlay=overlays[i])||(overlay=new ResourceOverlay,overlays.push(overlay),container.addShape(overlay)),overlay.setVisible(!0),overlay.setValue(resource[i],minder.getResourceColor(resource[i])),overlay.setTranslate(x,-1),x+=overlay.width;for(;overlay=overlays[i++];)overlay.setVisible(!1);return container.setTranslate(box.right,0),new kity.Box({x:box.right,y:Math.round(-overlays[0].height/2),width:x,height:overlays[0].height})}}})}}}))}},_p[59]={value:function(require,exports,module){var kity=_p.r(17),Module=(_p.r(33),_p.r(19),_p.r(21),_p.r(9),_p.r(20));_p.r(27);Module.register("Select",(function(){var startPosition,marqueeShape,marqueeMode,minder=this,rc=minder.getRenderContainer(),marqueeActivator=(startPosition=null,marqueeShape=new kity.Path,marqueeMode=!1,{selectStart:function(e){if(!e.originEvent.button&&!e.originEvent.altKey)return startPosition?this.selectEnd():void(startPosition=e.getPosition(rc).round())},selectMove:function(e){if("textedit"!=minder.getStatus()&&startPosition){var p1=startPosition,p2=e.getPosition(rc);if(!marqueeMode){if(kity.Vector.fromPoints(p1,p2).length()<10)return;marqueeMode=!0,rc.addShape(marqueeShape),marqueeShape.fill(minder.getStyle("marquee-background")).stroke(minder.getStyle("marquee-stroke")).setOpacity(.8).getDrawer().clear()}var marquee=new kity.Box(p1.x,p1.y,p2.x-p1.x,p2.y-p1.y),selectedNodes=[];marquee.left=Math.round(marquee.left),marquee.top=Math.round(marquee.top),marquee.right=Math.round(marquee.right),marquee.bottom=Math.round(marquee.bottom),marqueeShape.getDrawer().pipe((function(){this.clear(),this.moveTo(marquee.left,marquee.top),this.lineTo(marquee.right,marquee.top),this.lineTo(marquee.right,marquee.bottom),this.lineTo(marquee.left,marquee.bottom),this.close()})),minder.getRoot().traverse((function(node){node.getLayoutBox().intersect(marquee).isEmpty()||selectedNodes.push(node)})),minder.select(selectedNodes,!0),window.getSelection().removeAllRanges()}},selectEnd:function(e){startPosition&&(startPosition=null),marqueeMode&&(marqueeShape.fadeOut(200,"ease",0,(function(){marqueeShape.remove&&marqueeShape.remove()})),marqueeMode=!1)}}),lastDownNode=null,lastDownPosition=null;return{init:function(){window.addEventListener("mouseup",(function(){marqueeActivator.selectEnd()}))},events:{mousedown:function(e){var downNode=e.getTargetNode();downNode?e.isShortcutKey("Ctrl")?this.toggleSelect(downNode):downNode.isSelected()?this.isSingleSelect()||(lastDownNode=downNode,lastDownPosition=e.getPosition()):this.select(downNode,!0):(this.removeAllSelectedNodes(),marqueeActivator.selectStart(e),this.setStatus("normal"))},mousemove:marqueeActivator.selectMove,mouseup:function(e){var upNode=e.getTargetNode();if(upNode&&upNode==lastDownNode){var upPosition=e.getPosition();kity.Vector.fromPoints(lastDownPosition,upPosition).length()<1&&this.select(lastDownNode,!0),lastDownNode=null}marqueeActivator.selectEnd(e)},"normal.keydown":function(e){if(e.isShortcutKey("ctrl+a")){var selectedNodes=[];this.getRoot().traverse((function(node){selectedNodes.push(node)})),this.select(selectedNodes,!0),e.preventDefault()}}}}}))}},_p[60]={value:function(require,exports,module){var kity=_p.r(17),Command=(_p.r(33),_p.r(19),_p.r(21),_p.r(9)),Module=_p.r(20);_p.r(27);Module.register("StyleModule",(function(){var styleNames=["font-size","font-family","font-weight","font-style","background","color"],styleClipBoard=null;function hasStyle(node){for(var data=node.getData(),i=0;i<styleNames.length;i++)if(styleNames[i]in data)return!0}return{commands:{copystyle:kity.createClass("CopyStyleCommand",{base:Command,execute:function(minder){var nodeData=minder.getSelectedNode().getData();return styleClipBoard={},styleNames.forEach((function(name){name in nodeData?styleClipBoard[name]=nodeData[name]:(styleClipBoard[name]=null,delete styleClipBoard[name])})),styleClipBoard},queryState:function(minder){var nodes=minder.getSelectedNodes();return 1!==nodes.length?-1:hasStyle(nodes[0])?0:-1}}),pastestyle:kity.createClass("PastStyleCommand",{base:Command,execute:function(minder){return minder.getSelectedNodes().forEach((function(node){for(var name in styleClipBoard)styleClipBoard.hasOwnProperty(name)&&node.setData(name,styleClipBoard[name])})),minder.renderNodeBatch(minder.getSelectedNodes()),minder.layout(300),styleClipBoard},queryState:function(minder){return styleClipBoard&&minder.getSelectedNodes().length?0:-1}}),clearstyle:kity.createClass("ClearStyleCommand",{base:Command,execute:function(minder){return minder.getSelectedNodes().forEach((function(node){styleNames.forEach((function(name){node.setData(name)}))})),minder.renderNodeBatch(minder.getSelectedNodes()),minder.layout(300),styleClipBoard},queryState:function(minder){var nodes=minder.getSelectedNodes();if(!nodes.length)return-1;for(var i=0;i<nodes.length;i++)if(hasStyle(nodes[i]))return 0;return-1}})}}}))}},_p[61]={value:function(require,exports,module){var kity=_p.r(17),utils=_p.r(33),MinderNode=(_p.r(19),_p.r(21)),Command=_p.r(9),Module=_p.r(20),Renderer=_p.r(27),FONT_ADJUST={safari:{"微软雅黑,Microsoft YaHei":-.17,"楷体,楷体_GB2312,SimKai":-.1,"隶书, SimLi":-.1,"comic sans ms":-.23,"impact,chicago":-.15,"times new roman":-.1,"arial black,avant garde":-.17,default:0},ie:{10:{"微软雅黑,Microsoft YaHei":-.17,"comic sans ms":-.17,"impact,chicago":-.08,"times new roman":.04,"arial black,avant garde":-.17,default:-.15},11:{"微软雅黑,Microsoft YaHei":-.17,"arial,helvetica,sans-serif":-.17,"comic sans ms":-.17,"impact,chicago":-.08,"times new roman":.04,"sans-serif":-.16,"arial black,avant garde":-.17,default:-.15}},edge:{"微软雅黑,Microsoft YaHei":-.15,"arial,helvetica,sans-serif":-.17,"comic sans ms":-.17,"impact,chicago":-.08,"sans-serif":-.16,"arial black,avant garde":-.17,default:-.15},sg:{"微软雅黑,Microsoft YaHei":-.15,"arial,helvetica,sans-serif":-.05,"comic sans ms":-.22,"impact,chicago":-.16,"times new roman":-.03,"arial black,avant garde":-.22,default:-.15},chrome:{Mac:{"andale mono":-.05,"comic sans ms":-.3,"impact,chicago":-.13,"times new roman":-.1,"arial black,avant garde":-.17,default:0},Win:{"微软雅黑,Microsoft YaHei":-.15,"arial,helvetica,sans-serif":-.02,"arial black,avant garde":-.2,"comic sans ms":-.2,"impact,chicago":-.12,"times new roman":-.02,default:-.15},Lux:{"andale mono":-.05,"comic sans ms":-.3,"impact,chicago":-.13,"times new roman":-.1,"arial black,avant garde":-.17,default:0}},firefox:{Mac:{"微软雅黑,Microsoft YaHei":-.2,"宋体,SimSun":.05,"comic sans ms":-.2,"impact,chicago":-.15,"arial black,avant garde":-.17,"times new roman":-.1,default:.05},Win:{"微软雅黑,Microsoft YaHei":-.16,"andale mono":-.17,"arial,helvetica,sans-serif":-.17,"comic sans ms":-.22,"impact,chicago":-.23,"times new roman":-.22,"sans-serif":-.22,"arial black,avant garde":-.17,default:-.16},Lux:{"宋体,SimSun":-.2,"微软雅黑,Microsoft YaHei":-.2,"黑体, SimHei":-.2,"隶书, SimLi":-.2,"楷体,楷体_GB2312,SimKai":-.2,"andale mono":-.2,"arial,helvetica,sans-serif":-.2,"comic sans ms":-.2,"impact,chicago":-.2,"times new roman":-.2,"sans-serif":-.2,"arial black,avant garde":-.2,default:-.16}}},TextRenderer=kity.createClass("TextRenderer",{base:Renderer,create:function(){return(new kity.Group).setId(utils.uuid("node_text"))},update:function(textGroup,node){function getDataOrStyle(name){return node.getData(name)||node.getStyle(name)}var adjust,nodeText=node.getText(),textArr=nodeText?nodeText.split("\n"):[" "],lineHeight=node.getStyle("line-height"),fontSize=getDataOrStyle("font-size"),fontFamily=getDataOrStyle("font-family")||"default",yStart=-(lineHeight*fontSize*textArr.length-(lineHeight-1)*fontSize)/2,Browser=kity.Browser;Browser.chrome||Browser.opera||Browser.bd||"chrome"===Browser.lb?adjust=FONT_ADJUST.chrome[Browser.platform][fontFamily]:Browser.gecko?adjust=FONT_ADJUST.firefox[Browser.platform][fontFamily]:Browser.sg?adjust=FONT_ADJUST.sg[fontFamily]:Browser.safari?adjust=FONT_ADJUST.safari[fontFamily]:Browser.ie?adjust=FONT_ADJUST.ie[Browser.version][fontFamily]:Browser.edge?adjust=FONT_ADJUST.edge[fontFamily]:Browser.lb&&(adjust=.9),textGroup.setTranslate(0,(adjust||0)*fontSize);var rBox=new kity.Box,r=Math.round;this.setTextStyle(node,textGroup);var i,textShape,text,textLength=textArr.length,textGroupLength=textGroup.getItems().length;if(textLength<textGroupLength)for(i=textLength;textGroup.getItem(i);)textGroup.removeItem(i);else if(textLength>textGroupLength)for(var growth=textLength-textGroupLength;growth--;)textShape=(new kity.Text).setAttr("text-rendering","inherit"),kity.Browser.ie||kity.Browser.edge?textShape.setVerticalAlign("top"):textShape.setAttr("dominant-baseline","text-before-edge"),textGroup.addItem(textShape);for(i=0;text=textArr[i],textShape=textGroup.getItem(i);i++)textShape.setContent(text),(kity.Browser.ie||kity.Browser.edge)&&textShape.fixPosition();this.setTextStyle(node,textGroup);var textHash=node.getText()+["font-size","font-name","font-weight","font-style"].map(getDataOrStyle).join("/");return node._currentTextHash==textHash&&node._currentTextGroupBox?node._currentTextGroupBox:(node._currentTextHash=textHash,function(){textGroup.eachItem((function(i,textShape){var y=yStart+i*fontSize*lineHeight;textShape.setY(y);var bbox=textShape.getBoundaryBox();rBox=rBox.merge(new kity.Box(0,y,bbox.height&&bbox.width||1,fontSize))}));var nBox=new kity.Box(r(rBox.x),r(rBox.y),r(rBox.width),r(rBox.height));return node._currentTextGroupBox=nBox,nBox})},setTextStyle:function(node,text){TextRenderer._styleHooks.forEach((function(hook){hook(node,text)}))}}),TextCommand=kity.createClass({base:Command,execute:function(minder,text){var node=minder.getSelectedNode();node&&(node.setText(text),node.render(),minder.layout())},queryState:function(minder){return 1==minder.getSelectedNodes().length?0:-1},queryValue:function(minder){var node=minder.getSelectedNode();return node?node.getText():null}});utils.extend(TextRenderer,{_styleHooks:[],registerStyleHook:function(fn){TextRenderer._styleHooks.push(fn)}}),kity.extendClass(MinderNode,{getTextGroup:function(){return this.getRenderer("TextRenderer").getRenderShape()}}),Module.register("text",{commands:{text:TextCommand},renderers:{center:TextRenderer}}),module.exports=TextRenderer}},_p[62]={value:function(require,exports,module){var kity=_p.r(17),Command=(_p.r(33),_p.r(19),_p.r(21),_p.r(9)),Module=_p.r(20),ViewDragger=(_p.r(27),kity.createClass("ViewDragger",{constructor:function(minder){this._minder=minder,this._enabled=!1,this._bind();var me=this;this._minder.getViewDragger=function(){return me},this.setEnabled(!1)},isEnabled:function(){return this._enabled},setEnabled:function(value){var paper=this._minder.getPaper();paper.setStyle("cursor",value?"pointer":"default"),paper.setStyle("cursor",value?"-webkit-grab":"default"),this._enabled=value},timeline:function(){return this._moveTimeline},move:function(offset,duration){this._minder;var targetPosition=this.getMovement().offset(offset);this.moveTo(targetPosition,duration)},moveTo:function(position,duration){if(duration){var dragger=this;return this._moveTimeline&&this._moveTimeline.stop(),this._moveTimeline=this._minder.getRenderContainer().animate(new kity.Animator(this.getMovement(),position,(function(target,value){dragger.moveTo(value)})),duration,"easeOutCubic").timeline(),this._moveTimeline.on("finish",(function(){dragger._moveTimeline=null})),this}this._minder.getRenderContainer().setTranslate(position.round()),this._minder.fire("viewchange")},getMovement:function(){var translate=this._minder.getRenderContainer().transform.translate;return translate?translate[0]:new kity.Point},getView:function(){var minder=this._minder,c=minder._lastClientSize||{width:minder.getRenderTarget().clientWidth,height:minder.getRenderTarget().clientHeight},m=this.getMovement(),box=new kity.Box(0,0,c.width,c.height);return minder.getPaper().getViewPortMatrix().inverse().translate(-m.x,-m.y).transformBox(box)},_bind:function(){var dragger=this,isTempDrag=!1,lastPosition=null,currentPosition=null;function dragEnd(e){lastPosition&&(lastPosition=null,e.stopPropagation(),isTempDrag&&(dragger.setEnabled(!1),isTempDrag=!1,"hand"==dragger._minder.getStatus()&&dragger._minder.rollbackStatus()),dragger._minder.getPaper().setStyle("cursor","hand"==dragger._minder.getStatus()?"-webkit-grab":"default"),dragger._minder.fire("viewchanged"))}this._minder.on("normal.mousedown normal.touchstart inputready.mousedown inputready.touchstart readonly.mousedown readonly.touchstart",(function(e){2==e.originEvent.button&&e.originEvent.preventDefault(),(e.getTargetNode()==this.getRoot()||2==e.originEvent.button||e.originEvent.altKey)&&(lastPosition=e.getPosition("view"),isTempDrag=!0)})).on("normal.mousemove normal.touchmove readonly.mousemove readonly.touchmove inputready.mousemove inputready.touchmove",(function(e){("touchmove"==e.type&&e.preventDefault(),isTempDrag)&&(kity.Vector.fromPoints(lastPosition,e.getPosition("view")).length()>10&&(this.setStatus("hand",!0),dragger._minder.getPaper().setStyle("cursor","-webkit-grabbing")))})).on("hand.beforemousedown hand.beforetouchstart",(function(e){dragger.isEnabled()&&(lastPosition=e.getPosition("view"),e.stopPropagation(),dragger._minder.getPaper().setStyle("cursor","-webkit-grabbing"))})).on("hand.beforemousemove hand.beforetouchmove",(function(e){if(lastPosition){currentPosition=e.getPosition("view");var offset=kity.Vector.fromPoints(lastPosition,currentPosition);dragger.move(offset),e.stopPropagation(),e.preventDefault(),e.originEvent.preventDefault(),lastPosition=currentPosition}})).on("mouseup touchend",dragEnd),window.addEventListener("mouseup",dragEnd),this._minder.on("contextmenu",(function(e){e.preventDefault()}))}}));Module.register("View",(function(){var ToggleHandCommand=kity.createClass("ToggleHandCommand",{base:Command,execute:function(minder){"hand"!=minder.getStatus()?minder.setStatus("hand",!0):minder.rollbackStatus(),this.setContentChanged(!1)},queryState:function(minder){return"hand"==minder.getStatus()?1:0},enableReadOnly:!0}),CameraCommand=kity.createClass("CameraCommand",{base:Command,execute:function(km,focusNode){focusNode=focusNode||km.getRoot();var viewport=km.getPaper().getViewPort(),offset=focusNode.getRenderContainer().getRenderBox("view"),dx=viewport.center.x-offset.x-offset.width/2,dy=viewport.center.y-offset.y,dragger=km._viewDragger,duration=km.getOption("viewAnimationDuration");dragger.move(new kity.Point(dx,dy),duration),this.setContentChanged(!1)},enableReadOnly:!0}),MoveCommand=kity.createClass("MoveCommand",{base:Command,execute:function(km,dir){var dragger=km._viewDragger,size=km._lastClientSize,duration=km.getOption("viewAnimationDuration");switch(dir){case"up":dragger.move(new kity.Point(0,size.height/2),duration);break;case"down":dragger.move(new kity.Point(0,-size.height/2),duration);break;case"left":dragger.move(new kity.Point(size.width/2,0),duration);break;case"right":dragger.move(new kity.Point(-size.width/2,0),duration)}},enableReadOnly:!0});return{init:function(){this._viewDragger=new ViewDragger(this)},commands:{hand:ToggleHandCommand,camera:CameraCommand,move:MoveCommand},events:{statuschange:function(e){this._viewDragger.setEnabled("hand"==e.currentStatus)},mousewheel:function(e){var dx,dy;if(!(e=e.originEvent).ctrlKey&&!e.shiftKey){"wheelDeltaX"in e?(dx=e.wheelDeltaX||0,dy=e.wheelDeltaY||0):(dx=0,dy=e.wheelDelta),this._viewDragger.move({x:dx/2.5,y:dy/2.5});var me=this;clearTimeout(this._mousewheeltimer),this._mousewheeltimer=setTimeout((function(){me.fire("viewchanged")}),100),e.preventDefault()}},"normal.dblclick readonly.dblclick":function(e){e.kityEvent.targetShape instanceof kity.Paper&&this.execCommand("camera",this.getRoot(),800)},"paperrender finishInitHook":function(){this.getRenderTarget()&&(this.execCommand("camera",null,0),this._lastClientSize={width:this.getRenderTarget().clientWidth,height:this.getRenderTarget().clientHeight})},resize:function(e){var a={width:this.getRenderTarget().clientWidth,height:this.getRenderTarget().clientHeight},b=this._lastClientSize;this._viewDragger.move(new kity.Point((a.width-b.width)/2|0,(a.height-b.height)/2|0)),this._lastClientSize=a},"selectionchange layoutallfinish":function(e){var selected=this.getSelectedNode(),minder=this;if(kity.Browser.edge&&this.fire("paperrender"),selected){var dragger=this._viewDragger,timeline=dragger.timeline();if(timeline)timeline.on("finish",(function(){minder.fire("selectionchange")}));else{var view=dragger.getView(),focus=selected.getLayoutBox(),dx=0,dy=0;focus.right>view.right?dx+=view.right-focus.right-50:focus.left<view.left&&(dx+=view.left-focus.left+50),focus.bottom>view.bottom&&(dy+=view.bottom-focus.bottom-50),focus.top<view.top&&(dy+=view.top-focus.top+50),(dx||dy)&&dragger.move(new kity.Point(dx,dy),100)}}}}}}))}},_p[63]={value:function(require,exports,module){var kity=_p.r(17),Minder=(_p.r(33),_p.r(19)),Command=(_p.r(21),_p.r(9)),Module=_p.r(20);_p.r(27);Module.register("Zoom",(function(){var timeline,me=this;function setTextRendering(){var value=me._zoomValue>=100?"optimize-speed":"geometricPrecision";me.getRenderContainer().setAttr("text-rendering",value)}function zoomMinder(minder,value){minder.getPaper().getViewPort();if(value){setTextRendering();var duration=minder.getOption("zoomAnimationDuration");if(minder.getRoot().getComplex()>200||!duration)minder._zoomValue=value,minder.zoom(value),minder.fire("viewchange");else{var animator=new kity.Animator({beginValue:minder._zoomValue,finishValue:value,setter:function(target,value){target.zoom(value)}});minder._zoomValue=value,timeline&&timeline.pause(),(timeline=animator.start(minder,duration,"easeInOutSine")).on("finish",(function(){minder.fire("viewchange")}))}minder.fire("zoom",{zoom:value})}}kity.extendClass(Minder,{zoom:function(value){var paper=this.getPaper(),viewport=paper.getViewPort();viewport.zoom=value/100,viewport.center={x:viewport.center.x,y:viewport.center.y},paper.setViewPort(viewport),100==value&&function fixPaperCTM(paper){var node=paper.shapeNode,ctm=node.getCTM(),matrix=new kity.Matrix(ctm.a,ctm.b,ctm.c,ctm.d,.5+(0|ctm.e),.5+(0|ctm.f));node.setAttribute("transform","matrix("+matrix.toString()+")")}(paper)},getZoomValue:function(){return this._zoomValue}});var ZoomCommand=kity.createClass("Zoom",{base:Command,execute:zoomMinder,queryValue:function(minder){return minder._zoomValue}});return{init:function(){this._zoomValue=100,this.setDefaultOptions({zoom:[10,20,50,100,200]}),setTextRendering()},commands:{zoomin:kity.createClass("ZoomInCommand",{base:Command,execute:function(minder){zoomMinder(minder,this.nextValue(minder))},queryState:function(minder){return+!this.nextValue(minder)},nextValue:function(minder){var i,stack=minder.getOption("zoom");for(i=0;i<stack.length;i++)if(stack[i]>minder._zoomValue)return stack[i];return 0},enableReadOnly:!0}),zoomout:kity.createClass("ZoomOutCommand",{base:Command,execute:function(minder){zoomMinder(minder,this.nextValue(minder))},queryState:function(minder){return+!this.nextValue(minder)},nextValue:function(minder){var i,stack=minder.getOption("zoom");for(i=stack.length-1;i>=0;i--)if(stack[i]<minder._zoomValue)return stack[i];return 0},enableReadOnly:!0}),zoom:ZoomCommand},events:{"normal.mousewheel readonly.mousewheel":function(e){if(e.originEvent.ctrlKey||e.originEvent.metaKey){var delta=e.originEvent.wheelDelta,me=this;Math.abs(delta)>100&&(clearTimeout(this._wheelZoomTimeout),this._wheelZoomTimeout=setTimeout((function(){me.getPaper()._zoom;delta>0?me.execCommand("zoomin"):delta<0&&me.execCommand("zoomout")}),100),e.originEvent.preventDefault())}}},commandShortcutKeys:{zoomin:"ctrl+=",zoomout:"ctrl+-"}}}))}},_p[64]={value:function(require,exports,module){_p.r(12).registerProtocol("json",module.exports={fileDescription:"KityMinder 格式",fileExtension:".km",dataType:"text",mineType:"application/json",encode:function(json){return JSON.stringify(json)},decode:function(local){return JSON.parse(local)}})}},_p[65]={value:function(require,exports,module){var data=_p.r(12),LINE_ENDING_SPLITER=/\r\n|\r|\n/;function encode(json){return _build(json,1).join("\n")}function _build(node,level){var lines=[],sharps=function _generateHeaderSharp(level){var sharps="";for(;level--;)sharps+="#";return sharps}(level=level||1);lines.push(sharps+" "+node.data.text),lines.push("");var note=node.data.note;if(note){var hasSharp=/^#/.test(note);hasSharp&&(lines.push("\x3c!--Note--\x3e"),note=note.replace(/^#+/gm,(function($0){return sharps+$0}))),lines.push(note),hasSharp&&lines.push("\x3c!--/Note--\x3e"),lines.push("")}return node.children&&node.children.forEach((function(child){lines=lines.concat(_build(child,level+1))})),lines}function _initNode(text,parent){var node={data:{text,note:""}};return parent&&(parent.children?parent.children.push(node):parent.children=[node]),node}function _pushNote(node,line){node.data.note+=line+"\n"}function _resolveLine(line){var match=/^(#+)?\s*(.*)$/.exec(line);return{level:match[1]&&match[1].length||null,content:match[2],noteStart:"\x3c!--Note--\x3e"==line,noteClose:"\x3c!--/Note--\x3e"==line,codeBlock:/^\s*```/.test(line)}}function _cleanUp(node){if(/\S/.test(node.data.note)){for(var notes=node.data.note.split("\n");notes.length&&!/\S/.test(notes[0]);)notes.shift();for(;notes.length&&!/\S/.test(notes[notes.length-1]);)notes.pop();node.data.note=notes.join("\n")}else node.data.note=null,delete node.data.note;node.children&&node.children.forEach(_cleanUp)}data.registerProtocol("markdown",module.exports={fileDescription:"Markdown/GFM 格式",fileExtension:".md",mineType:"text/markdown",dataType:"text",encode:function(json){return encode(json.root)},decode:function(markdown){return function decode(markdown){var lines,line,lineInfo,level,node,noteProgress,codeBlock,parentMap={};lines=(markdown=markdown.replace(/^(.+)\n={3,}/,(function($0,$1){return"# "+$1}))).split(LINE_ENDING_SPLITER);for(var i=0;i<lines.length;i++)(lineInfo=_resolveLine(line=lines[i])).noteClose?noteProgress=!1:lineInfo.noteStart?noteProgress=!0:(codeBlock=lineInfo.codeBlock?!codeBlock:codeBlock,noteProgress||codeBlock||!lineInfo.level||lineInfo.level>level+1?node&&_pushNote(node,line):(level=lineInfo.level,node=_initNode(lineInfo.content,parentMap[level-1]),parentMap[level]=node));return _cleanUp(parentMap[1]),parentMap[1]}(markdown)}})}},_p[66]={value:function(require,exports,module){var kity=_p.r(17),data=_p.r(12),Promise=_p.r(25),DomURL=window.URL||window.webkitURL||window;function loadImage(info,callback){return new Promise((function(resolve,reject){var image=document.createElement("img");image.onload=function(){resolve({element:this,x:info.x,y:info.y,width:info.width,height:info.height})},image.onerror=function(err){reject(err)},image.crossOrigin="anonymous",image.src=info.url}))}data.registerProtocol("png",module.exports={fileDescription:"PNG 图片",fileExtension:".png",mineType:"image/png",dataType:"base64",encode:function encode(json,minder,option){var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),bgDeclare=minder.getStyle("background").toString(),bgUrl=/url\(\"(.+)\"\)/.exec(bgDeclare),bgColor=kity.Color.parse(bgDeclare),svgInfo=function getSVGInfo(minder){var paperTransform,svgXml,svgContainer,svgDom,blob,svgUrl,paper=minder.getPaper(),renderContainer=(paper.container,minder.getRenderContainer()),renderBox=renderContainer.getRenderBox(),width=renderBox.width+1,height=renderBox.height+1;paperTransform=paper.shapeNode.getAttribute("transform"),paper.shapeNode.setAttribute("transform","translate(0.5, 0.5)"),renderContainer.translate(-renderBox.x,-renderBox.y),svgXml=paper.container.innerHTML,renderContainer.translate(renderBox.x,renderBox.y),paper.shapeNode.setAttribute("transform",paperTransform),(svgContainer=document.createElement("div")).innerHTML=svgXml,(svgDom=svgContainer.querySelector("svg")).setAttribute("width",renderBox.width+1),svgDom.setAttribute("height",renderBox.height+1),svgDom.setAttribute("style",'font-family: Arial, "Microsoft Yahei","Heiti SC";'),(svgContainer=document.createElement("div")).appendChild(svgDom),svgXml=(svgXml=(svgXml=(svgXml=svgContainer.innerHTML).replace(' xmlns="http://www.w3.org/2000/svg" xmlns:NS1="" NS1:ns1:xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:NS2="" NS2:xmlns:ns1=""',"")).replace(/&nbsp;|[\x00-\x1F\x7F-\x9F]/g,"")).replace(/NS\d+:title/gi,"xlink:title"),blob=new Blob([svgXml],{type:"image/svg+xml"}),svgUrl=DomURL.createObjectURL(blob);var imagesInfo=[];return function traverse(node){if((nodeData=node.data).image){minder.renderNode(node);var nodeData,imageUrl=(nodeData=node.data).image,imageSize=nodeData.imageSize,imageRenderBox=node.getRenderBox("ImageRenderer",minder.getRenderContainer()),imageInfo={url:imageUrl,width:imageSize.width,height:imageSize.height,x:-renderContainer.getBoundaryBox().x+imageRenderBox.x,y:-renderContainer.getBoundaryBox().y+imageRenderBox.y};imagesInfo.push(imageInfo)}if("collapse"!==nodeData.expandState)for(var children=node.getChildren(),i=0;i<children.length;i++)traverse(children[i])}(minder.getRoot()),{width,height,dataUrl:svgUrl,xml:svgXml,imagesInfo}}(minder),width=option&&option.width&&option.width>svgInfo.width?option.width:svgInfo.width,height=option&&option.height&&option.height>svgInfo.height?option.height:svgInfo.height,offsetX=option&&option.width&&option.width>svgInfo.width?(option.width-svgInfo.width)/2:0,offsetY=option&&option.height&&option.height>svgInfo.height?(option.height-svgInfo.height)/2:0,svgDataUrl=svgInfo.dataUrl,imagesInfo=svgInfo.imagesInfo;function fillBackground(ctx,style){ctx.save(),ctx.fillStyle=style,ctx.fillRect(0,0,canvas.width,canvas.height),ctx.restore()}function drawImage(ctx,image,x,y,width,height){width&&height?ctx.drawImage(image,x+20,y+20,width,height):ctx.drawImage(image,x+20,y+20)}function generateDataUrl(canvas){return canvas.toDataURL("image/png")}function loadImages(imagesInfo){var imagePromises=imagesInfo.map((function(imageInfo){return function xhrLoadImage(info,callback){return Promise((function(resolve,reject){var xmlHttp=new XMLHttpRequest;xmlHttp.open("GET",info.url+"?_="+Date.now(),!0),xmlHttp.responseType="blob",xmlHttp.onreadystatechange=function(){if(4===xmlHttp.readyState&&200===xmlHttp.status){var blob=xmlHttp.response,image=document.createElement("img");image.src=DomURL.createObjectURL(blob),image.onload=function(){DomURL.revokeObjectURL(image.src),resolve({element:image,x:info.x,y:info.y,width:info.width,height:info.height})}}},xmlHttp.send()}))}(imageInfo)}));return Promise.all(imagePromises)}function drawSVG(){return loadImage({url:svgDataUrl}).then((function($image){return drawImage(ctx,$image.element,offsetX,offsetY,$image.width,$image.height),loadImages(imagesInfo)})).then((function($images){for(var i=0;i<$images.length;i++)drawImage(ctx,$images[i].element,$images[i].x+offsetX,$images[i].y+offsetY,$images[i].width,$images[i].height);DomURL.revokeObjectURL(svgDataUrl),document.body.appendChild(canvas);var pngBase64=generateDataUrl(canvas);return document.body.removeChild(canvas),pngBase64}),(function(err){alert("脑图的节点中包含跨域图片，导出的 png 中节点图片不显示，你可以替换掉这些跨域的图片并重试。"),DomURL.revokeObjectURL(svgDataUrl),document.body.appendChild(canvas);var pngBase64=generateDataUrl(canvas);return document.body.removeChild(canvas),pngBase64}))}return canvas.width=width+40,canvas.height=height+40,bgUrl?loadImage({url:bgUrl[1]}).then((function($image){return fillBackground(ctx,ctx.createPattern($image.element,"repeat")),drawSVG()})):(fillBackground(ctx,bgColor.toString()),drawSVG())}})}},_p[67]={value:function(require,exports,module){function cleanSVG(svgDom,x,y){svgDom.style.visibility="hidden",function replaceWithNode(svgNode,parentX,parentY){if(svgNode&&"defs"!==svgNode.tagName){if("transparent"===svgNode.getAttribute("fill")&&svgNode.setAttribute("fill","none"),svgNode.getAttribute("marker-end")&&svgNode.removeAttribute("marker-end"),parentX=parentX||0,parentY=parentY||0,svgNode.getAttribute("transform")){var ctm=function getTransformToElement(target,source){var matrix;try{matrix=source.getScreenCTM().inverse()}catch(e){throw new Error("Can not inverse source element' ctm.")}return matrix.multiply(target.getScreenCTM())}(svgNode,svgNode.parentElement);parentX-=ctm.e,parentY-=ctm.f,svgNode.removeAttribute("transform")}switch(svgNode.tagName.toLowerCase()){case"g":break;case"path":var d=svgNode.getAttribute("d");return void(d&&(d=function dealWithPath(d,dealWithPattern){dealWithPattern instanceof Function||(dealWithPattern=function(){});for(var strArr=[],pattern=[],cache=[],i=0,l=d.length;i<l;i++)switch(d[i]){case"M":case"L":case"T":case"S":case"A":case"C":case"H":case"V":case"Q":cache.length&&(pattern.push(cache.join("")),cache=[]),","===pattern[pattern.length-1]&&pattern.pop(),pattern.length&&(dealWithPattern(pattern),strArr.push(pattern.join("")),pattern=[]),pattern.push(d[i]);break;case"Z":case"z":pattern.push(cache.join(""),d[i]),dealWithPattern(pattern),strArr.push(pattern.join("")),cache=[],pattern=[];break;case".":case"e":cache.push(d[i]);break;case"-":"e"!==d[i-1]&&(cache.length&&pattern.push(cache.join(""),","),cache=[]),cache.push("-");break;case" ":case",":cache.length&&(pattern.push(cache.join(""),","),cache=[]);break;default:/\d/.test(d[i])?cache.push(d[i]):cache.length?(pattern.push(cache.join(""),d[i]),cache=[]):(","===pattern[pattern.length-1]&&pattern.pop(),pattern.push(d[i])),i+1===l&&(cache.length&&pattern.push(cache.join("")),dealWithPattern(pattern),strArr.push(pattern.join("")),cache=null,pattern=null)}return strArr.join("")}(d,(function(pattern){switch(pattern[0]){case"V":pattern[1]=+pattern[1]-parentY;break;case"H":pattern[1]=+pattern[1]-parentX;break;case"M":case"L":case"T":pattern[1]=+pattern[1]-parentX,pattern[3]=+pattern[3]-parentY;break;case"Q":case"S":pattern[1]=+pattern[1]-parentX,pattern[3]=+pattern[3]-parentY,pattern[5]=+pattern[5]-parentX,pattern[7]=+pattern[7]-parentY;break;case"A":pattern[11]=+pattern[11]-parentX,pattern[13]=+pattern[13]-parentY;break;case"C":pattern[1]=+pattern[1]-parentX,pattern[3]=+pattern[3]-parentY,pattern[5]=+pattern[5]-parentX,pattern[7]=+pattern[7]-parentY,pattern[9]=+pattern[9]-parentX,pattern[11]=+pattern[11]-parentY}})),svgNode.setAttribute("d",d),svgNode.removeAttribute("transform")));case"image":case"text":if(parentX&&parentY){var x=+svgNode.getAttribute("x")||0,y=+svgNode.getAttribute("y")||0;svgNode.setAttribute("x",x-parentX),svgNode.setAttribute("y",y-parentY)}return svgNode.getAttribute("dominant-baseline")&&(svgNode.removeAttribute("dominant-baseline"),svgNode.setAttribute("dy",".8em")),void svgNode.removeAttribute("transform")}if(svgNode.children)for(var i=0,l=svgNode.children.length;i<l;i++)replaceWithNode(svgNode.children[i],parentX,parentY)}}(svgDom,x||0,y||0),svgDom.style.visibility="visible"}_p.r(12).registerProtocol("svg",module.exports={fileDescription:"SVG 矢量图",fileExtension:".svg",mineType:"image/svg+xml",dataType:"text",encode:function(json,minder){var svgXml,svgContainer,svgDom,paper=minder.getPaper(),paperTransform=paper.shapeNode.getAttribute("transform"),renderContainer=minder.getRenderContainer(),renderBox=renderContainer.getRenderBox(),width=(renderContainer.getTransform(),renderBox.width),height=renderBox.height;return paper.shapeNode.setAttribute("transform","translate(0.5, 0.5)"),svgXml=paper.container.innerHTML,paper.shapeNode.setAttribute("transform",paperTransform),svgContainer=document.createElement("div"),document.body.appendChild(svgContainer),svgContainer.innerHTML=svgXml,(svgDom=svgContainer.querySelector("svg")).setAttribute("width",width+40|0),svgDom.setAttribute("height",height+40|0),svgDom.setAttribute("style","background: "+minder.getStyle("background")),svgDom.setAttribute("viewBox",[0,0,width+40|0,height+40|0].join(" ")),tempSvgContainer=document.createElement("div"),cleanSVG(svgDom,renderBox.x-20|0,renderBox.y-20|0),document.body.removeChild(svgContainer),tempSvgContainer.appendChild(svgDom),svgXml=(svgXml=tempSvgContainer.innerHTML).replace(/&nbsp;/g,"&#xa0;")}})}},_p[68]={value:function(require,exports,module){var data=_p.r(12),Browser=_p.r(17).Browser,LINE_ENDING_SPLITER=/\r\n|\r|\n/,TAB_CHAR=function(Browser){return Browser.gecko?{REGEXP:new RegExp("^(\t|"+String.fromCharCode(160,160,32,160)+")"),DELETE:new RegExp("^(\t|"+String.fromCharCode(160,160,32,160)+")+")}:Browser.ie||Browser.edge?{REGEXP:new RegExp("^("+String.fromCharCode(32)+"|"+String.fromCharCode(160)+")"),DELETE:new RegExp("^("+String.fromCharCode(32)+"|"+String.fromCharCode(160)+")+")}:{REGEXP:/^(\t|\x20{4})/,DELETE:/^(\t|\x20{4})+/}}(Browser);function decodeWrap(text){if(!text)return"";for(var textArr=[],WRAP_TEXT=["\\","\\","n"],i=0,j=0,l=text.length;i<l;i++)if(text[i]!==WRAP_TEXT[j])switch(j){case 0:textArr.push(text[i]),j=0;break;case 1:"n"===text[i]?textArr.push("\n"):textArr.push(text[i-1],text[i]),j=0;break;case 2:textArr.push(text[i-2]),"\\"!==text[i]&&(j=0,textArr.push(text[i-1],text[i]))}else 3===++j&&(j=0,textArr.push("\\n"));return textArr.join("")}function encode(json,level){var local="";return local+=function repeat(s,n){for(var result="";n--;)result+=s;return result}("\t",level=level||0),local+=function encodeWrap(nodeText){if(!nodeText)return"";for(var textArr=[],WRAP_TEXT=["\\","n"],i=0,j=0,l=nodeText.length;i<l;i++)if("\n"!==nodeText[i]&&"\r"!==nodeText[i])if(nodeText[i]!==WRAP_TEXT[j]){switch(j){case 0:textArr.push(nodeText[i]);break;case 1:textArr.push(nodeText[i-1],nodeText[i])}j=0}else 2==++j&&(j=0,textArr.push("\\\\n"));else textArr.push("\\n"),j=0;return textArr.join("")}(json.data.text)+"\r",json.children&&json.children.forEach((function(child){local+=encode(child,level+1)})),local}function isEmpty(line){return!/\S/.test(line)}function getLevel(line){for(var level=0;TAB_CHAR.REGEXP.test(line);)line=line.replace(TAB_CHAR.REGEXP,""),level++;return level}function getNode(line){return{data:{text:decodeWrap(line.replace(TAB_CHAR.DELETE,""))}}}data.registerProtocol("text",module.exports={fileDescription:"大纲文本",fileExtension:".txt",dataType:"text",mineType:"text/plain",encode:function(json){return encode(json.root,0)},decode:function(local){return function decode(local){for(var json,line,level,node,parent,child,parentMap={},lines=local.split(LINE_ENDING_SPLITER),i=0;i<lines.length;i++)if(!isEmpty(line=lines[i])){if(level=getLevel(line),node=getNode(line),0===level){if(json)throw new Error("Invalid local format");json=node}else{if(!parentMap[level-1])throw new Error("Invalid local format");child=node,((parent=parentMap[level-1]).children||(parent.children=[])).push(child)}parentMap[level]=node}return json}(local)},Node2Text:function(node){return function Node2Text(node){if(node)return/^\s*$/.test(node.data.text)&&(node.data.text="分支主题"),encode(function exportNode(node){var exported={};exported.data=node.getData();var childNodes=node.getChildren();exported.children=[];for(var i=0;i<childNodes.length;i++)exported.children.push(exportNode(childNodes[i]));return exported}(node))}(node)}})}},_p[69]={value:function(require,exports,module){_p.r(31).register("default",{getLayout:function(node){if(node.getData("layout"))return node.getData("layout");var level=node.getLevel();return 0===level?"mind":1===level?node.getLayoutPointPreview().x>0?"right":"left":node.parent.getLayout()},getConnect:function(node){return 1==node.getLevel()?"arc":"under"}})}},_p[70]={value:function(require,exports,module){_p.r(31).register("filetree",{getLayout:function(node){return node.getData("layout")?node.getData("layout"):node.isRoot()?"bottom":"filetree-down"},getConnect:function(node){return 1==node.getLevel()?"poly":"l"}})}},_p[71]={value:function(require,exports,module){_p.r(31).register("fish-bone",{getLayout:function(node){if(node.getData("layout"))return node.getData("layout");var level=node.getLevel();return 0===level?"fish-bone-master":1===level?"fish-bone-slave":node.getLayoutPointPreview().y>0?"filetree-up":"filetree-down"},getConnect:function(node){switch(node.getLevel()){case 1:return"fish-bone-master";case 2:return"line";default:return"l"}}})}},_p[72]={value:function(require,exports,module){_p.r(31).register("right",{getLayout:function(node){return node.getData("layout")||"right"},getConnect:function(node){return 1==node.getLevel()?"arc":"bezier"}})}},_p[73]={value:function(require,exports,module){_p.r(31).register("structure",{getLayout:function(node){return node.getData("layout")||"bottom"},getConnect:function(node){return"poly"}})}},_p[74]={value:function(require,exports,module){_p.r(31).register("tianpan",{getLayout:function(node){return node.getData("layout")?node.getData("layout"):0===node.getLevel()?"tianpan":node.parent.getLayout()},getConnect:function(node){return"arc_tp"}})}},_p[75]={value:function(require,exports,module){var theme=_p.r(32);["classic","classic-compact"].forEach((function(name){var compact="classic-compact"==name;theme.register(name,{background:'#3A4144 url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowQzg5QTQ0NDhENzgxMUUzOENGREE4QTg0RDgzRTZDNyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDowQzg5QTQ0NThENzgxMUUzOENGREE4QTg0RDgzRTZDNyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkMwOEQ1NDRGOEQ3NzExRTM4Q0ZEQThBODREODNFNkM3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkMwOEQ1NDUwOEQ3NzExRTM4Q0ZEQThBODREODNFNkM3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+e9P33AAAACVJREFUeNpisXJ0YUACTAyoAMr/+eM7EGGRZ4FQ7BycEAZAgAEAHbEGtkoQm/wAAAAASUVORK5CYII=") repeat',"root-color":"#430","root-background":"#e9df98","root-stroke":"#e9df98","root-font-size":24,"root-padding":compact?[10,25]:[15,25],"root-margin":compact?[15,25]:[30,100],"root-radius":30,"root-space":10,"root-shadow":"rgba(0, 0, 0, .25)","main-color":"#333","main-background":"#a4c5c0","main-stroke":"#a4c5c0","main-font-size":16,"main-padding":compact?[5,15]:[6,20],"main-margin":compact?[5,10]:20,"main-radius":10,"main-space":5,"main-shadow":"rgba(0, 0, 0, .25)","sub-color":"white","sub-background":"transparent","sub-stroke":"none","sub-font-size":12,"sub-padding":[5,10],"sub-margin":compact?[5,10]:[15,20],"sub-tree-margin":30,"sub-radius":5,"sub-space":5,"connect-color":"white","connect-width":2,"main-connect-width":3,"connect-radius":5,"selected-background":"rgb(254, 219, 0)","selected-stroke":"rgb(254, 219, 0)","selected-color":"black","marquee-background":"rgba(255,255,255,.3)","marquee-stroke":"white","drop-hint-color":"yellow","sub-drop-hint-width":2,"main-drop-hint-width":4,"root-drop-hint-width":4,"order-hint-area-color":"rgba(0, 255, 0, .5)","order-hint-path-color":"#0f0","order-hint-path-width":1,"text-selection-color":"rgb(27,171,255)","line-height":1.5})}))}},_p[76]={value:function(require,exports,module){_p.r(32).register("fish",{background:'#3A4144 url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowQzg5QTQ0NDhENzgxMUUzOENGREE4QTg0RDgzRTZDNyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDowQzg5QTQ0NThENzgxMUUzOENGREE4QTg0RDgzRTZDNyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkMwOEQ1NDRGOEQ3NzExRTM4Q0ZEQThBODREODNFNkM3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkMwOEQ1NDUwOEQ3NzExRTM4Q0ZEQThBODREODNFNkM3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+e9P33AAAACVJREFUeNpisXJ0YUACTAyoAMr/+eM7EGGRZ4FQ7BycEAZAgAEAHbEGtkoQm/wAAAAASUVORK5CYII=") repeat',"root-color":"#430","root-background":"#e9df98","root-stroke":"#e9df98","root-font-size":24,"root-padding":[35,35],"root-margin":30,"root-radius":100,"root-space":10,"root-shadow":"rgba(0, 0, 0, .25)","main-color":"#333","main-background":"#a4c5c0","main-stroke":"#a4c5c0","main-font-size":16,"main-padding":[6,20],"main-margin":[20,20],"main-radius":5,"main-space":5,"main-shadow":"rgba(0, 0, 0, .25)","sub-color":"black","sub-background":"white","sub-stroke":"white","sub-font-size":12,"sub-padding":[5,10],"sub-margin":[10],"sub-radius":5,"sub-space":5,"connect-color":"white","connect-width":3,"main-connect-width":3,"connect-radius":5,"selected-background":"rgb(254, 219, 0)","selected-stroke":"rgb(254, 219, 0)","marquee-background":"rgba(255,255,255,.3)","marquee-stroke":"white","drop-hint-color":"yellow","drop-hint-width":4,"order-hint-area-color":"rgba(0, 255, 0, .5)","order-hint-path-color":"#0f0","order-hint-path-width":1,"text-selection-color":"rgb(27,171,255)","line-height":1.5})}},_p[77]={value:function(require,exports,module){var kity=_p.r(17),theme=_p.r(32);function hsl(h,s,l){return kity.Color.createHSL(h,s,l)}function generate(h,compat){return{background:"#fbfbfb","root-color":"white","root-background":hsl(h,37,60),"root-stroke":hsl(h,37,60),"root-font-size":16,"root-padding":compat?[6,12]:[12,24],"root-margin":compat?10:[30,100],"root-radius":5,"root-space":10,"main-color":"black","main-background":hsl(h,33,95),"main-stroke":hsl(h,37,60),"main-stroke-width":1,"main-font-size":14,"main-padding":[6,20],"main-margin":compat?8:20,"main-radius":3,"main-space":5,"sub-color":"black","sub-background":"transparent","sub-stroke":"none","sub-font-size":12,"sub-padding":compat?[3,5]:[5,10],"sub-margin":compat?[4,8]:[15,20],"sub-radius":5,"sub-space":5,"connect-color":hsl(h,37,60),"connect-width":1,"connect-radius":5,"selected-stroke":hsl(h,26,30),"selected-stroke-width":"3","blur-selected-stroke":hsl(h,10,60),"marquee-background":hsl(h,100,80).set("a",.1),"marquee-stroke":hsl(h,37,60),"drop-hint-color":hsl(h,26,35),"drop-hint-width":5,"order-hint-area-color":hsl(h,100,30).set("a",.5),"order-hint-path-color":hsl(h,100,25),"order-hint-path-width":1,"text-selection-color":hsl(h,100,20),"line-height":1.5}}var name,plans={red:0,soil:25,green:122,blue:204,purple:246,pink:334};for(name in plans)theme.register("fresh-"+name,generate(plans[name])),theme.register("fresh-"+name+"-compat",generate(plans[name],!0))}},_p[78]={value:function(require,exports,module){var theme=_p.r(32);["snow","snow-compact"].forEach((function(name){var compact="snow-compact"==name;theme.register(name,{background:'#3A4144 url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowQzg5QTQ0NDhENzgxMUUzOENGREE4QTg0RDgzRTZDNyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDowQzg5QTQ0NThENzgxMUUzOENGREE4QTg0RDgzRTZDNyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkMwOEQ1NDRGOEQ3NzExRTM4Q0ZEQThBODREODNFNkM3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkMwOEQ1NDUwOEQ3NzExRTM4Q0ZEQThBODREODNFNkM3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+e9P33AAAACVJREFUeNpisXJ0YUACTAyoAMr/+eM7EGGRZ4FQ7BycEAZAgAEAHbEGtkoQm/wAAAAASUVORK5CYII=") repeat',"root-color":"#430","root-background":"#e9df98","root-stroke":"#e9df98","root-font-size":24,"root-padding":compact?[5,10]:[15,25],"root-margin":compact?15:30,"root-radius":5,"root-space":10,"root-shadow":"rgba(0, 0, 0, .25)","main-color":"#333","main-background":"#a4c5c0","main-stroke":"#a4c5c0","main-font-size":16,"main-padding":compact?[4,10]:[6,20],"main-margin":compact?[5,10]:[20,40],"main-radius":5,"main-space":5,"main-shadow":"rgba(0, 0, 0, .25)","sub-color":"black","sub-background":"white","sub-stroke":"white","sub-font-size":12,"sub-padding":[5,10],"sub-margin":compact?[5,10]:[10,20],"sub-radius":5,"sub-space":5,"connect-color":"white","connect-width":2,"main-connect-width":3,"connect-radius":5,"selected-background":"rgb(254, 219, 0)","selected-stroke":"rgb(254, 219, 0)","marquee-background":"rgba(255,255,255,.3)","marquee-stroke":"white","drop-hint-color":"yellow","drop-hint-width":4,"order-hint-area-color":"rgba(0, 255, 0, .5)","order-hint-path-color":"#0f0","order-hint-path-width":1,"text-selection-color":"rgb(27,171,255)","line-height":1.5})}))}},_p[79]={value:function(require,exports,module){var theme=_p.r(32);["tianpan","tianpan-compact"].forEach((function(name){var compact="tianpan-compact"==name;theme.register(name,{background:'#3A4144 url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowQzg5QTQ0NDhENzgxMUUzOENGREE4QTg0RDgzRTZDNyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDowQzg5QTQ0NThENzgxMUUzOENGREE4QTg0RDgzRTZDNyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkMwOEQ1NDRGOEQ3NzExRTM4Q0ZEQThBODREODNFNkM3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkMwOEQ1NDUwOEQ3NzExRTM4Q0ZEQThBODREODNFNkM3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+e9P33AAAACVJREFUeNpisXJ0YUACTAyoAMr/+eM7EGGRZ4FQ7BycEAZAgAEAHbEGtkoQm/wAAAAASUVORK5CYII=") repeat',"root-color":"#430","root-background":"#e9df98","root-stroke":"#e9df98","root-font-size":25,"root-padding":compact?15:20,"root-margin":compact?[15,25]:100,"root-radius":30,"root-space":10,"root-shadow":"rgba(0, 0, 0, .25)","root-shape":"circle","main-color":"#333","main-background":"#a4c5c0","main-stroke":"#a4c5c0","main-font-size":15,"main-padding":compact?10:12,"main-margin":compact?10:12,"main-radius":10,"main-space":5,"main-shadow":"rgba(0, 0, 0, .25)","main-shape":"circle","sub-color":"#333","sub-background":"#99ca6a","sub-stroke":"#a4c5c0","sub-font-size":13,"sub-padding":5,"sub-margin":compact?6:10,"sub-tree-margin":30,"sub-radius":5,"sub-space":5,"sub-shadow":"rgba(0, 0, 0, .25)","sub-shape":"circle","connect-color":"white","connect-width":2,"main-connect-width":3,"connect-radius":5,"selected-background":"rgb(254, 219, 0)","selected-stroke":"rgb(254, 219, 0)","selected-color":"black","marquee-background":"rgba(255,255,255,.3)","marquee-stroke":"white","drop-hint-color":"yellow","sub-drop-hint-width":2,"main-drop-hint-width":4,"root-drop-hint-width":4,"order-hint-area-color":"rgba(0, 255, 0, .5)","order-hint-path-color":"#0f0","order-hint-path-width":1,"text-selection-color":"rgb(27,171,255)","line-height":1.4})}))}},_p[80]={value:function(require,exports,module){_p.r(32).register("wire",{background:"black",color:"#999",stroke:"none",padding:10,margin:20,"font-size":14,"connect-color":"#999","connect-width":1,"selected-background":"#999","selected-color":"black","marquee-background":"rgba(255,255,255,.3)","marquee-stroke":"white","drop-hint-color":"yellow","sub-drop-hint-width":2,"main-drop-hint-width":4,"root-drop-hint-width":4,"order-hint-area-color":"rgba(0, 255, 0, .5)","order-hint-path-color":"#0f0","order-hint-path-width":1,"text-selection-color":"rgb(27,171,255)","line-height":1.5})}};var moduleMapping={"expose-kityminder":34};!function use(name){_p.r([moduleMapping[name]])}("expose-kityminder")}()}}]);